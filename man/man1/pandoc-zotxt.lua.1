'\" t
.\" Automatically generated by Pandoc 2.16.1
.\"
.TH "pandoc-zotxt.lua" "1" "November 10, 2021" "" ""
.hy
.SH NAME
.PP
\f[B]pandoc-zotxt.lua\f[R] - Look up sources of citations in Zotero
.SH SYNOPSIS
.PP
\f[B]pandoc\f[R] \f[B]-L\f[R] \f[I]pandoc-zotxt.lua\f[R] \f[B]-C\f[R]
.SH DESCRIPTION
.PP
\f[B]pandoc-zotxt.lua\f[R] is a Lua filter for Pandoc that looks up
citations in Zotero and adds their bibliographic data to a
document\[aq]s \[dq]references\[dq] metadata field or to a bibliography
file, where Pandoc can pick it up.
.PP
Cite your sources using so-called \[dq]Better BibTeX citation keys\[dq]
(provided by Better BibTeX for Zotero) or \[dq]easy citekeys\[dq]
(provided by zotxt).
Then, while Zotero is running, tell \f[B]pandoc\f[R] to filter your
document through \f[B]pandoc-zotxt.lua\f[R] before processing citations.
That\[aq]s all there is to it.
.PP
If a document\[aq]s \[dq]references\[dq] metadata field or a
bibliography file already has bibliographic data for a citation, that
citation will be ignored.
.SH BIBLIOGRAPHY FILES
.PP
\f[B]pandoc-zotxt.lua\f[R] can add bibliographic data to a bibliography
file, rather than to the \[dq]references\[dq] metadata field.
This speeds up subsequent processing of the same document, because that
data need not be fetched again from Zotero.
.PP
To use such a bibliography file, set the \[dq]zotero-bibliography\[dq]
metadata field to a filename.
If the filename is relative, it is interpreted as relative to the
directory of the first input file passed to \f[B]pandoc\f[R] or, if no
input file was given, as relative to the current working directory.
The format of the file is determined by its filename ending:
.PP
.TS
tab(@);
l l l.
T{
\f[B]Ending\f[R]
T}@T{
\f[B]Format\f[R]
T}@T{
\f[B]Feature\f[R]
T}
_
T{
\f[C].json\f[R]
T}@T{
CSL JSON
T}@T{
More reliable.
T}
T{
\f[C].yaml\f[R]
T}@T{
CSL YAML
T}@T{
Easier to edit.
T}
.TE
.PP
The bibliography file is added to the \[dq]bibliography\[dq] metadata
field automatically.
You can safely set \[dq]zotero-bibliography\[dq] and
\[dq]bibliography\[dq] at the same time.
.PP
\f[B]pandoc-zotxt.lua\f[R] only adds bibliographic records to that file;
it does \f[I]not\f[R] change, update, or delete them.
If you need to update or delete records, delete the file;
\f[B]pandoc-zotxt.lua\f[R] will then regenerate it.
.SH CITATION KEY TYPES
.PP
\f[B]pandoc-zotxt.lua\f[R] supports multiple types of citation keys,
namely, \[dq]Better BibTeX citation keys\[dq], \[dq]easy citekeys\[dq]
and Zotero iterm IDs.
.PP
However, it may happen that a Better BibTeX citation key is interpreted
as an easy citekey \f[I]and\f[R] yet picks out an item, if not the one
that it actually is the citation key of.
That is to say, citation keys may be matched with the wrong
bibliographic data.
.PP
If this happens, you can disable citation keys that you do not use by
setting the \[dq]zotero-citekey-types\[dq] metadata field to the
citation key type or the list of citation key types that you want to
use.
.PP
You can set the following citation key types:
.PP
.TS
tab(@);
l l l.
T{
\f[B]Key\f[R]
T}@T{
\f[B]Type\f[R]
T}@T{
\f[B]Comments\f[R]
T}
_
T{
\f[C]betterbibtexkey\f[R]
T}@T{
Better BibTeX citation key
T}@T{
-
T}
T{
\f[C]easykey\f[R]
T}@T{
easy citekey
T}@T{
Deprecated.
T}
T{
\f[C]key\f[R]
T}@T{
Zotero item ID
T}@T{
Hard to use.
T}
.TE
.SH EXAMPLES
.IP
.nf
\f[C]
pandoc -L pandoc-zotxt.lua -C <<EOF
See \[at]doe2020Title for details.
EOF
\f[R]
.fi
.PP
This will look up \[dq]doe2020Title\[dq] in Zotero.
.IP
.nf
\f[C]
pandoc -L pandoc-zotxt.lua -C <<EOF
---
zotero-bibliography: bibliography.json
\&...
See \[at]doe2020Title for details.
EOF
\f[R]
.fi
.PP
This will look up \[dq]doe2020Title\[dq] in Zotero and save its
bibliographic data into the file \[dq]bibliography.json\[dq] in the
current working directory.
If the same command is run again, \[dq]doe2020Title\[dq] will
\f[I]not\f[R] be looked up again.
.IP
.nf
\f[C]
pandoc -L pandoc-zotxt.lua -C <<EOF
---
zotero-citekey-types: betterbibtexkey
\&...
See \[at]doe2020Title for details.
EOF
\f[R]
.fi
.PP
This forces \f[B]pandoc-zotxt.lua\f[R] to interpret
\[dq]doe2020Title\[dq] as a Better BibTeX citation key.
.SH KNOWN ISSUES
.PP
Citation keys may, on rare occassions, be matched with the wrong
bibliographic data.
This happens if a citation key picks out a different record depending on
whether it is interpreted as a Better BibTeX citation key or as an easy
citekey.
See \f[B]CITATION KEY TYPES\f[R] above on how to fix this.
.PP
\f[B]pandoc-zotxt.lua\f[R] creates a temporary file when it adds sources
to a bibliography file.
If Pandoc exits because it catches a signal (e.g., because you press
\f[B]Ctrl\f[R]-\f[B]c\f[R]), then this file will \f[I]not\f[R] be
deleted.
This is a bug in Pandoc and in the process of being fixed.
Moreover, if you are using Pandoc up to v2.7, another process may,
mistakenly, use the same temporary file at the same time, though this is
highly unlikely.
.PP
Zotero v5.0.71 and v5.0.72 fail to handle HTTP requests from user agents
that do not set the \[dq]User Agent\[dq] HTTP header.
And \f[B]pandoc\f[R] does not.
As a consequence, \f[B]pandoc-zotxt.lua\f[R] cannot retrieve data from
these versions of Zotero unless you tell \f[B]pandoc\f[R] to set that
header.
.SH SECURITY
.PP
If you are using Pandoc up to v2.7 and place the auto-generated
bibliography file in a directory that other users have write access to,
then they can read and change the content of that file, regardless of
whether they have permission to read or write the file itself.
.SH CAVEATS
.PP
\f[B]pandoc-zotxt.lua\f[R] is Unicode-agnostic.
.SH SEE ALSO
.IP \[bu] 2
zotxt (https://github.com/egh/zotxt)
.IP \[bu] 2
Better BibTeX (https://retorque.re/zotero-better-bibtex/)
.PP
pandoc(1)
.SH AUTHORS
Odin Kroeger.
