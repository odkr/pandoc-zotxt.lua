.\" Automatically generated by Pandoc 2.13
.\"
.TH "pandoc-zotxt.lua" "1" "April 05, 2021" "" ""
.hy
.SH NAME
.PP
\f[B]pandoc-zotxt.lua\f[R] - Looks up sources of citations in Zotero
.SH SYNOPSIS
.PP
\f[B]pandoc\f[R] \f[B]-L\f[R] \f[I]pandoc-zotxt.lua\f[R] \f[B]-C\f[R]
.SH DESCRIPTION
.PP
\f[B]pandoc-zotxt.lua\f[R] looks up sources of citations in Zotero and
adds them either to a document\[aq]s \[dq]references\[dq] metadata field
or to a bibliography file, where \f[B]pandoc\f[R] can pick them up.
.PP
Cite your sources using \[dq]easy citekeys\[dq] (provided by
\f[I]zotxt\f[R]) or \[dq]Better BibTeX Citation Keys\[dq] (provided by
Better BibTeX for Zotero).
Then tell \f[B]pandoc\f[R] to filter your document through
\f[B]pandoc-zotxt.lua\f[R] before processing citations.
Zotero must be running, of course.
That\[aq]s all there is to it.
.PP
\f[B]pandoc-zotxt.lua\f[R] only queries Zotero for sources that are
defined neither in the \[dq]references\[dq] metadata field nor in any
bibliography file.
.SH BIBLIOGRAPHY FILES
.PP
If you set the \[dq]zotero-bibliography\[dq] metadata field to a
filename, then \f[B]pandoc-zotxt.lua\f[R] adds sources to that file,
rather than to the \[dq]references\[dq] metadata field.
This speeds up subsequent processing of the same document, because
\f[B]pandoc-zotxt.lua\f[R] will only fetch those sources from Zotero
that are not yet in that file.
It will also add the path of that file to the document\[aq]s
\[dq]bibliography\[dq] metadata field, so that \f[B]pandoc\f[R] picks up
those sources (if you have already set another bibliography file, it
neither changes that file nor removes it from the document\[aq]s
metadata; Pandoc will process both files).
.PP
The biblography is stored as a JSON file, so the filename must end with
\[dq].json\[dq].
You can safely set \[dq]zotero-bibliography\[dq] and
\[dq]bibliography\[dq] at the same time.
.PP
\f[B]pandoc-zotxt.lua\f[R] interprets relative filenames as relative to
the directory of the first input file that you pass to \f[B]pandoc\f[R]
or, if you do not pass any input file, as relative to the current
working directory.
However, you may want to use a single bibliography file for all of your
documents.
.PP
\f[B]pandoc-zotxt.lua\f[R] only ever adds sources to the bibliography
file.
It doesn\[aq]t update or delete them.
If you want to update the sources in your bibliography file, delete it.
\f[B]pandoc-zotxt.lua\f[R] will then regenerate it from scratch.
.SH EXAMPLES
.IP
.nf
\f[C]
pandoc -L pandoc-zotxt.lua -C <<EOF
See \[at]doe2020Title for details.
EOF
\f[R]
.fi
.PP
This instructs Pandoc to filter the input through
\f[B]pandoc-zotxt.lua\f[R], which then looks up the bibligraphic data of
the source with the citation key \[dq]doe2020Title\[dq] in Zotero before
Pandoc processes citations.
.IP
.nf
\f[C]
cat <<EOF >document.md
---
zotero-bibliography: bibliography.json
---
See \[at]doe2020Title for details.
EOF
pandoc -L pandoc-zotxt.lua -C document.md
\f[R]
.fi
.PP
This instructs \f[B]pandoc-zotxt.lua\f[R] to store bibliographic data in
a file named \[dq]bibliography.json\[dq] and to add that file to the
metadata field \[dq]bibliography\[dq], so that Pandoc picks it up.
\[dq]bibliography.json\[dq] is placed in the same directory as
\[dq]document.md\[dq], since \[dq]document.md\[dq] is the first input
file given.
The next time you process \[dq]document.md\[dq],
\f[B]pandoc-zotxt.lua\f[R] will \f[I]not\f[R] look up the source
\[dq]doe2020Title\[dq] in Zotero, because the file
\[dq]bibliography.json\[dq] already contains its bibliographic data.
.SH KNOWN ISSUES
.PP
Zotero, from v5.0.71 onwards, does not allow browsers to access its
interface.
It defines \[dq]browser\[dq] as any user agent that sets the \[dq]User
Agent\[dq] HTTP header to a string that starts with \[dq]Mozilla/\[dq].
However, Zotero v5.0.71 and v5.0.72 fail to handle HTTP requests from
user agents that do not set the \[dq]User Agent\[dq] HTTP header.
And \f[B]pandoc\f[R] does not.
As a consequence, \f[B]pandoc-zotxt.lua\f[R] cannot retrieve data from
these versions of Zotero, that is, unless you tell \f[B]pandoc\f[R] to
set that header.
If you cannot upgrade to a more recent version of Zotero, you can make
\f[B]pandoc\f[R] set that header by passing, for instance,
\f[B]--request-header\f[R] \f[I]User-Agent:Pandoc/2\f[R].
If you must set the \[dq]User Agent\[dq] HTTP header to a string that
starts with \[dq]Mozilla/\[dq], you can still get \f[B]pandoc\f[R] to
connect to Zotero by setting the HTTP header
\[dq]Zotero-Allowed-Request\[dq].
You do so by passing \f[B]--request-header\f[R]
\f[I]Zotero-Allowed-Request:X\f[R].
.SH KNOWN ISSUES
.PP
\f[B]pandoc-zotxt.lua\f[R] ignores Pandoc\[aq]s
\f[B]--resource-path\f[R] option.
.SH CAVEATS
.PP
\f[B]pandoc-zotxt.lua\f[R] is Unicode-agnostic.
.SH SEE ALSO
.IP \[bu] 2
zotxt (https://github.com/egh/zotxt)
.IP \[bu] 2
Better BibTeX (https://retorque.re/zotero-better-bibtex/)
.PP
pandoc(1)
.SH AUTHORS
Odin Kroeger.
