<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<head>
    <title>Reference</title>
    <link rel="stylesheet" href="ldoc.css" type="text/css" />
</head>
<body>

<div id="container">

<div id="product">
	<div id="product_logo"></div>
	<div id="product_name"><big><b></b></big></div>
	<div id="product_description"></div>
</div> <!-- id="product" -->


<div id="main">


<!-- Menu -->

<div id="navigation">
<br/>
<h1>pandoc-zotxt.lua</h1>


<h2>Contents</h2>
<ul>
<li><a href="#Metadata">Metadata</a></li>
<li><a href="#File_I_O">File I/O</a></li>
<li><a href="#Warnings">Warnings</a></li>
<li><a href="#Table_manipulation">Table manipulation</a></li>
<li><a href="#Networking">Networking</a></li>
<li><a href="#Converters">Converters</a></li>
<li><a href="#zotxt">zotxt</a></li>
<li><a href="#Bibliography_files">Bibliography files</a></li>
<li><a href="#Document_parsing">Document parsing</a></li>
<li><a href="#Main">Main</a></li>
</ul>


<h2>Scripts</h2>
<ul class="nowrap">
  <li><strong>pandoc-zotxt.lua</strong></li>
</ul>
<h2>Topics</h2>
<ul class="">
  <li><a href="topics/README.md.html">README</a></li>
</ul>

</div>

<div id="content">

<h1>Script <code>pandoc-zotxt.lua</code></h1>
<p><h2>SYNOPSIS</h2>

<p> <strong>pandoc</strong> <strong>-L</strong> <em>pandoc-zotxt.lua</em> <strong>-C</strong></p>

<h2> DESCRIPTION</h2>

<p> <strong>pandoc-zotxt.lua</strong> looks up sources of citations in Zotero and adds
 them either to a document&rsquo;s &ldquo;references&rdquo; metadata field or to a
 bibliography file, where Pandoc can pick them up.</p></p>
<p> Cite your sources using &ldquo;easy citekeys&rdquo; (provided by <em>zotxt</em>) or
 &ldquo;Better BibTeX Citation Keys&rdquo; (provided by Better BibTeX for Zotero).
 Then tell <strong>pandoc</strong> to filter your document through <strong>pandoc-zotxt.lua</strong>
 before processing citations. That&rsquo;s all there is to it.
 Zotero bust be running, of course.</p>

<p> <strong>pandoc-zotxt.lua</strong> only fetches sources from Zotero that are defined
 neither in the &ldquo;references&rdquo; metadata field nor in any bibliography file.</p>

<h2> BIBLIOGRAPHY FILES</h2>

<p> <strong>pandoc-zotxt.lua</strong> can add sources to a special bibliography file,
 rather than to the &ldquo;references&rdquo; metadata field. This speeds up subsequent
 processing of the same document, because sources that are already in that
 file need not be fetched from Zotero again.</p>

<p> You configure <strong>pandoc-zotxt.lua</strong> to add sources to a bibliography file by
 setting the &ldquo;zotero-bibliography&rdquo; metadata field to a filename. If the
 filename is relative, it is interpreted as relative to the directory of the
 first input file passed to <strong>pandoc</strong> or, if no input file was given, as
 relative to the current working directory. The format of the file is
 determined by its filename ending:</p>

<table>
<thead>
<tr>
<th><strong>Ending</strong> </th>
<th> <strong>Format</strong> </th>
<th> <strong>Feature</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>.json</code>    </td>
<td> CSL JSON   </td>
<td> More robust.</td>
</tr>
<tr>
<td><code>.yaml</code>    </td>
<td> CSL YAML   </td>
<td> Easier to edit manually.</td>
</tr>
</tbody>
</table>


<p> The bibliography file is added to the &ldquo;bibliography&rdquo; metadata field
 automatically. You can safely set &ldquo;zotero-bibliography&rdquo; and &ldquo;bibliography&rdquo;
 at the same time.</p>

<p> The sources in the bibliography file are neither updated nor deleted.
 If you want to update the file, delete it.</p>

<h2> EXAMPLE</h2>

<pre>
pandoc -L pandoc-zotxt.lua -C &lt;&lt;EOF
See @doe2020Title <span class="keyword">for</span> details.
EOF
</pre>


<p> This will look up &ldquo;doe2020Title&rdquo; in Zotero.</p>

<h2> KNOWN ISSUES</h2>

<p> Zotero v5.0.71 and v5.0.72 fail to handle HTTP requests from user agents
 that do not set the &ldquo;User Agent&rdquo; HTTP header. And <strong>pandoc</strong> does not.
 As a consequence, <strong>pandoc-zotxt.lua</strong> cannot retrieve data from these
 versions of Zotero unless you tell <strong>pandoc</strong> to set that header.</p>

<h2> CAVEATS</h2>

<p> <strong>pandoc-zotxt.lua</strong> is Unicode-agnostic.</p>

<h2> SEE ALSO</h2>

<ul>
<li><a href="https://github.com/egh/zotxt">zotxt</a></li>
<li><a href="https://retorque.re/zotero-better-bibtex/">Better BibTeX</a></li>
</ul>


<p> pandoc(1)</p>
    <h3>Info:</h3>
    <ul>
        <li><strong>Copyright</strong>: 2018, 2019, 2020, 2021 Odin Kroeger</li>
        <li><strong>Release</strong>: 1.1.0b3</li>
        <li><strong>License</strong>: MIT</li>
        <li><strong>Author</strong>: Odin Kroeger</li>
    </ul>


<h2><a href="#Metadata">Metadata</a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#NAME">NAME</a></td>
	<td class="summary">The name of this script.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#VERSION">VERSION</a></td>
	<td class="summary">The version of this script.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#SCPT_DIR">SCPT_DIR</a></td>
	<td class="summary">The directory the script is in.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#SCPT_NAME">SCPT_NAME</a></td>
	<td class="summary">The filename of the script.</td>
	</tr>
</table>
<h2><a href="#File_I_O">File I/O</a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#PATH_SEP">PATH_SEP</a></td>
	<td class="summary">The path segment seperator of the OS.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#EOL">EOL</a></td>
	<td class="summary">The end of line sequence of the OS.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#path_split">path_split (path)</a></td>
	<td class="summary">Split a file&rsquo;s path into a directory and a filename part.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#path_join">path_join (...)</a></td>
	<td class="summary">Join multiple path segments.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#path_is_abs">path_is_abs (path)</a></td>
	<td class="summary">Check whether a path is absolute.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#wd">wd ()</a></td>
	<td class="summary">Get a directory to use as working directory.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#file_exists">file_exists (fname)</a></td>
	<td class="summary">Check whether a filename refers to a file.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#file_locate">file_locate (fname)</a></td>
	<td class="summary">Locate a file in Pandoc&rsquo;s resource path.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#file_read">file_read (fname)</a></td>
	<td class="summary">Read a file.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#file_write">file_write (fname, ...)</a></td>
	<td class="summary">Write data to a file.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#tmp_fname">tmp_fname ([dir[, templ='tmp-XXXXXXXXXX']])</a></td>
	<td class="summary">Generate a name for a temporary file.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#tmp_file">tmp_file (...)</a></td>
	<td class="summary">Create a temporary file.</td>
	</tr>
</table>
<h2><a href="#Warnings">Warnings</a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#errf">errf (msg, ...)</a></td>
	<td class="summary">Print an error message to STDERR.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#warnf">warnf (...)</a></td>
	<td class="summary">Print a warning to STDERR.</td>
	</tr>
</table>
<h2><a href="#Table_manipulation">Table manipulation</a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#keys">keys (tab)</a></td>
	<td class="summary">Return the keys and the length of a table.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#copy">copy (data)</a></td>
	<td class="summary">Copy a data tree.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#rmap">rmap (func, data)</a></td>
	<td class="summary">Recursively apply a function to every value of a tree.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#lower_keys">lower_keys (tab)</a></td>
	<td class="summary">Recursively convert table keys to lowercase.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#sorted_pairs">sorted_pairs (tab[, func])</a></td>
	<td class="summary">Iterate over the keys of a table in a given order.</td>
	</tr>
</table>
<h2><a href="#Networking">Networking</a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#url_read">url_read (url)</a></td>
	<td class="summary">Retrieve data from a URL via an HTTP GET request.</td>
	</tr>
</table>
<h2><a href="#Converters">Converters</a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#esc_md">esc_md (str)</a></td>
	<td class="summary">Escape Markdown.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#markdownify">markdownify (elem)</a></td>
	<td class="summary">Convert a Pandoc element to Markdown text.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#yamlify">yamlify (data[, ind=4[, sort_f]])</a></td>
	<td class="summary">Generate a YAML representation of some data.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#html_to_md">html_to_md (html)</a></td>
	<td class="summary">Convert Zotero pseudo-HTML to Markdown.</td>
	</tr>
</table>
<h2><a href="#zotxt">zotxt</a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#ZOTXT_BASE_URL">ZOTXT_BASE_URL</a></td>
	<td class="summary">The <a href="https://github.com/egh/zotxt">zotxt</a> endpoint.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#ZOTXT_KEYTYPES">ZOTXT_KEYTYPES</a></td>
	<td class="summary">Types of citation keys <a href="https://github.com/egh/zotxt">zotxt</a> supports.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#zotxt_csl_item">zotxt_csl_item (id)</a></td>
	<td class="summary">Retrieve a source from Zotero as CSL item.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#zotxt_source">zotxt_source (id)</a></td>
	<td class="summary">Retrieve a source from Zotero as Pandoc metadata.</td>
	</tr>
</table>
<h2><a href="#Bibliography_files">Bibliography files</a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#CSL_KEY_ORDER">CSL_KEY_ORDER</a></td>
	<td class="summary">The preferred order of keys in YAML bibliography files.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#BIBLIO_TYPES">BIBLIO_TYPES</a></td>
	<td class="summary">A mapping of filename suffices to codecs.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#BIBLIO_TYPES.bib">BIBLIO_TYPES.bib</a></td>
	<td class="summary">Decode BibLaTeX.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#BIBLIO_TYPES.bib.decode">BIBLIO_TYPES.bib.decode (str)</a></td>
	<td class="summary">Read the IDs from the content of a BibLaTeX file.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#BIBLIO_TYPES.bibtex">BIBLIO_TYPES.bibtex</a></td>
	<td class="summary">Decode BibTeX.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#BIBLIO_TYPES.bibtex">BIBLIO_TYPES.bibtex</a></td>
	<td class="summary">Read the IDs from the content of a BibTeX file.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#BIBLIO_TYPES.json">BIBLIO_TYPES.json</a></td>
	<td class="summary">De-/Encode CSL items in JSON.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#BIBLIO_TYPES.yaml">BIBLIO_TYPES.yaml</a></td>
	<td class="summary">De-/Encode CSL items in YAML.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#BIBLIO_TYPES.yaml.decode">BIBLIO_TYPES.yaml.decode (str)</a></td>
	<td class="summary">Parse a CSL YAML string.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#BIBLIO_TYPES.yaml.encode">BIBLIO_TYPES.yaml.encode (items)</a></td>
	<td class="summary">Serialise a list of CSL items to a YAML string.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#BIBLIO_TYPES.yml">BIBLIO_TYPES.yml</a></td>
	<td class="summary">Alternative suffix for YAML files.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#csl_keys_sort">csl_keys_sort (a, b)</a></td>
	<td class="summary">Sorting function for CSL field names.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#csl_items_sort">csl_items_sort (a, b)</a></td>
	<td class="summary">Sorting function for CSL items.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#csl_items_ids">csl_items_ids (items)</a></td>
	<td class="summary">Pick the IDs of CSL items out of a list of CSL items.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#biblio_read">biblio_read (fname)</a></td>
	<td class="summary">Read a bibliography file.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#biblio_write">biblio_write (fname[, items])</a></td>
	<td class="summary">Write sources to a bibliography file.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#biblio_update">biblio_update (fname, ids)</a></td>
	<td class="summary">Add items from Zotero to a bibliography file.</td>
	</tr>
</table>
<h2><a href="#Document_parsing">Document parsing</a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#elem_type">elem_type (elem)</a></td>
	<td class="summary">The type of a Pandoc AST element.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#walk">walk (elem, filter)</a></td>
	<td class="summary">Walk the AST and apply functions to matching elements.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#meta_sources">meta_sources (meta)</a></td>
	<td class="summary">Collect sources from the document&rsquo;s metadata block.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#doc_ckeys">doc_ckeys (doc[, flags])</a></td>
	<td class="summary">Collect the citation keys used in a document.</td>
	</tr>
</table>
<h2><a href="#Main">Main</a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#add_biblio">add_biblio (meta, ckeys)</a></td>
	<td class="summary">Add sources to a bibliography file and the file to the document&rsquo;s metadata.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#add_refs">add_refs (meta, ckeys)</a></td>
	<td class="summary">Add sources to the <code>references</code> metadata field.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#main">main (doc)</a></td>
	<td class="summary">Collect sources and adds bibliographic data to a document.</td>
	</tr>
</table>

<br/>
<br/>


    <h2 class="section-header "><a name="Metadata"></a>Metadata</h2>

    <dl class="function">
    <dt>
    <a name = "NAME"></a>
    <strong>NAME</strong>
    </dt>
    <dd>
    The name of this script.







</dd>
    <dt>
    <a name = "VERSION"></a>
    <strong>VERSION</strong>
    </dt>
    <dd>
    The version of this script.







</dd>
    <dt>
    <a name = "SCPT_DIR"></a>
    <strong>SCPT_DIR</strong>
    </dt>
    <dd>
    The directory the script is in.







</dd>
    <dt>
    <a name = "SCPT_NAME"></a>
    <strong>SCPT_NAME</strong>
    </dt>
    <dd>
    The filename of the script.







</dd>
</dl>
    <h2 class="section-header "><a name="File_I_O"></a>File I/O</h2>

    <dl class="function">
    <dt>
    <a name = "PATH_SEP"></a>
    <strong>PATH_SEP</strong>
    </dt>
    <dd>
    The path segment seperator of the OS.







</dd>
    <dt>
    <a name = "EOL"></a>
    <strong>EOL</strong>
    </dt>
    <dd>
    The end of line sequence of the OS.







</dd>
    <dt>
    <a name = "path_split"></a>
    <strong>path_split (path)</strong>
    </dt>
    <dd>
    Split a file&rsquo;s path into a directory and a filename part.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">path</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         The file&rsquo;s path.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        The directory the file is in.</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        The file&rsquo;s name.</li>
    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <code>nil</code> if <code>path</code> is the empty string (&lsquo;&rsquo;).</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        An error message.</li>
    </ol>

    <h3>Raises:</h3>
    An error if the path is the empty string.



</dd>
    <dt>
    <a name = "path_join"></a>
    <strong>path_join (...)</strong>
    </dt>
    <dd>
    Join multiple path segments.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">...</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         Path segments.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        The complete path.
    </ol>

    <h3>Raises:</h3>
    An error if no path segments are given or if
  a path segment is the empty string (&lsquo;&rsquo;).



</dd>
    <dt>
    <a name = "path_is_abs"></a>
    <strong>path_is_abs (path)</strong>
    </dt>
    <dd>
    Check whether a path is absolute.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">path</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         A path.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">bool</span></span>
        <code>true</code> if the path is absolute, <code>false</code> otherwise.
    </ol>

    <h3>Raises:</h3>
    An error if the path is the empty string (&lsquo;&rsquo;).



</dd>
    <dt>
    <a name = "wd"></a>
    <strong>wd ()</strong>
    </dt>
    <dd>
    Get a directory to use as working directory.



    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        The directory of the first input file
  or &lsquo;.&rsquo; if none was given.
    </ol>




</dd>
    <dt>
    <a name = "file_exists"></a>
    <strong>file_exists (fname)</strong>
    </dt>
    <dd>
    Check whether a filename refers to a file.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">fname</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         The filename.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">boolean</span></span>
        <code>true</code> if the file exists.
    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <code>nil</code> if the file does not exist.</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        An error message.</li>
        <li>
           <span class="types"><span class="type">int</span></span>
        The error number 2.</li>
    </ol>




</dd>
    <dt>
    <a name = "file_locate"></a>
    <strong>file_locate (fname)</strong>
    </dt>
    <dd>
    Locate a file in Pandoc&rsquo;s resource path.</p>

<p> Absolute filenames are returned as they are.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">fname</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         A filename.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        A filename.
    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <code>nil</code> if the file could not be found.</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        An error message.</li>
    </ol>




</dd>
    <dt>
    <a name = "file_read"></a>
    <strong>file_read (fname)</strong>
    </dt>
    <dd>
    Read a file.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">fname</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         The name of the file.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        The content of the file.
    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <code>nil</code> if an error occurred.</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        An error message.</li>
        <li>
           <span class="types"><span class="type">int</span></span>
        An error number.</li>
    </ol>




</dd>
    <dt>
    <a name = "file_write"></a>
    <strong>file_write (fname, ...)</strong>
    </dt>
    <dd>
    Write data to a file.</p>

<p> The data is first written to a temporary file,
 that file is then renamed to the given name.
 If the file exists, it is overwritten.
 Tries to print a warning to STDERR if that happens


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">fname</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         The name of the file.
        </li>
        <li><span class="parameter">...</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         The data.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">bool</span></span>
        <code>true</code> if the data was written to the given file.
    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <code>nil</code> if an error occurred.</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        An error message.</li>
        <li>
           <span class="types"><span class="type">int</span></span>
        An error number.</li>
    </ol>




</dd>
    <dt>
    <a name = "tmp_fname"></a>
    <strong>tmp_fname ([dir[, templ='tmp-XXXXXXXXXX']])</strong>
    </dt>
    <dd>
    Generate a name for a temporary file.</p>

<p> Tries to make sure that there is no file with that name already.
 This is subject to race conditions.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">dir</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         A directory to prefix the filename with.
  Cannot be the empty string (&lsquo;&rsquo;).
         (<em>optional</em>)
        </li>
        <li><span class="parameter">templ</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         A template for the filename.
  &lsquo;X&rsquo;s are replaced with random alphanumeric characters.
  Must contain at least six 'X&rsquo;s.
         (<em>default</em> 'tmp-XXXXXXXXXX')
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        A filename.
    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <code>nil</code> if the generated filename is in use.</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        An error message.</li>
    </ol>

    <h3>Raises:</h3>
    An error if the template or the directory is
  not a string or the empty string (&lsquo;&rsquo;).



</dd>
    <dt>
    <a name = "tmp_file"></a>
    <strong>tmp_file (...)</strong>
    </dt>
    <dd>
    Create a temporary file.</p>

<p> The temporary file is removed when its file handle/filename pair is
 garbage-collected. If the file should <em>not</em> be removed, set <code>fname</code>
 to <code>nil</code>. Prints errors that occur during garbage collection to STDERR.
 If you call <a href="https://www.lua.org/manual/5.1/manual.html#pdf-os.exit">os.exit</a> tell it to close the Lua state, so that Lua runs
 the garbage collector before exiting the script.</p>

<p> Tries not to overwrite existing files. This is subject to race
 conditions. There is no Lua equivalent to <code>O_CREAT | O_EXCL</code>.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">...</span>
         Takes the same arguments as <a href="index.html#tmp_fname">tmp_fname</a>.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">{file=FILE*,fname=string}</span></span>
        A file handle/filename pair.
    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <code>nil</code> if an error occurs.</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        An error message.</li>
        <li>
           <span class="types">optional <span class="type">int</span></span>
        An error number if the error is an I/O error.</li>
    </ol>

    <h3>Raises:</h3>
    See <a href="index.html#tmp_fname">tmp_fname</a>.


    <h3>Usage:</h3>
    <ul>
        <pre class="example"><span class="keyword">do</span>
    <span class="keyword">local</span> tmp, ok, err
    <span class="comment">-- Create the file.
</span>    tmp, err = tmp_file()
    <span class="keyword">if</span> tmp <span class="keyword">then</span>
        ok, err = tmp.file:write(data)
        <span class="keyword">if</span> ok <span class="keyword">then</span> ok, err = tmp.file:close() <span class="keyword">end</span>
        <span class="keyword">if</span> ok <span class="keyword">then</span> ok, err = <span class="global">os</span>.rename(tmp.fname, fname) <span class="keyword">end</span>
        <span class="keyword">if</span> ok <span class="keyword">then</span>
            <span class="comment">-- Disable deletion (which would fail).
</span>            tmp.fname = <span class="keyword">nil</span>
        <span class="keyword">else</span>
            <span class="global">print</span>(err)
        <span class="keyword">end</span>
    <span class="keyword">else</span>
        <span class="global">print</span>(err)
    <span class="keyword">end</span>
<span class="keyword">end</span>
<span class="comment">-- If <code>tmp.fname</code> has not been set to nil, then the garbage
</span><span class="comment">-- collector deletes the file after (not "at") this point.</span></pre>
    </ul>

</dd>
</dl>
    <h2 class="section-header "><a name="Warnings"></a>Warnings</h2>

    <dl class="function">
    <dt>
    <a name = "errf"></a>
    <strong>errf (msg, ...)</strong>
    </dt>
    <dd>
    Print an error message to STDERR.</p>

<p> Prefixes the message with <a href="index.html#SCPT_NAME">SCPT_NAME</a> and &lsquo;: &rsquo;, and appends <a href="index.html#EOL">EOL</a>.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">msg</span>
         The message. Coerced to <a href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a>.
        </li>
        <li><span class="parameter">...</span>
         Arguments to that message (think <a href="https://www.lua.org/manual/5.1/manual.html#pdf-string.format">string.format</a>).
  Only applied if <code>msg</code> is a <a href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a>.
        </li>
    </ul>





</dd>
    <dt>
    <a name = "warnf"></a>
    <strong>warnf (...)</strong>
    </dt>
    <dd>
    Print a warning to STDERR.</p>

<p> Only prints values if <code>PANDOC_STATE.verbosity</code> is <em>not</em> &lsquo;ERROR&rsquo;.
 Otherwise the same as <a href="index.html#errf">errf</a>.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">...</span>
         Takes the same arguments as <a href="index.html#errf">errf</a>.
        </li>
    </ul>





</dd>
</dl>
    <h2 class="section-header "><a name="Table_manipulation"></a>Table manipulation</h2>

    <dl class="function">
    <dt>
    <a name = "keys"></a>
    <strong>keys (tab)</strong>
    </dt>
    <dd>
    Return the keys and the length of a table.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">tab</span>
            <span class="types"><span class="type">tab</span></span>
         The table.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>
        <li>
           <span class="types"><span class="type">tab</span></span>
        The keys of <code>tab</code>.</li>
        <li>
           <span class="types"><span class="type">int</span></span>
        <code>tab</code>&rsquo;s length.</li>
    </ol>




</dd>
    <dt>
    <a name = "copy"></a>
    <strong>copy (data)</strong>
    </dt>
    <dd>
    Copy a data tree.</p>

<p> Handles metatables, recursive structures, tables as keys, and
 avoids the <code>__pairs</code> and <code>__newindex</code> metamethods.
 Copies are deep.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">data</span>
         Arbitrary data.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

        A deep copy of <code>data</code>.
    </ol>



    <h3>Usage:</h3>
    <ul>
        <pre class="example">&gt; x = {<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>}
&gt; y = {x, <span class="number">4</span>}
&gt; c = copy(y)
&gt; <span class="global">table</span>.insert(x, <span class="number">4</span>)
&gt; <span class="global">table</span>.<span class="global">unpack</span>(c[<span class="number">1</span>])
<span class="number">1</span>       <span class="number">2</span>       <span class="number">3</span></pre>
    </ul>

</dd>
    <dt>
    <a name = "rmap"></a>
    <strong>rmap (func, data)</strong>
    </dt>
    <dd>
    Recursively apply a function to every value of a tree.</p>

<p> The function is applied to <em>every</em> node of the data tree.
 The tree is parsed bottom-up.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">func</span>
            <span class="types"><span class="type">func</span></span>
         A function that takes a value and returns a new one.
  If the function returns <code>nil</code>, the original value is kept.
        </li>
        <li><span class="parameter">data</span>
         A data tree.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

        <code>data</code> with <code>func</code> applied.
    </ol>

    <h3>Raises:</h3>
    An error if the data is nested too deeply.



</dd>
    <dt>
    <a name = "lower_keys"></a>
    <strong>lower_keys (tab)</strong>
    </dt>
    <dd>
    Recursively convert table keys to lowercase.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">tab</span>
            <span class="types"><span class="type">tab</span></span>
         The table.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

        A copy of <code>tab</code> with keys in lowercase.
    </ol>

    <h3>Raises:</h3>
    An error if the data is nested too deeply.



</dd>
    <dt>
    <a name = "sorted_pairs"></a>
    <strong>sorted_pairs (tab[, func])</strong>
    </dt>
    <dd>
    Iterate over the keys of a table in a given order.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">tab</span>
            <span class="types"><span class="type">tab</span></span>
         A table.
        </li>
        <li><span class="parameter">func</span>
            <span class="types"><span class="type">func</span></span>
         A sorting function.
  If no function is given, sorts by number.
         (<em>optional</em>)
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">func</span></span>
        A <em>stateful</em> iterator over <code>tab</code>.
    </ol>




</dd>
</dl>
    <h2 class="section-header "><a name="Networking"></a>Networking</h2>

    <dl class="function">
    <dt>
    <a name = "url_read"></a>
    <strong>url_read (url)</strong>
    </dt>
    <dd>
    Retrieve data from a URL via an HTTP GET request.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">url</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         The URL.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        The MIME type of the HTTP content.</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        The HTTP content itself.</li>
    </ol>

    <h3>Raises:</h3>
    An error if no data can be retrieved.
  This error can only be caught since Pandoc v2.11.



</dd>
</dl>
    <h2 class="section-header "><a name="Converters"></a>Converters</h2>

    <dl class="function">
    <dt>
    <a name = "esc_md"></a>
    <strong>esc_md (str)</strong>
    </dt>
    <dd>
    Escape Markdown.</p>

<p> Only escapes <a href="https://pandoc.org/MANUAL.html#specifying-bibliographic-data">Markdown that Pandoc recognises in bibliographic
 data</a>.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">str</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         A string.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        <code>str</code> with Markdown escaped.
    </ol>




</dd>
    <dt>
    <a name = "markdownify"></a>
    <strong>markdownify (elem)</strong>
    </dt>
    <dd>
    Convert a Pandoc element to Markdown text.</p>

<p> Only recognises <a href="https://pandoc.org/MANUAL.html#specifying-bibliographic-data">elements Pandoc permits in bibliographic
 data</a>.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">elem</span>
            <span class="types"><span class="type">pandoc.AstElement</span></span>
         A Pandoc AST element.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        Markdown text.
    </ol>




</dd>
    <dt>
    <a name = "yamlify"></a>
    <strong>yamlify (data[, ind=4[, sort_f]])</strong>
    </dt>
    <dd>
    Generate a YAML representation of some data.</p>

<p> Uses <a href="index.html#EOL">EOL</a> to end lines.
 Only parses UTF-8 encoded strings.
 Strings in other encodings will be mangled.
 Does <em>not</em> escape <em>all</em> non-printable characters (because Unicode).


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">data</span>
         The data.
        </li>
        <li><span class="parameter">ind</span>
            <span class="types"><span class="type">int</span></span>
         How many spaces to indent blocks.
         (<em>default</em> 4)
        </li>
        <li><span class="parameter">sort_f</span>
            <span class="types"><span class="type">func</span></span>
         A function to sort keys of mappings.
  Defaults to sorting them lexically.
         (<em>optional</em>)
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        A YAML string.
    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <code>nil</code> if the data cannot be represented in YAML.</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        An error message.</li>
    </ol>

    <h3>Raises:</h3>
    An error if the data cannot be expressed in YAML
  or is nested too deeply.



</dd>
    <dt>
    <a name = "html_to_md"></a>
    <strong>html_to_md (html)</strong>
    </dt>
    <dd>
    Convert Zotero pseudo-HTML to Markdown.</p>

<p> Only supports <a href="https://pandoc.org/MANUAL.html#specifying-bibliographic-data">pseudo-HTML that Pandoc recognises in bibliographic
 data</a>.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">html</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         Pseudo-HTML code.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        Text formatted in Markdown.
    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <code>nil</code> if <code>html</code> is not a <a href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a>.</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        An error message.</li>
    </ol>




</dd>
</dl>
    <h2 class="section-header "><a name="zotxt"></a>zotxt</h2>

    <dl class="function">
    <dt>
    <a name = "ZOTXT_BASE_URL"></a>
    <strong>ZOTXT_BASE_URL</strong>
    </dt>
    <dd>
    The <a href="https://github.com/egh/zotxt">zotxt</a> endpoint.







</dd>
    <dt>
    <a name = "ZOTXT_KEYTYPES"></a>
    <strong>ZOTXT_KEYTYPES</strong>
    </dt>
    <dd>
    Types of citation keys <a href="https://github.com/egh/zotxt">zotxt</a> supports.


    <h3>Fields:</h3>
    <ul>
        <li><span class="parameter">key</span>
        Zotero item ID
        </li>
        <li><span class="parameter">betterbibtexkey</span>
        Better BibTeX citation key
        </li>
        <li><span class="parameter">easykey</span>
        zotxt easy citekey
        </li>
    </ul>





</dd>
    <dt>
    <a name = "zotxt_csl_item"></a>
    <strong>zotxt_csl_item (id)</strong>
    </dt>
    <dd>
    Retrieve a source from Zotero as CSL item.</p>

<p> Returns bibliographic data as a Lua table. That table can be
 passed to <a href="index.html#biblio_write">biblio_write</a>; it should <em>not</em> be used in the <code>references</code>
 metadata field (unless you are using Pandoc prior to v2.11).


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">id</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         An item ID, e.g., &lsquo;name:2019word&rsquo;, &lsquo;name2019TwoWords&rsquo;.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
        A CSL item.
    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <code>nil</code> if an error occurred.</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        An error message.</li>
    </ol>

    <h3>Raises:</h3>
     An error if the data retrieved from <em>zotxt</em> is <em>not</em> encoded
  in UTF-8 or if no data can be retrieved from <em>zotxt</em> at all.
  The latter error can only be caught since Pandoc v2.11.



</dd>
    <dt>
    <a name = "zotxt_source"></a>
    <strong>zotxt_source (id)</strong>
    </dt>
    <dd>
    Retrieve a source from Zotero as Pandoc metadata.</p>

<p> Returns bibliographic data as a Pandoc metadata value. That value
 can be used in the <code>references</code> metadata field; it should <em>not</em> be
 passed to <a href="index.html#biblio_write">biblio_write</a>.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">id</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         An item ID, e.g., &lsquo;name:2019word&rsquo;, &lsquo;name2019TwoWords&rsquo;.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">pandoc.MetaMap</span></span>
        Bibliographic data for that source.
    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <code>nil</code> if an error occurred.</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        An error message.</li>
    </ol>

    <h3>Raises:</h3>
    See <a href="index.html#zotxt_csl_item">zotxt_csl_item</a>.



</dd>
</dl>
    <h2 class="section-header "><a name="Bibliography_files"></a>Bibliography files</h2>

    <dl class="function">
    <dt>
    <a name = "CSL_KEY_ORDER"></a>
    <strong>CSL_KEY_ORDER</strong>
    </dt>
    <dd>
    The preferred order of keys in YAML bibliography files.</p>

<p> <a href="https://docs.citationstyles.org/en/stable/specification.html#appendix-iv-variables">Appendix IV</a>
 of the CSL specification lists all field names.


    <h3>Fields:</h3>
    <ul>
        <li><span class="parameter">id</span>
        Item ID.
        </li>
        <li><span class="parameter">type</span>
        For example, &lsquo;paper&rsquo;, &lsquo;book&rsquo;.
        </li>
        <li><span class="parameter">author</span>
        Author(s).
        </li>
        <li><span class="parameter">recipient</span>
        Recipient of the document.
        </li>
        <li><span class="parameter">status</span>
        Publication status (e.g., &lsquo;forthcoming&rsquo;).
        </li>
        <li><span class="parameter">issued</span>
        When the item was published.
        </li>
        <li><span class="parameter">title</span>
        The title.
        </li>
        <li><span class="parameter">title-short</span>
        A short version of the title.
        </li>
        <li><span class="parameter">short-title</span>
        Ditto.
        </li>
        <li><span class="parameter">original-title</span>
        Original title.
        </li>
        <li><span class="parameter">translator</span>
        Translator(s).
        </li>
        <li><span class="parameter">editor</span>
        The editor(s).
        </li>
        <li><span class="parameter">container-title</span>
        Publication the item was published in.
        </li>
        <li><span class="parameter">container-title-short</span>
        A short version of that title.
        </li>
        <li><span class="parameter">collection-editor</span>
        E.g., the series editor(s).
        </li>
        <li><span class="parameter">collection-title</span>
        E.g., a series.
        </li>
        <li><span class="parameter">collection-title-short</span>
        A short version of the title.
        </li>
        <li><span class="parameter">edition</span>
        Container&rsquo;s edition.
        </li>
        <li><span class="parameter">volume</span>
        Volume no.
        </li>
        <li><span class="parameter">issue</span>
        Issue no.
        </li>
        <li><span class="parameter">page-first</span>
        First page.
        </li>
        <li><span class="parameter">page</span>
        Pages or page range <em>or</em> number of pages.
        </li>
        <li><span class="parameter">publisher</span>
        Publisher.
        </li>
        <li><span class="parameter">publisher-place</span>
        City/cities the item was published in.
        </li>
        <li><span class="parameter">original-publisher</span>
        Original publisher.
        </li>
        <li><span class="parameter">original-publisher-place</span>
        Place the item was originally published in.
        </li>
        <li><span class="parameter">doi</span>
        The DOI.
        </li>
        <li><span class="parameter">pmcid</span>
        PubMed Central reference number.
        </li>
        <li><span class="parameter">pmid</span>
        PubMed reference number.
        </li>
        <li><span class="parameter">url</span>
        The URL.
        </li>
        <li><span class="parameter">accessed</span>
        When the URL was last accessed.
        </li>
        <li><span class="parameter">isbn</span>
        The ISBN of the item.
        </li>
        <li><span class="parameter">issn</span>
        The ISSN of the container.
        </li>
        <li><span class="parameter">call-number</span>
        Call number (of a library).
        </li>
        <li><span class="parameter">language</span>
        Language the item is in.
        </li>
        <li><span class="parameter">abstract</span>
        The abstract.
        </li>
    </ul>



    <h3>See also:</h3>
    <ul>
         <a href="index.html#csl_keys_sort">csl_keys_sort</a>
    </ul>


</dd>
    <dt>
    <a name = "BIBLIO_TYPES"></a>
    <strong>BIBLIO_TYPES</strong>
    </dt>
    <dd>
    A mapping of filename suffices to codecs.</p>

<p> If a key is not found, it is looked up again in lowercase.







</dd>
    <dt>
    <a name = "BIBLIO_TYPES.bib"></a>
    <strong>BIBLIO_TYPES.bib</strong>
    </dt>
    <dd>
    Decode BibLaTeX.







</dd>
    <dt>
    <a name = "BIBLIO_TYPES.bib.decode"></a>
    <strong>BIBLIO_TYPES.bib.decode (str)</strong>
    </dt>
    <dd>
    Read the IDs from the content of a BibLaTeX file.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">str</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         The content of a BibLaTeX file.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">{{id=string},...}</span></span>
        A list of item IDs.
    </ol>




</dd>
    <dt>
    <a name = "BIBLIO_TYPES.bibtex"></a>
    <strong>BIBLIO_TYPES.bibtex</strong>
    </dt>
    <dd>
    Decode BibTeX.







</dd>
    <dt>
    <a name = "BIBLIO_TYPES.bibtex"></a>
    <strong>BIBLIO_TYPES.bibtex</strong>
    </dt>
    <dd>
    Read the IDs from the content of a BibTeX file.


    <ul>
        <li><span class="parameter">str</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         The content of a BibTeX file.
        </li>
    </ul>





</dd>
    <dt>
    <a name = "BIBLIO_TYPES.json"></a>
    <strong>BIBLIO_TYPES.json</strong>
    </dt>
    <dd>
    De-/Encode CSL items in JSON.







</dd>
    <dt>
    <a name = "BIBLIO_TYPES.yaml"></a>
    <strong>BIBLIO_TYPES.yaml</strong>
    </dt>
    <dd>
    De-/Encode CSL items in YAML.







</dd>
    <dt>
    <a name = "BIBLIO_TYPES.yaml.decode"></a>
    <strong>BIBLIO_TYPES.yaml.decode (str)</strong>
    </dt>
    <dd>
    Parse a CSL YAML string.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">str</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         A CSL YAML string.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">tab</span></span>
        A list of CSL items.
    </ol>




</dd>
    <dt>
    <a name = "BIBLIO_TYPES.yaml.encode"></a>
    <strong>BIBLIO_TYPES.yaml.encode (items)</strong>
    </dt>
    <dd>
    Serialise a list of CSL items to a YAML string.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">items</span>
            <span class="types"><span class="type">tab</span></span>
         A list of CSL items.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        A CSL YAML string.
    </ol>

    <h3>Raises:</h3>
    See <a href="index.html#yamlify">yamlify</a>.



</dd>
    <dt>
    <a name = "BIBLIO_TYPES.yml"></a>
    <strong>BIBLIO_TYPES.yml</strong>
    </dt>
    <dd>
    Alternative suffix for YAML files.







</dd>
    <dt>
    <a name = "csl_keys_sort"></a>
    <strong>csl_keys_sort (a, b)</strong>
    </dt>
    <dd>
    Sorting function for CSL field names.</p>

<p> Sorts field in the order in which they are listed in <a href="index.html#CSL_KEY_ORDER">CSL_KEY_ORDER</a>.
 Unlisted fields are placed after listed ones in lexical order.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">a</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         A CSL fieldname.
        </li>
        <li><span class="parameter">b</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         Another CSL fieldname.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">bool</span></span>
        Whether <code>a</code> should come before <code>b</code>.
    </ol>




</dd>
    <dt>
    <a name = "csl_items_sort"></a>
    <strong>csl_items_sort (a, b)</strong>
    </dt>
    <dd>
    Sorting function for CSL items.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">a</span>
            <span class="types"><span class="type">tab</span></span>
         A CSL item.
        </li>
        <li><span class="parameter">b</span>
            <span class="types"><span class="type">tab</span></span>
         Another CSL item.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">bool</span></span>
        Whether <code>a</code> should come before <code>b</code>.
    </ol>




</dd>
    <dt>
    <a name = "csl_items_ids"></a>
    <strong>csl_items_ids (items)</strong>
    </dt>
    <dd>
    Pick the IDs of CSL items out of a list of CSL items.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">items</span>
            <span class="types"><span class="type">tab</span></span>
         A list of CSL items.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">{[string]=true,...}</a></span>
        A <a href="https://www.lua.org/pil/11.5.html">set</a>
  of item IDs.
    </ol>

    <h3>Raises:</h3>
    An error if an item has an ID that cannot be coerced to a string.



</dd>
    <dt>
    <a name = "biblio_read"></a>
    <strong>biblio_read (fname)</strong>
    </dt>
    <dd>
    Read a bibliography file.</p>

<p> The filename suffix determines what format the contents of the file are
 parsed as. There must be a decoder for that suffix in <a href="index.html#BIBLIO_TYPES">BIBLIO_TYPES</a>.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">fname</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         The filename.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">tab</span></span>
        A list of CSL items.
    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <code>nil</code> if an error occurred.</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        An error message.</li>
        <li>
           <span class="types">optional <span class="type">int</span></span>
        An error number if the error is an I/O error.</li>
    </ol>




</dd>
    <dt>
    <a name = "biblio_write"></a>
    <strong>biblio_write (fname[, items])</strong>
    </dt>
    <dd>
    Write sources to a bibliography file.</p>

<p> The filename suffix determins what format the data is written as.
 There must be an encoder for that suffix in <a href="index.html#BIBLIO_TYPES">BIBLIO_TYPES</a>.
 If the file exists, it is overwritten.
 Tries to print a warning to STDERR if that happens.
 Ends every file with <a href="index.html#EOL">EOL</a>.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">fname</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         A filename.
        </li>
        <li><span class="parameter">items</span>
            <span class="types"><span class="type">tab</span></span>
         A list of CSL items. If no items are given,
  tests whether data can be written in the corresponding format.
         (<em>optional</em>)
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">str</span></span>
        The filename suffix.
    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <code>nil</code> if an error occurred.</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        An error message.</li>
        <li>
           <span class="types">optional <span class="type">int</span></span>
        An error number if the error is an I/O error.</li>
    </ol>

    <h3>Raises:</h3>
    An error if the filename is the empty string.



</dd>
    <dt>
    <a name = "biblio_update"></a>
    <strong>biblio_update (fname, ids)</strong>
    </dt>
    <dd>
    Add items from Zotero to a bibliography file.</p>

<p> If an item is already in the bibliography file, it won&rsquo;t be added again.
 Prints a warning to STDERR if it overwrites an existing file.
 Also prints errors to STDERR if items cannot be found.</p>

<p> <a href="https://github.com/jgm/citeproc">Citeproc</a> appears to recognise
 formatting in <em>every</em> CSL field, so <a href="index.html#">pandoc-zotxt.lua</a> does the same.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">fname</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         The name of the bibliography file.
        </li>
        <li><span class="parameter">ids</span>
            <span class="types"><span class="type">tab</span></span>
         The IDs of the items that should be added,
  e.g., <code>{&apos;name:2019word&apos;, &apos;name2019WordWordWord&apos;}</code>.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">bool</span></span>
        <code>true</code> if the file was updated or no update was required.
    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <code>nil</code> if an error occurrs.</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        An error message.</li>
        <li>
           <span class="types">optional <span class="type">int</span></span>
        An error number if the error is a file I/O error.</li>
    </ol>

    <h3>Raises:</h3>
    See <a href="index.html#zotxt_csl_item">zotxt_csl_item</a>.



</dd>
</dl>
    <h2 class="section-header "><a name="Document_parsing"></a>Document parsing</h2>

    <dl class="function">
    <dt>
    <a name = "elem_type"></a>
    <strong>elem_type (elem)</strong>
    </dt>
    <dd>
    The type of a Pandoc AST element.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">elem</span>
            <span class="types"><span class="type">pandoc.AstElement</span></span>
         A Pandoc AST element.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        The type
  (e.g., &lsquo;MetaMap&rsquo;, &lsquo;Plain&rsquo;).</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        The higher-order type
  (i.e., &lsquo;Block&rsquo;, &lsquo;Inline&rsquo;, or &lsquo;MetaValue&rsquo;).</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        &lsquo;AstElement&rsquo;.</li>
    </ol>
     <h3>Or</h3>
    <ol>

           <span class="types"><span class="type">nil</span></span>
        <code>nil</code> if <code>elem</code> is not a Pandoc AST element.
    </ol>




</dd>
    <dt>
    <a name = "walk"></a>
    <strong>walk (elem, filter)</strong>
    </dt>
    <dd>
    Walk the AST and apply functions to matching elements.</p>

<p> Differs from <code>pandoc.walk_block</code> and <code>pandoc.walk_inline</code> by never
 modifying the original element, by accepting AST elements of <em>any</em> type
 (including documents as a whole, the metadata block, and metadata
 fields), by accepting the higher-order type <code>AstElement</code>, by <em>not</em>
 accepting the filter keywords <code>Blocks</code> and <code>Inlines</code>, by walking
 the AST bottom-up (which implies that the filter is applied to every
 element, regardless of whether any of that elements&rsquo;s ancestors matches
 it), by applying the filter to the given element itself, and by allowing
 the functions in the filter to return data of arbitrary types (as
 opposed to either a Pandoc AST element or <code>nil</code>).


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">elem</span>
            <span class="types"><span class="type">pandoc.AstElement</span></span>
         A Pandoc AST element.
        </li>
        <li><span class="parameter">filter</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">{string=func,...}</a></span>
         A filter.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

        The element, with the filter applied.
    </ol>




</dd>
    <dt>
    <a name = "meta_sources"></a>
    <strong>meta_sources (meta)</strong>
    </dt>
    <dd>
    Collect sources from the document&rsquo;s metadata block.</p>

<p> Reads the <code>references</code> metafata field and every bibliography file
 referenced by the <code>bibliography</code> metadata field.</p>

<p> Prints errors to STDERR if it cannot parse a bibliography file.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">meta</span>
            <span class="types"><span class="type">tab</span></span>
         A metadata block.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">pandoc.List</span></span>
        A list of CSL items.
    </ol>




</dd>
    <dt>
    <a name = "doc_ckeys"></a>
    <strong>doc_ckeys (doc[, flags])</strong>
    </dt>
    <dd>
    Collect the citation keys used in a document.</p>

<p> Prints errors to STDERR if it cannot parse a bibliography file.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">doc</span>
            <span class="types"><span class="type">tab</span></span>
         A document.
        </li>
        <li><span class="parameter">flags</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         If the flag &lsquo;u&rsquo; is given, collects only
  citation keys of sources that are defined neither in the
  <code>references</code> metadata field nor in any bibliography file.
         (<em>optional</em>)
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">{string,...}</a></span>
        A list of citation keys.</li>
        <li>
           <span class="types"><span class="type">int</span></span>
        The number of citation keys found.</li>
    </ol>

    <h3>Raises:</h3>
    An error if an item ID is of an illegal data type.



</dd>
</dl>
    <h2 class="section-header "><a name="Main"></a>Main</h2>

    <dl class="function">
    <dt>
    <a name = "add_biblio"></a>
    <strong>add_biblio (meta, ckeys)</strong>
    </dt>
    <dd>
    Add sources to a bibliography file and the file to the document&rsquo;s metadata.</p>

<p> Updates the bibliography file as needed and adds it to the <code>bibliography</code>
 metadata field. Interpretes a relative filename as relative to the
 directory of the first input file passed to <strong>pandoc</strong>, <em>not</em> as relative
 to the current working directory (unless no input files are given).


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">meta</span>
            <span class="types"><span class="type">tab</span></span>
         A metadata block, with the field
  <code>zotero-bibliography</code> set to the filename of the bibliography file.
        </li>
        <li><span class="parameter">ckeys</span>
            <span class="types"><span class="type">tab</span></span>
         The citaton keys of the items that should be added,
  e.g., <code>{&apos;name:2019word&apos;, &apos;name2019WordWordWord&apos;}</code>.
  Citation keys are just item IDs.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">tab</span></span>
        An updated metadata block, with the field
  <code>bibliography</code> added if needed.
    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <code>nil</code> if no sources were found,
  <code>zotero-bibliography</code> is not set, or an error occurred.</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        An error message, if applicable.</li>
    </ol>

    <h3>Raises:</h3>
    See <a href="index.html#zotxt_csl_item">zotxt_csl_item</a>.



</dd>
    <dt>
    <a name = "add_refs"></a>
    <strong>add_refs (meta, ckeys)</strong>
    </dt>
    <dd>
    Add sources to the <code>references</code> metadata field.</p>

<p> Prints an error message to STDERR for every source that cannot be found.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">meta</span>
            <span class="types"><span class="type">tab</span></span>
         A metadata block.
        </li>
        <li><span class="parameter">ckeys</span>
            <span class="types"><span class="type">tab</span></span>
         The citation keys of the items that should be added,
  e.g., <code>{&apos;name:2019word&apos;, &apos;name2019WordWordWord&apos;}</code>.
  Citation keys are just item IDs.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
        An updated metadata block,
  with the field <code>references</code> added if needed.
    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <code>nil</code> if no sources were found or an error occurred.</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        An error message, if applicable.</li>
    </ol>

    <h3>Raises:</h3>
    See <a href="index.html#zotxt_csl_item">zotxt_csl_item</a>.



</dd>
    <dt>
    <a name = "main"></a>
    <strong>main (doc)</strong>
    </dt>
    <dd>
    Collect sources and adds bibliographic data to a document.</p>

<p> Prints messages to STDERR if errors occur.</p>

<p> See the manual for details.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">doc</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
         A document.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
        <code>doc</code>, but with bibliographic data added.
    </ol>
     <h3>Or</h3>
    <ol>

           <span class="types"><span class="type">nil</span></span>
        <code>nil</code> if nothing was done or an error occurred.
    </ol>

    <h3>Raises:</h3>
    See <a href="index.html#zotxt_csl_item">zotxt_csl_item</a>.



</dd>
</dl>


</div> <!-- id="content" -->
</div> <!-- id="main" -->
<div id="about">
<i>generated by <a href="http://github.com/stevedonovan/LDoc">LDoc 1.4.6</a></i>
<i style="float:right;">Last updated 2021-06-03 00:40:00 </i>
</div> <!-- id="about" -->
</div> <!-- id="container" -->
</body>
</html>
