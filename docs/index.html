<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<head>
    <title>Reference</title>
    <link rel="stylesheet" href="ldoc.css" type="text/css" />
</head>
<body>

<div id="container">

<div id="product">
	<div id="product_logo"></div>
	<div id="product_name"><big><b></b></big></div>
	<div id="product_description"></div>
</div> <!-- id="product" -->


<div id="main">


<!-- Menu -->

<div id="navigation">
<br/>
<h1>pandoc-zotxt.lua</h1>


<h2>Contents</h2>
<ul>
<li><a href="#Metadata">Metadata</a></li>
<li><a href="#File_I_O">File I/O</a></li>
<li><a href="#Class_Prototype">Class Prototype </a></li>
<li><a href="#Class_Table">Class Table </a></li>
<li><a href="#Class_Connector">Class Connector </a></li>
<li><a href="#Class_Error">Class Error </a></li>
<li><a href="#Class_ConnectionError">Class ConnectionError </a></li>
<li><a href="#Class_UIDLookupError">Class UIDLookupError </a></li>
<li><a href="#Class_GroupLookupError">Class GroupLookupError </a></li>
<li><a href="#Warnings">Warnings</a></li>
<li><a href="#Meta_programming">Meta-programming</a></li>
<li><a href="#Higher_order_functions">Higher-order functions</a></li>
<li><a href="#String_manipulation">String manipulation</a></li>
<li><a href="#Table_manipulation">Table manipulation</a></li>
<li><a href="#CSL_items">CSL items</a></li>
<li><a href="#Converters">Converters</a></li>
<li><a href="#Citation_key_types">Citation key types</a></li>
<li><a href="#Networking">Networking</a></li>
<li><a href="#Class_Zotxt">Class Zotxt </a></li>
<li><a href="#Class_ZotWeb">Class ZotWeb </a></li>
<li><a href="#Bibliography_files">Bibliography files</a></li>
<li><a href="#Document_parsing">Document parsing</a></li>
<li><a href="#Main">Main</a></li>
</ul>


<h2>Scripts</h2>
<ul class="nowrap">
  <li><strong>pandoc-zotxt.lua</strong></li>
</ul>
<h2>Topics</h2>
<ul class="">
  <li><a href="topics/README.md.html">README</a></li>
</ul>

</div>

<div id="content">

<h1>Script <code>pandoc-zotxt.lua</code></h1>
<p><h2>SYNOPSIS</h2>

<p> <strong>pandoc</strong> <strong>-L</strong> <em>pandoc-zotxt.lua</em> <strong>-C</strong></p>

<h2> DESCRIPTION</h2>

<p> <strong>pandoc-zotxt.lua</strong> is a Lua filter for Pandoc that looks up citations in
 Zotero and adds their bibliographic data to a document&rsquo;s &ldquo;references&rdquo;
 metadata field or to a bibliography file, where Pandoc can pick it up.</p></p>
<p> Cite your sources using so-called &ldquo;Better BibTeX citation keys&rdquo; (provided
 by Better BibTeX for Zotero) or &ldquo;easy citekeys&rdquo; (provided by zotxt). Then,
 while Zotero is running, tell <strong>pandoc</strong> to filter your document through
 <strong>pandoc-zotxt.lua</strong> before processing citations. That&rsquo;s all there is to it.</p>

<p> If a document&rsquo;s &ldquo;references&rdquo; metadata field or a bibliography file already
 has bibliographic data for a citation, that citation will be ignored.</p>

<h2> BIBLIOGRAPHY FILES</h2>

<p> <strong>pandoc-zotxt.lua</strong> can add bibliographic data to a bibliography file,
 rather than to the &ldquo;references&rdquo; metadata field. This speeds up subsequent
 processing of the same document, because that data need not be fetched
 again from Zotero.</p>

<p> To use such a bibliography file, set the &ldquo;zotero-bibliography&rdquo; metadata
 field to a filename. If the filename is relative, it is interpreted as
 relative to the directory of the first input file passed to <strong>pandoc</strong> or,
 if no input file was given, as relative to the current working directory.
 The format of the file is determined by its filename ending:</p>

<table>
<thead>
<tr>
<th> <strong>Ending</strong> </th>
<th> <strong>Format</strong> </th>
<th> <strong>Feature</strong>     </th>
</tr>
</thead>
<tbody>
<tr>
<td> <code>.json</code>    </td>
<td> CSL JSON   </td>
<td> More reliable.  </td>
</tr>
<tr>
<td> <code>.yaml</code>    </td>
<td> CSL YAML   </td>
<td> Easier to edit. </td>
</tr>
</tbody>
</table>


<p> The bibliography file is added to the &ldquo;bibliography&rdquo; metadata field
 automatically. You can safely set &ldquo;zotero-bibliography&rdquo; and &ldquo;bibliography&rdquo;
 at the same time.</p>

<p> <strong>pandoc-zotxt.lua</strong> only adds bibliographic records to that file; it does
 <em>not</em> change, update, or delete them. If you need to update or delete
 records, delete the file; <strong>pandoc-zotxt.lua</strong> will then regenerate it.</p>

<h2> CITATION KEY TYPES</h2>

<p> <strong>pandoc-zotxt.lua</strong> supports multiple types of citation keys, namely,
 &ldquo;Better BibTeX citation keys&rdquo;, &ldquo;easy citekeys&rdquo; and Zotero item IDs.</p>

<p> However, it may happen that a Better BibTeX citation key is interpreted as
 an easy citekey <em>and</em> yet picks out an item, if not the one that it
 actually is the citation key of. That is to say, citation keys may be
 matched with the wrong bibliographic data.</p>

<p> If this happens, you can disable citation keys by setting the
 &ldquo;zotero-citekey-types&rdquo; metadata field to the citation key type or to the
 list of citation key types that you actually use.</p>

<p> You can set the following citation key types:</p>

<table>
<thead>
<tr>
<th> <strong>Key</strong>           </th>
<th> <strong>Type</strong>                   </th>
<th> <strong>Comments</strong> </th>
</tr>
</thead>
<tbody>
<tr>
<td> <a href="index.html#CITEKEY_PARSERS.betterbibtexkey">betterbibtexkey</a> </td>
<td> Better BibTeX citation key </td>
<td> -            </td>
</tr>
<tr>
<td> <a href="index.html#CITEKEY_PARSERS.easykey">easykey</a>         </td>
<td> easy citekey               </td>
<td> Deprecated.  </td>
</tr>
<tr>
<td> <code>key</code>             </td>
<td> Zotero item ID             </td>
<td> Hard to use. </td>
</tr>
</tbody>
</table>


<h2> EXAMPLES</h2>

<pre>
pandoc -L pandoc-zotxt.lua -C &lt;&lt;EOF
See @doe2020Title <span class="keyword">for</span> details.
EOF
</pre>


<p> The above will look up &ldquo;doe2020Title&rdquo; in Zotero.</p>

<pre>
pandoc -L pandoc-zotxt.lua -C &lt;&lt;EOF
<span class="comment">---
</span>zotero-bibliography: bibliography.json
...
See @doe2020Title <span class="keyword">for</span> details.
EOF
</pre>


<p> The above will look up &ldquo;doe2020Title&rdquo; in Zotero and save its bibliographic
 data into the file &ldquo;bibliography.json&rdquo; in the current working directory. If
 the same command is run again, &ldquo;doe2020Title&rdquo; will <em>not</em> be looked up again.</p>

<pre>
pandoc -L pandoc-zotxt.lua -C &lt;&lt;EOF
<span class="comment">---
</span>zotero-citekey-types: betterbibtexkey
...
See @doe2020Title <span class="keyword">for</span> details.
EOF
</pre>


<p> The above forces <strong>pandoc-zotxt.lua</strong> to interpret &ldquo;doe2020Title&rdquo; as a
 Better BibTeX citation key.</p>

<h2> KNOWN ISSUES</h2>

<p> Citation keys may, on rare occassions, be matched with the wrong Zotero
 item. This happens if a citation key picks out a different record depending
 on whether it is interpreted as a Better BibTeX citation key or as an easy
 citekey. See <strong>CITATION KEY TYPES</strong> above on how to fix this.</p>

<p> <strong>pandoc-zotxt.lua</strong> creates a temporary file when it adds sources to a
 bibliography file. If Pandoc exits because it catches a signal (e.g.,
 because you press <code>Ctrl</code>-<code>c</code>), then this file will <em>not</em> be deleted. This
 is a bug in Pandoc and in the process of being fixed. Moreover, if you are
 using Pandoc up to v2.7, another process may, mistakenly, use the same
 temporary file at the same time, though this is highly unlikely.</p>

<p> Zotero v5.0.71 and v5.0.72 fail to handle HTTP requests from user agents
 that do not set the &ldquo;User Agent&rdquo; HTTP header. And <strong>pandoc</strong> does not. As a
 consequence, <strong>pandoc-zotxt.lua</strong> cannot retrieve data from these versions
 of Zotero unless you tell <strong>pandoc</strong> to set that header.</p>

<h2> SECURITY</h2>

<p> If you are using Pandoc up to v2.7 and place the auto-generated
 bibliography file in a directory that other users have write access to,
 then they can read and change the content of that file, regardless of
 whether they have permission to read or write the file itself.</p>

<h2> CAVEATS</h2>

<p> <strong>pandoc-zotxt.lua</strong> is Unicode-agnostic.</p>

<h2> SEE ALSO</h2>

<ul>
<li><a href="https://github.com/egh/zotxt">zotxt</a></li>
<li><a href="https://retorque.re/zotero-better-bibtex/">Better BibTeX</a></li>
</ul>


<p> pandoc(1)</p>
    <h3>Info:</h3>
    <ul>
        <li><strong>Copyright</strong>: 2018, 2019, 2020, 2021 Odin Kroeger</li>
        <li><strong>Release</strong>: 1.1.0b4</li>
        <li><strong>License</strong>: MIT</li>
        <li><strong>Author</strong>: Odin Kroeger</li>
    </ul>


<h2><a href="#Metadata">Metadata</a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#NAME">NAME</a></td>
	<td class="summary">The name of this script.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#VERSION">VERSION</a></td>
	<td class="summary">The version of this script.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#SCRIPT_DIR">SCRIPT_DIR</a></td>
	<td class="summary">The directory the script is in.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#SCRIPT_NAME">SCRIPT_NAME</a></td>
	<td class="summary">The filename of the script.</td>
	</tr>
</table>
<h2><a href="#File_I_O">File I/O</a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#PATH_SEP">PATH_SEP</a></td>
	<td class="summary">The path segment seperator of your OS.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#EOL">EOL</a></td>
	<td class="summary">The end of line sequence of your OS.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#path_verify">path_verify (...)</a></td>
	<td class="summary">Check if values could represent path segments.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#path_sanitise">path_sanitise (path)</a></td>
	<td class="summary">Sanitise a path.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#path_split">path_split (path)</a></td>
	<td class="summary">Split a path into a directory and a filename.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#path_join">path_join (...)</a></td>
	<td class="summary">Join multiple path segments.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#path_is_abs">path_is_abs (path)</a></td>
	<td class="summary">Check whether a path is absolute.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#path_prettify">path_prettify (...)</a></td>
	<td class="summary">Prettify paths.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#wd">wd ()</a></td>
	<td class="summary">Get a directory to use as working directory.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#file_exists">file_exists (fname)</a></td>
	<td class="summary">Check whether a file exists.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#file_locate">file_locate (fname)</a></td>
	<td class="summary">Locate a file in Pandoc&rsquo;s resource path.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#file_read">file_read (fname)</a></td>
	<td class="summary">Read a file.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#file_write">file_write (fname, ...)</a></td>
	<td class="summary">Write data to a file.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#tmp_fname">tmp_fname ([dir[, templ='pdz-XXXXXX']])</a></td>
	<td class="summary">Generate a name for a temporary file.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#with_tmp_file">with_tmp_file ([dir[, templ='pdz-XXXXXX']], func, ...)</a></td>
	<td class="summary">Run a function with a temporary file.</td>
	</tr>
</table>
<h2><a href="#Class_Prototype">Class Prototype </a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#Prototype.mt">Prototype.mt</a></td>
	<td class="summary">Metatable for prototypes.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#Prototype.mt:__call">Prototype.mt:__call (tab)</a></td>
	<td class="summary">Delegate to a prototype.</td>
	</tr>
</table>
<h2><a href="#Class_Table">Class Table </a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#Table.n">Table.n</a></td>
	<td class="summary">The number of items in the table.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#Table:add">Table:add (...)</a></td>
	<td class="summary">Add items to the table.</td>
	</tr>
</table>
<h2><a href="#Class_Connector">Class Connector </a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#Connector.parameters">Connector.parameters</a></td>
	<td class="summary">Configuration parameters.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#Connector:configure">Connector:configure (A)</a></td>
	<td class="summary">Configure the connector.</td>
	</tr>
</table>
<h2><a href="#Class_Error">Class Error </a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#Error.message">Error.message</a></td>
	<td class="summary">Default for error messages.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#Error.mt">Error.mt</a></td>
	<td class="summary">Metatable for errors.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#Error.mt:__tostring">Error.mt:__tostring ()</a></td>
	<td class="summary">Convert an error into a string.</td>
	</tr>
</table>
<h2><a href="#Class_ConnectionError">Class ConnectionError </a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#ConnectionError.message">ConnectionError.message</a></td>
	<td class="summary">Message for connection errors.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#ConnectionError.host">ConnectionError.host</a></td>
	<td class="summary">Stand-in value for the host.</td>
	</tr>
</table>
<h2><a href="#Class_UIDLookupError">Class UIDLookupError </a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#UIDLookupError.message">UIDLookupError.message</a></td>
	<td class="summary">Message for user ID lookup errors.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#UIDLookupError.err">UIDLookupError.err</a></td>
	<td class="summary">Stand-in value for the error description.</td>
	</tr>
</table>
<h2><a href="#Class_GroupLookupError">Class GroupLookupError </a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#GroupLookupError.message">GroupLookupError.message</a></td>
	<td class="summary">Message for group lookup errors.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#GroupLookupError.err">GroupLookupError.err</a></td>
	<td class="summary">Stand-in value for the error description.</td>
	</tr>
</table>
<h2><a href="#Warnings">Warnings</a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#log">log (val)</a></td>
	<td class="summary">Print a value to STDERR.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#warn">warn (val)</a></td>
	<td class="summary">Print a value to STDERR unless the user has requested quietness.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#info">info (val)</a></td>
	<td class="summary">Print a value to STDERR if the user has requested verbosity.</td>
	</tr>
</table>
<h2><a href="#Meta_programming">Meta-programming</a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#vars">vars ([lvl=2])</a></td>
	<td class="summary">Get the variables a function can access.</td>
	</tr>
</table>
<h2><a href="#Higher_order_functions">Higher-order functions</a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#do_after">do_after (ex, func, ...)</a></td>
	<td class="summary">Run cleanup code after a function.</td>
	</tr>
</table>
<h2><a href="#String_manipulation">String manipulation</a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#split">split (str, pattern[, max[, inc]])</a></td>
	<td class="summary">Iterate over substrings of a string.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#expand_vars">expand_vars (str, vars)</a></td>
	<td class="summary">Expand variables in strings.</td>
	</tr>
</table>
<h2><a href="#Table_manipulation">Table manipulation</a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#keys">keys (tab)</a></td>
	<td class="summary">Get the keys and the length of a table.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#mapr">mapr (func, graph)</a></td>
	<td class="summary">Apply a function to every node of a graph.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#tabulate">tabulate (iter[, val])</a></td>
	<td class="summary">Tabulate the values that an iterator returns.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#sorted_pairs">sorted_pairs (tab[, func])</a></td>
	<td class="summary">Iterate over the keys of a table in a given order.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#in_order">in_order (...)</a></td>
	<td class="summary">Define a sorting function from a list of values.</td>
	</tr>
</table>
<h2><a href="#CSL_items">CSL items</a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#CSL_KEY_ORDER">CSL_KEY_ORDER</a></td>
	<td class="summary">The preferred order of keys in YAML bibliography files.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#csl_item_extras">csl_item_extras (item)</a></td>
	<td class="summary">Iterate over key-value pairs in the &ldquo;note&rdquo; field of CSL items.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#csl_keys_sort">csl_keys_sort (a, b)</a></td>
	<td class="summary">Sorting function for CSL field names.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#csl_items_sort">csl_items_sort (a, b)</a></td>
	<td class="summary">Sorting function for CSL items.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#csl_items_ids">csl_items_ids (items)</a></td>
	<td class="summary">Pick the IDs of CSL items out of a list of CSL items.</td>
	</tr>
</table>
<h2><a href="#Converters">Converters</a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#escape_markdown">escape_markdown (str)</a></td>
	<td class="summary">Escape Markdown syntax.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#markdownify">markdownify (elem)</a></td>
	<td class="summary">Convert a Pandoc element to Markdown text.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#yamlify">yamlify (graph[, ind=4[, sort_f]])</a></td>
	<td class="summary">Generate a YAML representation of a graph.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#csl_item_to_meta">csl_item_to_meta (item)</a></td>
	<td class="summary">Convert a CSL item to a Pandoc metadata value.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#zot_to_html">zot_to_html (zot)</a></td>
	<td class="summary">Convert Zotero pseudo-HTML to HTML.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#zot_to_md">zot_to_md (zot)</a></td>
	<td class="summary">Convert Zotero pseudo-HTML to Markdown.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#parse_csl_json">parse_csl_json (str)</a></td>
	<td class="summary">Parse a CSL JSON string.</td>
	</tr>
</table>
<h2><a href="#Citation_key_types">Citation key types</a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#CITEKEY_PARSERS">CITEKEY_PARSERS</a></td>
	<td class="summary">A mapping of citation key types to functions that guess search terms.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#CITEKEY_PARSERS.betterbibtexkey">CITEKEY_PARSERS.betterbibtexkey (ckey)</a></td>
	<td class="summary">Guess search terms from a BetterBibTeX citation key.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#CITEKEY_PARSERS.easykey">CITEKEY_PARSERS.easykey (ckey)</a></td>
	<td class="summary">Guess search terms from an Easy Citekey.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#guess_search_terms">guess_search_terms (ckey, citekey_types)</a></td>
	<td class="summary">Guess search terms from a citation key.</td>
	</tr>
</table>
<h2><a href="#Networking">Networking</a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#http_get">http_get (url)</a></td>
	<td class="summary">Retrieve data from a URL via an HTTP GET request.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#url_query">url_query (url, params)</a></td>
	<td class="summary">Query a URL via an HTTP GET request.</td>
	</tr>
</table>
<h2><a href="#Class_Zotxt">Class Zotxt </a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#Zotxt.citekey_types">Zotxt.citekey_types</a></td>
	<td class="summary">What types of citation keys to expect.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#Zotxt.parameters">Zotxt.parameters</a></td>
	<td class="summary">The names of the configuration parameters to process.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#Zotxt:get_item">Zotxt:get_item (ckey)</a></td>
	<td class="summary">Retrieve a CSL item from zotxt.</td>
	</tr>
</table>
<h2><a href="#Class_ZotWeb">Class ZotWeb </a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#ZotWeb.citekey_types">ZotWeb.citekey_types</a></td>
	<td class="summary">What types of citation keys to expect.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#ZotWeb.parameters">ZotWeb.parameters</a></td>
	<td class="summary">The names of the configuration parameters to process.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#ZotWeb:get_user_id">ZotWeb:get_user_id ()</a></td>
	<td class="summary">Get the user ID for the given API key.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#ZotWeb:get_groups">ZotWeb:get_groups ()</a></td>
	<td class="summary">Get the IDs of the groups the current user is a member of.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#ZotWeb:endpoints">ZotWeb:endpoints ([item_id])</a></td>
	<td class="summary">Iterate over item endpoint URLs.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#ZotWeb:search">ZotWeb:search (...)</a></td>
	<td class="summary">Search items by their author, publication year, and title.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#ZotWeb:match">ZotWeb:match (ckey)</a></td>
	<td class="summary">Searches for a CSL item that matches a citation key.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#ZotWeb:lookup">ZotWeb:lookup (id)</a></td>
	<td class="summary">Look up a CSL item by its Zotero ID.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#ZotWeb:get_item">ZotWeb:get_item (ckey)</a></td>
	<td class="summary">Retrieve a CSL item from Zotero.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#ZotWeb:configure">ZotWeb:configure (A)</a></td>
	<td class="summary">Configure the connector.</td>
	</tr>
</table>
<h2><a href="#Bibliography_files">Bibliography files</a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#BIBLIO_TYPES">BIBLIO_TYPES</a></td>
	<td class="summary">A mapping of filename suffices to codecs.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#BIBLIO_TYPES.bib">BIBLIO_TYPES.bib</a></td>
	<td class="summary">Decode BibLaTeX.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#BIBLIO_TYPES.bib.decode">BIBLIO_TYPES.bib.decode (str)</a></td>
	<td class="summary">Read the IDs from the contents of a BibLaTeX file.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#BIBLIO_TYPES.bibtex">BIBLIO_TYPES.bibtex</a></td>
	<td class="summary">Decode BibTeX.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#BIBLIO_TYPES.bibtex.decode">BIBLIO_TYPES.bibtex.decode (str)</a></td>
	<td class="summary">Read the IDs from the contents of a BibTeX file.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#BIBLIO_TYPES.json">BIBLIO_TYPES.json</a></td>
	<td class="summary">De-/Encode CSL items in JSON.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#BIBLIO_TYPES.yaml">BIBLIO_TYPES.yaml</a></td>
	<td class="summary">De-/Encode CSL items in YAML.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#BIBLIO_TYPES.yaml.decode">BIBLIO_TYPES.yaml.decode (str)</a></td>
	<td class="summary">Parse a CSL YAML string.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#BIBLIO_TYPES.yaml.encode">BIBLIO_TYPES.yaml.encode (items)</a></td>
	<td class="summary">Serialise a list of CSL items to a YAML string.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#BIBLIO_TYPES.yml">BIBLIO_TYPES.yml</a></td>
	<td class="summary">Alternative suffix for YAML files.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#biblio_read">biblio_read (fname)</a></td>
	<td class="summary">Read a bibliography file.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#biblio_write">biblio_write (fname[, items])</a></td>
	<td class="summary">Write bibliographic data to a bibliography file.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#biblio_update">biblio_update (handle, fname, ckeys)</a></td>
	<td class="summary">Add items from Zotero to a bibliography file.</td>
	</tr>
</table>
<h2><a href="#Document_parsing">Document parsing</a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#elem_type">elem_type (elem)</a></td>
	<td class="summary">The type of a Pandoc AST element.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#walk">walk (elem, filter)</a></td>
	<td class="summary">Walk the AST and apply functions to matching elements.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#meta_sources">meta_sources (meta)</a></td>
	<td class="summary">Collect bibliographic data from the document&rsquo;s metadata block.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#doc_ckeys">doc_ckeys (doc[, undef=false])</a></td>
	<td class="summary">Collect the citation keys used in a document.</td>
	</tr>
</table>
<h2><a href="#Main">Main</a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#add_biblio">add_biblio (handle, doc)</a></td>
	<td class="summary">Add data to a bibliography file and the file to the document&rsquo;s metadata.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#add_refs">add_refs (handle, doc)</a></td>
	<td class="summary">Add bibliographic data to the <code>references</code> metadata field.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#meta_param">meta_param (meta, name)</a></td>
	<td class="summary">Lookup a parameter in the document&rsquo;s metadata field.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#meta_params">meta_params (meta)</a></td>
	<td class="summary">Get parameters from the document&rsquo;s metadata field.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#main">main (doc)</a></td>
	<td class="summary">Collect citations and add bibliographic data to a document.</td>
	</tr>
</table>

<br/>
<br/>


    <h2 class="section-header "><a name="Metadata"></a>Metadata</h2>

    <dl class="function">
    <dt>
    <a name = "NAME"></a>
    <strong>NAME</strong>
    </dt>
    <dd>
    The name of this script.







</dd>
    <dt>
    <a name = "VERSION"></a>
    <strong>VERSION</strong>
    </dt>
    <dd>
    The version of this script.







</dd>
    <dt>
    <a name = "SCRIPT_DIR"></a>
    <strong>SCRIPT_DIR</strong>
    </dt>
    <dd>
    The directory the script is in.







</dd>
    <dt>
    <a name = "SCRIPT_NAME"></a>
    <strong>SCRIPT_NAME</strong>
    </dt>
    <dd>
    The filename of the script.







</dd>
</dl>
    <h2 class="section-header "><a name="File_I_O"></a>File I/O</h2>

    <dl class="function">
    <dt>
    <a name = "PATH_SEP"></a>
    <strong>PATH_SEP</strong>
    </dt>
    <dd>
    The path segment seperator of your OS.







</dd>
    <dt>
    <a name = "EOL"></a>
    <strong>EOL</strong>
    </dt>
    <dd>
    The end of line sequence of your OS.







</dd>
    <dt>
    <a name = "path_verify"></a>
    <strong>path_verify (...)</strong>
    </dt>
    <dd>
    Check if values could represent path segments.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">...</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         Values.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">boolean</span></span>
        <code>true</code> if the values could represent path segments.
    </ol>
     <h3>Or</h3>
    <ol>

           <span class="types"><span class="type">nil</span></span>
        <code>nil</code> otherwise.
    </ol>
     <h3>Or</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        An error message.
    </ol>




</dd>
    <dt>
    <a name = "path_sanitise"></a>
    <strong>path_sanitise (path)</strong>
    </dt>
    <dd>
    Sanitise a path.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">path</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         The path.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        A sanitised path.
    </ol>

    <h3>Raises:</h3>
    An error if no path is given or if the path is the empty string.



</dd>
    <dt>
    <a name = "path_split"></a>
    <strong>path_split (path)</strong>
    </dt>
    <dd>
    Split a path into a directory and a filename.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">path</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         The file&rsquo;s path.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        The directory the file is in.</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        The file&rsquo;s name.</li>
    </ol>

    <h3>Raises:</h3>
    An error if no path is given or if the path is the empty string.



</dd>
    <dt>
    <a name = "path_join"></a>
    <strong>path_join (...)</strong>
    </dt>
    <dd>
    Join multiple path segments.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">...</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         Path segments.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        The complete path.
    </ol>

    <h3>Raises:</h3>
    An error if no path segments are given or if
  a path segment is the empty string.



</dd>
    <dt>
    <a name = "path_is_abs"></a>
    <strong>path_is_abs (path)</strong>
    </dt>
    <dd>
    Check whether a path is absolute.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">path</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         A path.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">bool</span></span>
        <code>true</code> if the path is absolute, <code>false</code> otherwise.
    </ol>

    <h3>Raises:</h3>
    An error if no path is given or if the path is the empty string.



</dd>
    <dt>
    <a name = "path_prettify"></a>
    <strong>path_prettify (...)</strong>
    </dt>
    <dd>
    Prettify paths.</p>

<p> More precisely, remove the current working directory from the
 beginning of a path and, on POSIX systems, replace the user&rsquo;s
 home directory with &lsquo;~&rsquo;.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">...</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         Paths.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        Prettier paths.
    </ol>

    <h3>Raises:</h3>
    An error if no path is given or if the path is the empty string.



</dd>
    <dt>
    <a name = "wd"></a>
    <strong>wd ()</strong>
    </dt>
    <dd>
    Get a directory to use as working directory.



    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        The directory of the first input file
  or &lsquo;.&rsquo; if none was given.
    </ol>

    <h3>Raises:</h3>
    An error if no path is given or if the path is the empty string.



</dd>
    <dt>
    <a name = "file_exists"></a>
    <strong>file_exists (fname)</strong>
    </dt>
    <dd>
    Check whether a file exists.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">fname</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         A filename.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">boolean</span></span>
        <code>true</code> if the file exists.
    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <code>nil</code> if the file does not exist.</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        An error message.</li>
        <li>
           <span class="types"><span class="type">int</span></span>
        The error number 2.</li>
    </ol>

    <h3>Raises:</h3>
    An error if no path is given or if the path is the empty string.



</dd>
    <dt>
    <a name = "file_locate"></a>
    <strong>file_locate (fname)</strong>
    </dt>
    <dd>
    Locate a file in Pandoc&rsquo;s resource path.</p>

<p> Absolute filenames are returned as they are.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">fname</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         A filename.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        A filename.
    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <code>nil</code> if the file could not be found.</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        An error message.</li>
    </ol>

    <h3>Raises:</h3>
    An error if no path is given or if the path is the empty string.



</dd>
    <dt>
    <a name = "file_read"></a>
    <strong>file_read (fname)</strong>
    </dt>
    <dd>
    Read a file.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">fname</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         A filename.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        The contents of the file.
    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <code>nil</code> if an error occurred.</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        An error message.</li>
        <li>
           <span class="types"><span class="type">int</span></span>
        An error number.</li>
    </ol>




</dd>
    <dt>
    <a name = "file_write"></a>
    <strong>file_write (fname, ...)</strong>
    </dt>
    <dd>
    Write data to a file.</p>

<p> If a file of that name already exists, it is overwritten.
 <a href="index.html#file_write">file_write</a> <em>tries</em> to print a warning to STDERR if that happens,
 but another process may create a file between the time <a href="index.html#file_write">file_write</a>
 checks whether a filename is in use and the time it starts writing.</p>

<p> Some errors and warnings may be printed to STDERR.</p>

<p> <h3>Caveats:</h3></p>

<p> Data is first written to a temporary file, that file is then renamed to
 the given filename. This is safe and secure starting with Pandoc v2.8.
 If you are using an older version of Pandoc, then the caveats of
 <a href="index.html#with_tmp_file">with_tmp_file</a> apply.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">fname</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         A filename.
        </li>
        <li><span class="parameter">...</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         The data.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">bool</span></span>
        <code>true</code> if the data was written to the given file.
    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <code>nil</code> if an error occurred.</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        An error message.</li>
        <li>
           <span class="types"><span class="type">int</span></span>
        An error number.</li>
    </ol>

    <h3>Raises:</h3>
    An error if no filename is given or
  if the filename is the empty string.



</dd>
    <dt>
    <a name = "tmp_fname"></a>
    <strong>tmp_fname ([dir[, templ='pdz-XXXXXX']])</strong>
    </dt>
    <dd>
    Generate a name for a temporary file.</p>

<p> Tries to make sure that there is no file with that name already.
 This is subject to race conditions.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">dir</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         A directory to prefix the filename with.
  Must not be the empty string.
         (<em>optional</em>)
        </li>
        <li><span class="parameter">templ</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         A template for the filename.
  &lsquo;X&rsquo;s are replaced with random alphanumeric characters.
  Must contain at least six 'X&rsquo;s.
         (<em>default</em> 'pdz-XXXXXX')
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        A filename.
    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <code>nil</code> if the generated filename is in use.</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        An error message.</li>
    </ol>

    <h3>Raises:</h3>
    An error if the template or the directory is
  not a string or the empty string.



</dd>
    <dt>
    <a name = "with_tmp_file"></a>
    <strong>with_tmp_file ([dir[, templ='pdz-XXXXXX']], func, ...)</strong>
    </dt>
    <dd>
    Run a function with a temporary file.</p>

<p> If the function raises an error or returns <code>nil</code> or <code>false</code>, then the
 temporary file is deleted. If the file could not be removed, an error
 message is printed to STDERR.</p>

<p> The function passed to <a href="index.html#with_tmp_file">with_tmp_file</a> must <em>not</em> change the working
 directory. This could cause an abitrary file to be deleted instead of
 the temporary one. And it would likely cause the automatic deletion
 of the temporary file to fail.</p>

<p> <h3>Caveats:</h3></p>

<p> The temporary file may have been created by <em>another</em> process. If that
 file is located within a directory that users other than the one
 running this script have write access to (e.g., <code>/tmp</code>), then this
 is a security issue.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">dir</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         A directory to prefix the name
  of the temporary file with. See <a href="index.html#tmp_fname">tmp_fname</a>.
         (<em>optional</em>)
        </li>
        <li><span class="parameter">templ</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         A template for the name
  of the temporary file. &lsquo;X&rsquo;s are replaced with random
  alphanumeric characters. See <a href="index.html#tmp_fname">tmp_fname</a>.
         (<em>default</em> 'pdz-XXXXXX')
        </li>
        <li><span class="parameter">func</span>
            <span class="types"><span class="type">func</span></span>
         The function to run.
  Passed the name of the temporary file as first argument.
        </li>
        <li><span class="parameter">...</span>
         Passed on to the function.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

        The values that the function returns.
    </ol>




</dd>
</dl>
    <h2 class="section-header has-description"><a name="Class_Prototype"></a>Class Prototype </h2>

          <div class="section-description">
          Prototype for prototypes.
          </div>
            <h3>Usage:</h3>
            <pre class="example">&gt; ObjA = Prototype()
&gt; mt = <span class="global">getmetatable</span>(ObjA)
&gt; <span class="keyword">function</span> mt:__tostring ()
&gt;     <span class="keyword">return</span> <span class="string">'a string'</span>
&gt; <span class="keyword">end</span>
&gt; ObjA.key = <span class="string">'value'</span>
&gt; ObjB = ObjA()
&gt; ObjB.key
value
&gt; <span class="comment">-- <code>ObjB</code> can override properties.
</span>&gt; ObjB.key = <span class="string">'another value'</span>
&gt; ObjC = ObjB()
&gt; ObjC.key
another value
&gt; <span class="comment">-- A more consise way to define objects.
</span>&gt; ObjD = ObjC { key = <span class="string">'yet another value'</span> }
&gt; ObjD.key
yet another value
&gt; <span class="comment">-- Metatables are copied, save for "__index".
</span>&gt; <span class="global">tostring</span>(ObjD)
a <span class="global">string</span></pre>
    <dl class="function">
    <dt>
    <a name = "Prototype.mt"></a>
    <strong>Prototype.mt</strong>
    </dt>
    <dd>
    Metatable for prototypes.







</dd>
    <dt>
    <a name = "Prototype.mt:__call"></a>
    <strong>Prototype.mt:__call (tab)</strong>
    </dt>
    <dd>
    Delegate to a prototype.</p>

<p> Sets the table&rsquo;s metatable to a copy of the prototype&rsquo;s metatable
 and then sets the metatable&rsquo;s <code>__index</code> field to the prototype.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">tab</span>
            <span class="types"><span class="type">tab</span></span>
         A table.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">tab</span></span>
        A prototype.
    </ol>




</dd>
</dl>
    <h2 class="section-header has-description"><a name="Class_Table"></a>Class Table </h2>

          <div class="section-description">
          A simple list.
          </div>
            <h3>Usage:</h3>
            <pre class="example">&gt; list = Table()
&gt; list:add <span class="string">'a string'</span>
&gt; list.n
<span class="number">1</span></pre>
    <dl class="function">
    <dt>
    <a name = "Table.n"></a>
    <strong>Table.n</strong>
    </dt>
    <dd>
    The number of items in the table.







</dd>
    <dt>
    <a name = "Table:add"></a>
    <strong>Table:add (...)</strong>
    </dt>
    <dd>
    Add items to the table.</p>

<p> <h3>Side-effects:</h3></p>

<p> Sets <a href="index.html#Table.n">Table.n</a> to the number of items in the table.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">...</span>
         Items.
        </li>
    </ul>





</dd>
</dl>
    <h2 class="section-header has-description"><a name="Class_Connector"></a>Class Connector </h2>

          <div class="section-description">
          Abstract prototype for connectors.
          </div>
    <dl class="function">
    <dt>
    <a name = "Connector.parameters"></a>
    <strong>Connector.parameters</strong>
    </dt>
    <dd>
    Configuration parameters.







</dd>
    <dt>
    <a name = "Connector:configure"></a>
    <strong>Connector:configure (A)</strong>
    </dt>
    <dd>
    Configure the connector.</p>

<p> Takes a list of key-value pairs. If one of those keys is listed in
 <a href="index.html#Connector.parameters">Connector.parameters</a> property, copies its value to the the field of
 the same name of the connector.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">A</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">{string=string,...}</a></span>
         list of key-value pairs.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">boolean</span></span>
        <code>true</code> If the configuration is valid.
    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <code>nil</code> Otherwise.</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        An error message.</li>
    </ol>



    <h3>Usage:</h3>
    <ul>
        <pre class="example">&gt; conn = Connector()
&gt; conn.parameters = { <span class="string">'key'</span> }
&gt; conn:configure{key = <span class="string">'value'</span>, nada = <span class="string">'ignored'</span>}
&gt; conn.key
value
&gt; conn.nada
<span class="keyword">nil</span></pre>
    </ul>

</dd>
</dl>
    <h2 class="section-header has-description"><a name="Class_Error"></a>Class Error </h2>

          <div class="section-description">
          Prototype for errors.
          </div>
            <h3>Usage:</h3>
            <pre class="example">FileOpenError = Error { message = <span class="string">'failed to open $file.'</span> }</pre>
    <dl class="function">
    <dt>
    <a name = "Error.message"></a>
    <strong>Error.message</strong>
    </dt>
    <dd>
    Default for error messages.







</dd>
    <dt>
    <a name = "Error.mt"></a>
    <strong>Error.mt</strong>
    </dt>
    <dd>
    Metatable for errors.







</dd>
    <dt>
    <a name = "Error.mt:__tostring"></a>
    <strong>Error.mt:__tostring ()</strong>
    </dt>
    <dd>
    Convert an error into a string.</p>

<p> If the message contains variable names, they are replaced with the values
 of the fields with those names. See <a href="index.html#expand_vars">expand_vars</a> for the syntax.



    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        The error message.
    </ol>



    <h3>Usage:</h3>
    <ul>
        <pre class="example">&gt; err = Error {
&gt;     message = <span class="string">'Semething went $severity wrong.'</span>,
&gt;     severity = <span class="string">'terribly'</span>
&gt; }
&gt; <span class="global">assert</span>(<span class="keyword">false</span>, err{severity = <span class="string">'slightly'</span>})
Something went slightly wrong.</pre>
    </ul>

</dd>
</dl>
    <h2 class="section-header has-description"><a name="Class_ConnectionError"></a>Class ConnectionError </h2>

          <div class="section-description">
          Prototype for connection errors.
          </div>
            <h3>Usage:</h3>
            <pre class="example">&gt; ok, mt, data = <span class="global">pcall</span>(pandoc.mediabag.fetch, url)
&gt; <span class="global">assert</span>(ok, ConnectionError{host = url})</pre>
    <dl class="function">
    <dt>
    <a name = "ConnectionError.message"></a>
    <strong>ConnectionError.message</strong>
    </dt>
    <dd>
    Message for connection errors.







</dd>
    <dt>
    <a name = "ConnectionError.host"></a>
    <strong>ConnectionError.host</strong>
    </dt>
    <dd>
    Stand-in value for the host.







</dd>
</dl>
    <h2 class="section-header has-description"><a name="Class_UIDLookupError"></a>Class UIDLookupError </h2>

          <div class="section-description">
          Prototype for Zotero user ID lookup errors.
          </div>
            <h3>Usage:</h3>
            <pre class="example">&gt; ok, data = <span class="global">pcall</span>(json.decode, str)
&gt; <span class="global">assert</span>(ok, UIDLookupError{err = <span class="string">'failed to parse: '</span> .. str})</pre>
    <dl class="function">
    <dt>
    <a name = "UIDLookupError.message"></a>
    <strong>UIDLookupError.message</strong>
    </dt>
    <dd>
    Message for user ID lookup errors.







</dd>
    <dt>
    <a name = "UIDLookupError.err"></a>
    <strong>UIDLookupError.err</strong>
    </dt>
    <dd>
    Stand-in value for the error description.







</dd>
</dl>
    <h2 class="section-header has-description"><a name="Class_GroupLookupError"></a>Class GroupLookupError </h2>

          <div class="section-description">
          Prototype for Zotero group lookup errors.
          </div>
            <h3>Usage:</h3>
            <pre class="example">&gt; ok, data = <span class="global">pcall</span>(json.decode, str)
&gt; <span class="global">assert</span>(ok, GroupLookupError{err = <span class="string">'failed to parse: '</span> .. str})</pre>
    <dl class="function">
    <dt>
    <a name = "GroupLookupError.message"></a>
    <strong>GroupLookupError.message</strong>
    </dt>
    <dd>
    Message for group lookup errors.







</dd>
    <dt>
    <a name = "GroupLookupError.err"></a>
    <strong>GroupLookupError.err</strong>
    </dt>
    <dd>
    Stand-in value for the error description.







</dd>
</dl>
    <h2 class="section-header "><a name="Warnings"></a>Warnings</h2>

    <dl class="function">
    <dt>
    <a name = "log"></a>
    <strong>log (val)</strong>
    </dt>
    <dd>
    Print a value to STDERR.</p>

<p> Prefixes the value with <a href="index.html#SCRIPT_NAME">SCRIPT_NAME</a> and &lsquo;:&rsquo;, appends <a href="index.html#EOL">EOL</a>.</p>

<p> If the value is a string and contains variable names, they are replaced
 with the values of those variables as seen by the calling function.
 See <a href="index.html#expand_vars">expand_vars</a> for the syntax.</p>

<p> If the value is of another type, it is coerced to a string before printing.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">val</span>
         The value.
        </li>
    </ul>





</dd>
    <dt>
    <a name = "warn"></a>
    <strong>warn (val)</strong>
    </dt>
    <dd>
    Print a value to STDERR unless the user has requested quietness.</p>

<p> The value is only printed if <code>PANDOC_STATE.verbosity</code> is <em>not</em> &lsquo;ERROR&rsquo;.
 Otherwise the same as <a href="index.html#log">log</a>.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">val</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         The value.
        </li>
    </ul>





</dd>
    <dt>
    <a name = "info"></a>
    <strong>info (val)</strong>
    </dt>
    <dd>
    Print a value to STDERR if the user has requested verbosity.</p>

<p> The value is only printed if <code>PANDOC_STATE.verbosity</code> is &lsquo;INFO&rsquo;.
 Otherwise the same as <a href="index.html#log">log</a>.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">val</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         The value.
        </li>
    </ul>





</dd>
</dl>
    <h2 class="section-header "><a name="Meta_programming"></a>Meta-programming</h2>

    <dl class="function">
    <dt>
    <a name = "vars"></a>
    <strong>vars ([lvl=2])</strong>
    </dt>
    <dd>
    Get the variables a function can access.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">lvl</span>
            <span class="types"><span class="type">int</span></span>
         A stack level, where
  1 points to the current function (i.e., <a href="index.html#vars">vars</a>),
  2 to that function&rsquo;s caller, and so on.
         (<em>default</em> 2)
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
        A mapping of variable names to values.
    </ol>

    <h3>Raises:</h3>
    An error if there is no function at the given stack level.



</dd>
</dl>
    <h2 class="section-header "><a name="Higher_order_functions"></a>Higher-order functions</h2>

    <dl class="function">
    <dt>
    <a name = "do_after"></a>
    <strong>do_after (ex, func, ...)</strong>
    </dt>
    <dd>
    Run cleanup code after a function.</p>

<p> The cleanup code runs regardless of whether an error occurs. However, Lua
 filters cannot respond to signals, so it is <em>not</em> run if Pandoc exits
 because it catches a signal.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">ex</span>
            <span class="types"><span class="type">func</span></span>
         The cleanup code. Its first argument indicates whether
  the protected call to <code>func</code> exited with an error. The remaining
  arguments are the values returned by <code>func</code>.
        </li>
        <li><span class="parameter">func</span>
            <span class="types"><span class="type">func</span></span>
         The code itself. Called in protected mode.
        </li>
        <li><span class="parameter">...</span>
         Passed on to <code>func</code>.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

        What the given functions returns.
    </ol>




</dd>
</dl>
    <h2 class="section-header "><a name="String_manipulation"></a>String manipulation</h2>

    <dl class="function">
    <dt>
    <a name = "split"></a>
    <strong>split (str, pattern[, max[, inc]])</strong>
    </dt>
    <dd>
    Iterate over substrings of a string.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">str</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         The string.
        </li>
        <li><span class="parameter">pattern</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         A pattern that matches the sequence of characters that
  separates substrings. Must <em>not</em> contain frontier patterns (<code>%f</code>).
        </li>
        <li><span class="parameter">max</span>
            <span class="types"><span class="type">int</span></span>
         Split up the string into at most that many substrings.
         (<em>optional</em>)
        </li>
        <li><span class="parameter">inc</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         Whether to include the seperator in the substring.
  <code>l</code> includes the seperator on the left, <code>r</code> on the right.
  By default, the seperator is <em>not</em> included.
         (<em>optional</em>)
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">func</span></span>
        A <em>stateful</em> iterator.
    </ol>



    <h3>Usage:</h3>
    <ul>
        <pre class="example">&gt; <span class="keyword">for</span> s <span class="keyword">in</span> split(<span class="string">'CamelCase'</span>, <span class="string">'%u'</span>, <span class="keyword">nil</span>, <span class="string">'l'</span>) <span class="keyword">do</span>
&gt;   <span class="global">print</span>(s)
&gt; <span class="keyword">end</span>
Camel
Case</pre>
    </ul>

</dd>
    <dt>
    <a name = "expand_vars"></a>
    <strong>expand_vars (str, vars)</strong>
    </dt>
    <dd>
    <p>Expand variables in strings.</p>

<p> If a word is preceded by a single &ldquo;$&rdquo; sign, that word is interpreted as
 a variable name, and the &ldquo;$&rdquo; sign and the word are replaced with the
 value of that variable.</p>

<pre><code>  &gt; expand_vars(
  &gt;     '$v1 is $v2.',
  &gt;     {v1 = 'foo', v2 = 'bar'}
  &gt; )
  foo is bar.
</code></pre>

<p> If a word is preceded by two or more &ldquo;$&rdquo; signs, it is <em>not</em> replaced.
 Any series of <em>n</em> &ldquo;$&rdquo; signs is replaced with <em>n</em> &ndash; 1 &ldquo;$&rdquo; signs.</p>

<pre><code>  &gt; expand_vars(
  &gt;   '$$v1 costs $$23 (and $- is just a dash).',
  &gt;   {v1 = 'foo'}
  &gt; )
  $v1 costs $23 (and - is just a dash).
</code></pre>

<p> If a variable expression is followed by a &ldquo;|&rdquo; character and another
 word, the second word is interpreted as a function name; the value of
 the given variable is then passed to that function, and the whole
 expression <code>$&lt;variable&gt;|&lt;function&gt;</code> is replaced with the first value
 that this function returns.</p>

<pre><code>  &gt; expand_vars(
  &gt;   '$v1|barify is bar!', {
  &gt;       v1 = 'foo',
  &gt;       barify = function (s)
  &gt;           return s:gsub('foo', 'bar')
  &gt;       end
  &gt;   }
  &gt; )
  bar is bar!
</code></pre>

<p> Expressions are evaluated recursively.</p>

<pre><code>  &gt; expand_vars(
  &gt;   '$v1 is bar.', {
  &gt;       v1 = '$v2',
  &gt;       v2 = 'foo'
  &gt;   }
  &gt; )
  foo is bar.
</code></pre>


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">str</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         A string.
        </li>
        <li><span class="parameter">vars</span>
            <span class="types"><span class="type">tab</span></span>
         A mapping of variable names to values.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        A transformed string.
    </ol>

    <h3>Raises:</h3>
    An error if there is no function of the given name or
  if the value of an expression cannot be coerced to a string.



</dd>
</dl>
    <h2 class="section-header "><a name="Table_manipulation"></a>Table manipulation</h2>

    <dl class="function">
    <dt>
    <a name = "keys"></a>
    <strong>keys (tab)</strong>
    </dt>
    <dd>
    Get the keys and the length of a table.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">tab</span>
            <span class="types"><span class="type">tab</span></span>
         The table.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>
        <li>
           <span class="types"><span class="type">tab</span></span>
        The keys of <code>tab</code>.</li>
        <li>
           <span class="types"><span class="type">int</span></span>
        <code>tab</code>&rsquo;s length.</li>
    </ol>




</dd>
    <dt>
    <a name = "mapr"></a>
    <strong>mapr (func, graph)</strong>
    </dt>
    <dd>
    Apply a function to every node of a graph.</p>

<p> The graph is walked bottom-up.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">func</span>
            <span class="types"><span class="type">func</span></span>
         A function that transforms a value.
  A node is <em>not</em> changed if that function returns <code>nil</code>.
        </li>
        <li><span class="parameter">graph</span>
         A graph.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
        A new graph.
    </ol>

    <h3>Raises:</h3>
    An error if the graph is too high.



</dd>
    <dt>
    <a name = "tabulate"></a>
    <strong>tabulate (iter[, val])</strong>
    </dt>
    <dd>
    Tabulate the values that an iterator returns.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">iter</span>
            <span class="types"><span class="type">func</span></span>
         An iterator.
        </li>
        <li><span class="parameter">val</span>
         The value to start iterating with.
         (<em>optional</em>)
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
        The values generated by the iterator.
    </ol>



    <h3>Usage:</h3>
    <ul>
        <pre class="example">&gt; str = <span class="string">'key: value'</span>
&gt; k, v = tabulate(split(str, <span class="string">'%s*:%s*'</span>, <span class="number">2</span>))
&gt; <span class="global">print</span>(k, v)
key     value</pre>
    </ul>

</dd>
    <dt>
    <a name = "sorted_pairs"></a>
    <strong>sorted_pairs (tab[, func])</strong>
    </dt>
    <dd>
    Iterate over the keys of a table in a given order.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">tab</span>
            <span class="types"><span class="type">tab</span></span>
         A table.
        </li>
        <li><span class="parameter">func</span>
            <span class="types"><span class="type">func</span></span>
         A sorting function.
  If no function is given, sorts lexically.
         (<em>optional</em>)
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">func</span></span>
        A <em>stateful</em> iterator over the table.
    </ol>




</dd>
    <dt>
    <a name = "in_order"></a>
    <strong>in_order (...)</strong>
    </dt>
    <dd>
    Define a sorting function from a list of values.</p>

<p> The sorting function will sort the given values in the order in which
 they were passed. Unlisted values are sorted lexically.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">...</span>
         Values.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">func</span></span>
        A sorting function.
    </ol>



    <h3>Usage:</h3>
    <ul>
        <pre class="example">&gt; tab = {a = <span class="number">3</span>, b = <span class="number">4</span>, c = <span class="number">2</span>, d = <span class="number">1</span>}
&gt; <span class="keyword">for</span> k, v <span class="keyword">in</span> sorted_pairs(tab, in_order{<span class="string">'d'</span>, <span class="string">'c'</span>}) <span class="keyword">do</span>
&gt;     <span class="global">print</span>(k, v)
&gt; <span class="keyword">end</span>
d   <span class="number">1</span>
c   <span class="number">2</span>
a   <span class="number">3</span>
b   <span class="number">4</span></pre>
    </ul>

</dd>
</dl>
    <h2 class="section-header "><a name="CSL_items"></a>CSL items</h2>

    <dl class="function">
    <dt>
    <a name = "CSL_KEY_ORDER"></a>
    <strong>CSL_KEY_ORDER</strong>
    </dt>
    <dd>
    The preferred order of keys in YAML bibliography files.</p>

<p> <a href="https://docs.citationstyles.org/en/stable/specification.html#appendix-iv-variables">Appendix IV</a>
 of the CSL specification lists all field names.


    <h3>Fields:</h3>
    <ul>
        <li><span class="parameter">id</span>
        Item ID.
        </li>
        <li><span class="parameter">type</span>
        For example, &lsquo;paper&rsquo;, &lsquo;book&rsquo;.
        </li>
        <li><span class="parameter">author</span>
        Author(s).
        </li>
        <li><span class="parameter">recipient</span>
        Recipient of the document.
        </li>
        <li><span class="parameter">status</span>
        Publication status (e.g., &lsquo;forthcoming&rsquo;).
        </li>
        <li><span class="parameter">issued</span>
        When the item was published.
        </li>
        <li><span class="parameter">title</span>
        The title.
        </li>
        <li><span class="parameter">title-short</span>
        A short version of the title.
        </li>
        <li><span class="parameter">short-title</span>
        Ditto.
        </li>
        <li><span class="parameter">original-title</span>
        Original title.
        </li>
        <li><span class="parameter">translator</span>
        Translator(s).
        </li>
        <li><span class="parameter">editor</span>
        The editor(s).
        </li>
        <li><span class="parameter">container-title</span>
        Publication the item was published in.
        </li>
        <li><span class="parameter">container-title-short</span>
        A short version of that title.
        </li>
        <li><span class="parameter">collection-editor</span>
        E.g., the series editor(s).
        </li>
        <li><span class="parameter">collection-title</span>
        E.g., a series.
        </li>
        <li><span class="parameter">collection-title-short</span>
        A short version of the title.
        </li>
        <li><span class="parameter">edition</span>
        Container&rsquo;s edition.
        </li>
        <li><span class="parameter">volume</span>
        Volume no.
        </li>
        <li><span class="parameter">issue</span>
        Issue no.
        </li>
        <li><span class="parameter">page-first</span>
        First page.
        </li>
        <li><span class="parameter">page</span>
        Pages or page range <em>or</em> number of pages.
        </li>
        <li><span class="parameter">publisher</span>
        Publisher.
        </li>
        <li><span class="parameter">publisher-place</span>
        City/cities the item was published in.
        </li>
        <li><span class="parameter">original-publisher</span>
        Original publisher.
        </li>
        <li><span class="parameter">original-publisher-place</span>
        Place the item was originally published in.
        </li>
        <li><span class="parameter">doi</span>
        The DOI.
        </li>
        <li><span class="parameter">pmcid</span>
        PubMed Central reference number.
        </li>
        <li><span class="parameter">pmid</span>
        PubMed reference number.
        </li>
        <li><span class="parameter">url</span>
        The URL.
        </li>
        <li><span class="parameter">accessed</span>
        When the URL was last accessed.
        </li>
        <li><span class="parameter">isbn</span>
        The ISBN of the item.
        </li>
        <li><span class="parameter">issn</span>
        The ISSN of the container.
        </li>
        <li><span class="parameter">call-number</span>
        Call number (of a library).
        </li>
        <li><span class="parameter">language</span>
        Language the item is in.
        </li>
        <li><span class="parameter">abstract</span>
        The abstract.
        </li>
    </ul>



    <h3>See also:</h3>
    <ul>
         <a href="index.html#csl_keys_sort">csl_keys_sort</a>
    </ul>


</dd>
    <dt>
    <a name = "csl_item_extras"></a>
    <strong>csl_item_extras (item)</strong>
    </dt>
    <dd>
    Iterate over key-value pairs in the &ldquo;note&rdquo; field of CSL items.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">item</span>
            <span class="types"><span class="type">tab</span></span>
         A CSL item.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">func</span></span>
        A <em>stateful</em> iterator.
    </ol>




</dd>
    <dt>
    <a name = "csl_keys_sort"></a>
    <strong>csl_keys_sort (a, b)</strong>
    </dt>
    <dd>
    Sorting function for CSL field names.</p>

<p> Sorts field in the order in which they are listed in <a href="index.html#CSL_KEY_ORDER">CSL_KEY_ORDER</a>.
 Unlisted fields are placed after listed ones in lexical order.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">a</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         A CSL fieldname.
        </li>
        <li><span class="parameter">b</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         Another CSL fieldname.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">bool</span></span>
        Whether <code>a</code> should come before <code>b</code>.
    </ol>




</dd>
    <dt>
    <a name = "csl_items_sort"></a>
    <strong>csl_items_sort (a, b)</strong>
    </dt>
    <dd>
    Sorting function for CSL items.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">a</span>
            <span class="types"><span class="type">tab</span></span>
         A CSL item.
        </li>
        <li><span class="parameter">b</span>
            <span class="types"><span class="type">tab</span></span>
         Another CSL item.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">bool</span></span>
        Whether <code>a</code> should come before <code>b</code>.
    </ol>




</dd>
    <dt>
    <a name = "csl_items_ids"></a>
    <strong>csl_items_ids (items)</strong>
    </dt>
    <dd>
    Pick the IDs of CSL items out of a list of CSL items.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">items</span>
            <span class="types"><span class="type">tab</span></span>
         A list of CSL items.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">{[string]=true,...}</a></span>
        A <a href="https://www.lua.org/pil/11.5.html">set</a>
  of item IDs.
    </ol>

    <h3>Raises:</h3>
    An error if an item has an ID that cannot be coerced to a string.



</dd>
</dl>
    <h2 class="section-header "><a name="Converters"></a>Converters</h2>

    <dl class="function">
    <dt>
    <a name = "escape_markdown"></a>
    <strong>escape_markdown (str)</strong>
    </dt>
    <dd>
    Escape Markdown syntax.</p>

<p> Only escapes <a href="https://pandoc.org/MANUAL.html#specifying-bibliographic-data">Markdown Pandoc recognises in bibliographic
 data</a>.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">str</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         Non-markdown text.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        Text with markdown syntax escaped.
    </ol>




</dd>
    <dt>
    <a name = "markdownify"></a>
    <strong>markdownify (elem)</strong>
    </dt>
    <dd>
    Convert a Pandoc element to Markdown text.</p>

<p> Only recognises <a href="https://pandoc.org/MANUAL.html#specifying-bibliographic-data">elements Pandoc permits in bibliographic
 data</a>.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">elem</span>
            <span class="types"><span class="type">pandoc.AstElement</span></span>
         A Pandoc AST element.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        Markdown text.
    </ol>




</dd>
    <dt>
    <a name = "yamlify"></a>
    <strong>yamlify (graph[, ind=4[, sort_f]])</strong>
    </dt>
    <dd>
    Generate a YAML representation of a graph.</p>

<p> Lines are termined with <a href="index.html#EOL">EOL</a>.</p>

<p> <h3>Caveats:</h3></p>

<p> Strings in other encodings other than UTF-8 will be mangled.
 Does <em>not</em> escape <em>all</em> non-printable characters (because Unicode).


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">graph</span>
         A graph.
        </li>
        <li><span class="parameter">ind</span>
            <span class="types"><span class="type">int</span></span>
         How many spaces to indent blocks.
         (<em>default</em> 4)
        </li>
        <li><span class="parameter">sort_f</span>
            <span class="types"><span class="type">func</span></span>
         A function to sort keys of mappings.
  Defaults to sorting them lexically.
         (<em>optional</em>)
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        A YAML string.
    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <code>nil</code> if the data cannot be represented in YAML.</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        An error message.</li>
    </ol>

    <h3>Raises:</h3>
    An error if data cannot be expressed in YAML
  or if the graph is too high.



</dd>
    <dt>
    <a name = "csl_item_to_meta"></a>
    <strong>csl_item_to_meta (item)</strong>
    </dt>
    <dd>
    Convert a CSL item to a Pandoc metadata value.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">item</span>
            <span class="types"><span class="type">tab</span></span>
         A CSL item.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">pandoc.MetaMap</span></span>
        A Pandoc metadata value.
    </ol>




</dd>
    <dt>
    <a name = "zot_to_html"></a>
    <strong>zot_to_html (zot)</strong>
    </dt>
    <dd>
    Convert Zotero pseudo-HTML to HTML.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">zot</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         Zotero pseudo-HTML code.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        HTML code.
    </ol>




</dd>
    <dt>
    <a name = "zot_to_md"></a>
    <strong>zot_to_md (zot)</strong>
    </dt>
    <dd>
    Convert Zotero pseudo-HTML to Markdown.</p>

<p> Only supports <a href="https://pandoc.org/MANUAL.html#specifying-bibliographic-data">pseudo-HTML that Pandoc recognises in bibliographic
 data</a>.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">zot</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         Zotero pseudo-HTML code.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        Markdown text.
    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <code>nil</code> if <code>html</code> is not a <a href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a>.</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        An error message.</li>
    </ol>




</dd>
    <dt>
    <a name = "parse_csl_json"></a>
    <strong>parse_csl_json (str)</strong>
    </dt>
    <dd>
    Parse a CSL JSON string.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">str</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         A CSL JSON string.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">tab</span></span>
        A CSL item.
    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <code>nil</code> if the string cannot be parsed.</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        An error message.</li>
    </ol>




</dd>
</dl>
    <h2 class="section-header "><a name="Citation_key_types"></a>Citation key types</h2>

    <dl class="function">
    <dt>
    <a name = "CITEKEY_PARSERS"></a>
    <strong>CITEKEY_PARSERS</strong>
    </dt>
    <dd>
    A mapping of citation key types to functions that guess search terms.







</dd>
    <dt>
    <a name = "CITEKEY_PARSERS.betterbibtexkey"></a>
    <strong>CITEKEY_PARSERS.betterbibtexkey (ckey)</strong>
    </dt>
    <dd>
    Guess search terms from a BetterBibTeX citation key.</p>

<p> Splits up a BetterBibTeX citation key at each uppercase letter
 and at each start of a string of digits.</p>

<p> <h3>Caveats:</h3></p>

<p> BetterBibTeX citation keys must be encoded in ASCII.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">ckey</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         A BetterBibTeX citation key.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">{string,...}</a></span>
        A list of search terms.
    </ol>




</dd>
    <dt>
    <a name = "CITEKEY_PARSERS.easykey"></a>
    <strong>CITEKEY_PARSERS.easykey (ckey)</strong>
    </dt>
    <dd>
    Guess search terms from an Easy Citekey.</p>

<p> Splits up an Easy Citekey into an author, a year, and a title.</p>

<p> <h3>Caveats:</h3></p>

<p> Easy Citekeys must be encoded in UTF-8.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">ckey</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         A zotxt Easy Citekey.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">{string,...}</a></span>
        A list of search terms.
    </ol>




</dd>
    <dt>
    <a name = "guess_search_terms"></a>
    <strong>guess_search_terms (ckey, citekey_types)</strong>
    </dt>
    <dd>
    Guess search terms from a citation key.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">ckey</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         A citation key, e.g., &lsquo;name:2019word&rsquo;, &lsquo;name2019TwoWords&rsquo;.
        </li>
        <li><span class="parameter">citekey_types</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">{string,...}</a></span>
         What types of citation keys to expect.
  Must correspond to keys in <a href="index.html#CITEKEY_PARSERS">CITEKEY_PARSERS</a>.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">{string,...}</a></span>
        A list of search terms.
    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <code>nil</code> if no search terms could be derived.</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        An error message.</li>
    </ol>




</dd>
</dl>
    <h2 class="section-header "><a name="Networking"></a>Networking</h2>

    <dl class="function">
    <dt>
    <a name = "http_get"></a>
    <strong>http_get (url)</strong>
    </dt>
    <dd>
    Retrieve data from a URL via an HTTP GET request.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">url</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         The URL.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        The MIME type of the HTTP content.</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        The HTTP content itself.</li>
    </ol>

    <h3>Raises:</h3>
     An error if the host cannot be reached. If you are running
  Pandoc v2.11 or later, this is a <a href="index.html#ConnectionError">ConnectionError</a>, which can be
  caught. If you a running an older version of Pandoc it is a
  Pandoc exception, which cannot be caught.



</dd>
    <dt>
    <a name = "url_query"></a>
    <strong>url_query (url, params)</strong>
    </dt>
    <dd>
    Query a URL via an HTTP GET request.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">url</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         The URL.
        </li>
        <li><span class="parameter">params</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">{string=string,...}</a></span>
         Request parameters.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        The MIME type of the HTTP content.</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        The HTTP content itself.</li>
    </ol>

    <h3>Raises:</h3>
    See <a href="index.html#http_get">http_get</a>.



</dd>
</dl>
    <h2 class="section-header has-description"><a name="Class_Zotxt"></a>Class Zotxt </h2>

          <div class="section-description">
          Interface to <a href="https://github.com/egh/zotxt">zotxt</a>.
          </div>
            <h3>Usage:</h3>
            <pre class="example">&gt; handle = Zotxt()
&gt; handle.citekey_types = pandoc.List{<span class="string">'betterbibtexkey'</span>}
&gt; csl_item = handle:get_item <span class="string">'name2019TwoWords'</span></pre>
    <dl class="function">
    <dt>
    <a name = "Zotxt.citekey_types"></a>
    <strong>Zotxt.citekey_types</strong>
    </dt>
    <dd>
    What types of citation keys to expect.







</dd>
    <dt>
    <a name = "Zotxt.parameters"></a>
    <strong>Zotxt.parameters</strong>
    </dt>
    <dd>
    The names of the configuration parameters to process.


    <h3>Fields:</h3>
    <ul>
        <li><span class="parameter">citekey_types</span>
        What types of citation keys to expect.
        </li>
    </ul>





</dd>
    <dt>
    <a name = "Zotxt:get_item"></a>
    <strong>Zotxt:get_item (ckey)</strong>
    </dt>
    <dd>
    Retrieve a CSL item from zotxt.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">ckey</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         A citation key, e.g., &lsquo;name:2019word&rsquo;, &lsquo;name2019TwoWords&rsquo;.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
        A CSL item.
    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <code>nil</code> if an error occurred.</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        An error message.</li>
    </ol>

    <h3>Raises:</h3>
    See <a href="index.html#http_get">http_get</a>.



</dd>
</dl>
    <h2 class="section-header has-description"><a name="Class_ZotWeb"></a>Class ZotWeb </h2>

          <div class="section-description">
          Interface to <a href="https://www.zotero.org/support/dev/web_api">Zotero&rsquo;s Web API</a>
          </div>
            <h3>Usage:</h3>
            <pre class="example">&gt; handle = ZotWeb{api_key = <span class="string">'alongstringoflettersandnumbers'</span>}
&gt; handle.citekey_types = pandoc.List{<span class="string">'betterbibtexkey'</span>}
&gt; csl_item = handle:get_item <span class="string">'name2019TwoWords'</span></pre>
    <dl class="function">
    <dt>
    <a name = "ZotWeb.citekey_types"></a>
    <strong>ZotWeb.citekey_types</strong>
    </dt>
    <dd>
    What types of citation keys to expect.







</dd>
    <dt>
    <a name = "ZotWeb.parameters"></a>
    <strong>ZotWeb.parameters</strong>
    </dt>
    <dd>
    The names of the configuration parameters to process.


    <h3>Fields:</h3>
    <ul>
        <li><span class="parameter">citekey_types</span>
        What types of citation keys to expect.
        </li>
        <li><span class="parameter">api_key</span>
        Zotero API key.
        </li>
        <li><span class="parameter">user_id</span>
        Zotero user ID.
        </li>
        <li><span class="parameter">groups</span>
        Zotero groups this is user is a member of.
        </li>
        <li><span class="parameter">public_groups</span>
        Public Zotero groups.
        </li>
    </ul>





</dd>
    <dt>
    <a name = "ZotWeb:get_user_id"></a>
    <strong>ZotWeb:get_user_id ()</strong>
    </dt>
    <dd>
    Get the user ID for the given API key.



    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        A Zotero user ID.
    </ol>

    <h3>Raises:</h3>
     An error if the <code>api_key</code> field is not set, the Zotero Web API
  could not be reached, or if no Zotero user ID could be found.
  See <a href="index.html#http_get">http_get</a> for details on the second error.



</dd>
    <dt>
    <a name = "ZotWeb:get_groups"></a>
    <strong>ZotWeb:get_groups ()</strong>
    </dt>
    <dd>
    Get the IDs of the groups the current user is a member of.



    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">{string,</a></span>
        &hellip;} A list of Zotero group IDs.
    </ol>

    <h3>Raises:</h3>
     An error if the <code>api_key</code> field is not set, the Zotero Web API
  could not be reached, or if no Zotero user ID could be found.
  See <a href="index.html#http_get">http_get</a> for details on the second error.



</dd>
    <dt>
    <a name = "ZotWeb:endpoints"></a>
    <strong>ZotWeb:endpoints ([item_id])</strong>
    </dt>
    <dd>
    Iterate over item endpoint URLs.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">item_id</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         A Zotero item ID.
         (<em>optional</em>)
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">func</span></span>
        A <em>stateful</em> iterator.
    </ol>




</dd>
    <dt>
    <a name = "ZotWeb:search"></a>
    <strong>ZotWeb:search (...)</strong>
    </dt>
    <dd>
    Search items by their author, publication year, and title.</p>

<p> <h3>Caveats:</h3></p>

<p> Does <em>not</em> correct Zotero&rsquo;s CSL JSON export.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">...</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         Search terms.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">tab</span></span>
        A list of CSL items that match the given search terms.
    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <code>nil</code> if no items were found or an error occurred.</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        An error message.</li>
        <li>
           <span class="types"><span class="type">An</span></span>
        error message.</li>
    </ol>

    <h3>Raises:</h3>
    See <a href="index.html#ZotWeb:get_user_id">ZotWeb:get_user_id</a> and <a href="index.html#ZotWeb:get_groups">ZotWeb:get_groups</a>.



</dd>
    <dt>
    <a name = "ZotWeb:match"></a>
    <strong>ZotWeb:match (ckey)</strong>
    </dt>
    <dd>
    Searches for a CSL item that matches a citation key.</p>

<p> <h3>Side-effects:</h3></p>

<p> Search terms are printed to STDERR
 if the user has requested more output.</p>

<p> <h3>Caveats:</h3></p>

<p> Does <em>not</em> correct Zotero&rsquo;s CSL JSON export.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">ckey</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         A citation key, e.g., &lsquo;name:2019word&rsquo;, &lsquo;name2019TwoWords&rsquo;.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">tab</span></span>
        A CSL item.
    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <code>nil</code> if less or more than one item was found or
  if an error occurred.</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        An error message.</li>
    </ol>

    <h3>Raises:</h3>
    See <a href="index.html#ZotWeb:get_user_id">ZotWeb:get_user_id</a> and <a href="index.html#ZotWeb:get_groups">ZotWeb:get_groups</a>.



</dd>
    <dt>
    <a name = "ZotWeb:lookup"></a>
    <strong>ZotWeb:lookup (id)</strong>
    </dt>
    <dd>
    Look up a CSL item by its Zotero ID.</p>

<p> <h3>Caveats:</h3></p>

<p> Does <em>not</em> correct Zotero&rsquo;s CSL JSON export.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">id</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         A Zotero item ID.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">tab</span></span>
        A CSL item.
    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <code>nil</code> if no or more than one item has been found.</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        An error message.</li>
    </ol>

    <h3>Raises:</h3>
    See <a href="index.html#ZotWeb:get_user_id">ZotWeb:get_user_id</a> and <a href="index.html#ZotWeb:get_groups">ZotWeb:get_groups</a>.



</dd>
    <dt>
    <a name = "ZotWeb:get_item"></a>
    <strong>ZotWeb:get_item (ckey)</strong>
    </dt>
    <dd>
    Retrieve a CSL item from Zotero.</p>

<p> <h3>Side-effects:</h3></p>

<p> Search terms for citation keys are printed to STDERR
 if the user has requested more output.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">ckey</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         A citation key, e.g., &lsquo;name:2019word&rsquo;, &lsquo;name2019TwoWords&rsquo;.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
        A CSL item.
    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <code>nil</code> if an error occurred.</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        An error message.</li>
    </ol>

    <h3>Raises:</h3>
    See <a href="index.html#ZotWeb:get_user_id">ZotWeb:get_user_id</a> and <a href="index.html#ZotWeb:get_groups">ZotWeb:get_groups</a>.



</dd>
    <dt>
    <a name = "ZotWeb:configure"></a>
    <strong>ZotWeb:configure (A)</strong>
    </dt>
    <dd>
    Configure the connector.</p>

<p> See <a href="index.html#Connector:configure">Connector:configure</a> for details.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">A</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">{string=string,...}</a></span>
         list of key-value pairs.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">boolean</span></span>
        <code>true</code> If the configuration is valid.
    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <code>nil</code> Otherwise.</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        An error message.</li>
    </ol>




</dd>
</dl>
    <h2 class="section-header "><a name="Bibliography_files"></a>Bibliography files</h2>

    <dl class="function">
    <dt>
    <a name = "BIBLIO_TYPES"></a>
    <strong>BIBLIO_TYPES</strong>
    </dt>
    <dd>
    A mapping of filename suffices to codecs.</p>

<p> If a key is not found, it is looked up again in lowercase.







</dd>
    <dt>
    <a name = "BIBLIO_TYPES.bib"></a>
    <strong>BIBLIO_TYPES.bib</strong>
    </dt>
    <dd>
    Decode BibLaTeX.







</dd>
    <dt>
    <a name = "BIBLIO_TYPES.bib.decode"></a>
    <strong>BIBLIO_TYPES.bib.decode (str)</strong>
    </dt>
    <dd>
    Read the IDs from the contents of a BibLaTeX file.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">str</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         The contents of a BibLaTeX file.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">{{['id']=string},...}</span></span>
        A list of key-value pairs.
    </ol>




</dd>
    <dt>
    <a name = "BIBLIO_TYPES.bibtex"></a>
    <strong>BIBLIO_TYPES.bibtex</strong>
    </dt>
    <dd>
    Decode BibTeX.







</dd>
    <dt>
    <a name = "BIBLIO_TYPES.bibtex.decode"></a>
    <strong>BIBLIO_TYPES.bibtex.decode (str)</strong>
    </dt>
    <dd>
    Read the IDs from the contents of a BibTeX file.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">str</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         The contents of a BibTeX file.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">{{['id']=string},...}</span></span>
        A list of key-value pairs.
    </ol>




</dd>
    <dt>
    <a name = "BIBLIO_TYPES.json"></a>
    <strong>BIBLIO_TYPES.json</strong>
    </dt>
    <dd>
    De-/Encode CSL items in JSON.







</dd>
    <dt>
    <a name = "BIBLIO_TYPES.yaml"></a>
    <strong>BIBLIO_TYPES.yaml</strong>
    </dt>
    <dd>
    De-/Encode CSL items in YAML.







</dd>
    <dt>
    <a name = "BIBLIO_TYPES.yaml.decode"></a>
    <strong>BIBLIO_TYPES.yaml.decode (str)</strong>
    </dt>
    <dd>
    Parse a CSL YAML string.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">str</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         A CSL YAML string.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">tab</span></span>
        A list of CSL items.
    </ol>




</dd>
    <dt>
    <a name = "BIBLIO_TYPES.yaml.encode"></a>
    <strong>BIBLIO_TYPES.yaml.encode (items)</strong>
    </dt>
    <dd>
    Serialise a list of CSL items to a YAML string.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">items</span>
            <span class="types"><span class="type">tab</span></span>
         A list of CSL items.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        A CSL YAML string.
    </ol>

    <h3>Raises:</h3>
    See <a href="index.html#yamlify">yamlify</a>.



</dd>
    <dt>
    <a name = "BIBLIO_TYPES.yml"></a>
    <strong>BIBLIO_TYPES.yml</strong>
    </dt>
    <dd>
    Alternative suffix for YAML files.







</dd>
    <dt>
    <a name = "biblio_read"></a>
    <strong>biblio_read (fname)</strong>
    </dt>
    <dd>
    Read a bibliography file.</p>

<p> The filename suffix determines what format the contents of the file are
 parsed as. There must be a decoder for that suffix in <a href="index.html#BIBLIO_TYPES">BIBLIO_TYPES</a>.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">fname</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         A filename.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">tab</span></span>
        A list of CSL items.
    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <code>nil</code> if an error occurred.</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        An error message.</li>
        <li>
           <span class="types">optional <span class="type">int</span></span>
        An error number if the error is an I/O error.</li>
    </ol>




</dd>
    <dt>
    <a name = "biblio_write"></a>
    <strong>biblio_write (fname[, items])</strong>
    </dt>
    <dd>
    Write bibliographic data to a bibliography file.</p>

<p> The filename suffix determins what format the data is written as.
 There must be an encoder for that suffix in <a href="index.html#BIBLIO_TYPES">BIBLIO_TYPES</a>.
 Ends every file with <a href="index.html#EOL">EOL</a>.</p>

<p> <h3>Caveats:</h3></p>

<p> See <a href="index.html#file_write">file_write</a>.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">fname</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         A filename.
        </li>
        <li><span class="parameter">items</span>
            <span class="types"><span class="type">tab</span></span>
         A list of CSL items. If no items are given,
  tests whether data can be written in the corresponding format.
         (<em>optional</em>)
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">str</span></span>
        The filename suffix.
    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <code>nil</code> if an error occurred.</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        An error message.</li>
        <li>
           <span class="types">optional <span class="type">int</span></span>
        An error number if the error is an I/O error.</li>
    </ol>

    <h3>Raises:</h3>
    An error if the filename is the empty string.



</dd>
    <dt>
    <a name = "biblio_update"></a>
    <strong>biblio_update (handle, fname, ckeys)</strong>
    </dt>
    <dd>
    Add items from Zotero to a bibliography file.</p>

<p> If an item is already in the bibliography file, it won&rsquo;t be added again.</p>

<p> <a href="https://github.com/jgm/citeproc">Citeproc</a> appears to recognise
 formatting in <em>every</em> CSL field, so <a href="index.html#">pandoc-zotxt.lua</a> does the same.</p>

<p> <h3>Side-effects:</h3></p>

<p> If items cannot be found, an error is printed to STDERR.</p>

<p> <h3>Caveats:</h3></p>

<p> See <a href="index.html#file_write">file_write</a>.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">handle</span>
         A interface to Zotero or the Zotero Web API.
        </li>
        <li><span class="parameter">fname</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         The name of the bibliography file.
        </li>
        <li><span class="parameter">ckeys</span>
            <span class="types"><span class="type">tab</span></span>
         The citation keys of the items that should be added,
  e.g., <code>{&apos;name:2019word&apos;, &apos;name2019WordWordWord&apos;}</code>.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">bool</span></span>
        <code>true</code> if the file was updated or no update was required.
    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <code>nil</code> if an error occurrs.</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        An error message.</li>
        <li>
           <span class="types">optional <span class="type">int</span></span>
        An error number if the error is a file I/O error.</li>
    </ol>

    <h3>Raises:</h3>
    See <a href="index.html#http_get">http_get</a>.



</dd>
</dl>
    <h2 class="section-header "><a name="Document_parsing"></a>Document parsing</h2>

    <dl class="function">
    <dt>
    <a name = "elem_type"></a>
    <strong>elem_type (elem)</strong>
    </dt>
    <dd>
    The type of a Pandoc AST element.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">elem</span>
            <span class="types"><span class="type">pandoc.AstElement</span></span>
         A Pandoc AST element.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        Type
  (e.g., &lsquo;MetaMap&rsquo;, &lsquo;Plain&rsquo;).</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        Super-type
  (i.e., &lsquo;Block&rsquo;, &lsquo;Inline&rsquo;, or &lsquo;MetaValue&rsquo;).</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        &lsquo;AstElement&rsquo;.</li>
    </ol>
     <h3>Or</h3>
    <ol>

           <span class="types"><span class="type">nil</span></span>
        <code>nil</code> if <code>elem</code> is not a Pandoc AST element.
    </ol>




</dd>
    <dt>
    <a name = "walk"></a>
    <strong>walk (elem, filter)</strong>
    </dt>
    <dd>
    Walk the AST and apply functions to matching elements.</p>

<p> Differs from <code>pandoc.walk_block</code> and <code>pandoc.walk_inline</code> by never
 modifying the original element, by accepting AST elements of <em>any</em>
 type (including documents as a whole, the metadata block, and metadata
 fields), by accepting the higher-order type <code>AstElement</code>, by <em>not</em>
 accepting the filter keywords <code>Blocks</code> and <code>Inlines</code>, by walking
 the AST bottom-up (which implies that the filter is applied to every
 element, regardless of whether any of that elements&rsquo;s ancestors
 matches), by applying the filter to the given element itself, and by
 allowing the functions in the filter to return data of arbitrary types
 (as opposed to either a Pandoc AST element or <code>nil</code>).


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">elem</span>
            <span class="types"><span class="type">pandoc.AstElement</span></span>
         A Pandoc AST element.
        </li>
        <li><span class="parameter">filter</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">{string=func,...}</a></span>
         A filter.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

        The element, with the filter applied.
    </ol>




</dd>
    <dt>
    <a name = "meta_sources"></a>
    <strong>meta_sources (meta)</strong>
    </dt>
    <dd>
    Collect bibliographic data from the document&rsquo;s metadata block.</p>

<p> If a metadata field or a bibliography file cannot be parsed,
 an error is printed to STDERR.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">meta</span>
            <span class="types"><span class="type">pandoc.MetaMap</span></span>
         A metadata block.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">pandoc.List</span></span>
        A list of CSL items.
    </ol>




</dd>
    <dt>
    <a name = "doc_ckeys"></a>
    <strong>doc_ckeys (doc[, undef=false])</strong>
    </dt>
    <dd>
    Collect the citation keys used in a document.</p>

<p> If it cannot parse a bibliography file, an error is printed to STDERR.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">doc</span>
            <span class="types"><span class="type">tab</span></span>
         A document.
        </li>
        <li><span class="parameter">undef</span>
            <span class="types"><span class="type">bool</span></span>
         Whether to collect only the citation keys of
  sources that are defined neither in the <code>references</code> metadata field
  nor in a bibliography file.
         (<em>default</em> false)
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">{string,...}</a></span>
        A list of citation keys.</li>
        <li>
           <span class="types"><span class="type">int</span></span>
        The number of citation keys found.</li>
    </ol>

    <h3>Raises:</h3>
    An error if an item ID is of a wrong data type.



</dd>
</dl>
    <h2 class="section-header "><a name="Main"></a>Main</h2>

    <dl class="function">
    <dt>
    <a name = "add_biblio"></a>
    <strong>add_biblio (handle, doc)</strong>
    </dt>
    <dd>
    Add data to a bibliography file and the file to the document&rsquo;s metadata.</p>

<p> Updates the bibliography file as needed and adds it to the <code>bibliography</code>
 metadata field. Interpretes a relative filename as relative to the
 directory of the first input file passed to <strong>pandoc</strong>, or, if not input
 files were given, as relative to the current working directory.</p>

<p> <h3>Side-effects:</h3></p>

<p> If a source cannot be found, an error is printed to STDERR.</p>

<p> <h3>Caveats:</h3></p>

<p> See <a href="index.html#file_write">file_write</a>.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">handle</span>
         A interface to Zotero or the Zotero Web API.
        </li>
        <li><span class="parameter">doc</span>
            <span class="types"><span class="type">pandoc.Pandoc</span></span>
         A Pandoc document, with the metadata field
  <code>zotero-bibliography</code> set to the filename of the bibliography file.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">pandoc.Meta</span></span>
        An updated metadata block, with the field
  <code>bibliography</code> added if needed.
    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <code>nil</code> if no sources were found,
  <code>zotero-bibliography</code> is not set, or an error occurred.</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        An error message, if applicable.</li>
    </ol>

    <h3>Raises:</h3>
    See <a href="index.html#http_get">http_get</a>.



</dd>
    <dt>
    <a name = "add_refs"></a>
    <strong>add_refs (handle, doc)</strong>
    </dt>
    <dd>
    Add bibliographic data to the <code>references</code> metadata field.</p>

<p> <h3>Side-effects:</h3></p>

<p> If a source cannot be found, an error is printed to STDERR.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">handle</span>
         A interface to Zotero or the Zotero Web API.
        </li>
        <li><span class="parameter">doc</span>
            <span class="types"><span class="type">pandoc.Pandoc</span></span>
         A Pandoc document.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
        An updated metadata block,
  with the field <code>references</code> added if needed.
    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <code>nil</code> if no sources were found or an error occurred.</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        An error message, if applicable.</li>
    </ol>

    <h3>Raises:</h3>
    See <a href="index.html#http_get">http_get</a>.



</dd>
    <dt>
    <a name = "meta_param"></a>
    <strong>meta_param (meta, name)</strong>
    </dt>
    <dd>
    Lookup a parameter in the document&rsquo;s metadata field.</p>

<p> Parameter names are translated to metadata field names by
 prefixing them with &lsquo;zotero-&rsquo; and by replacing underscores
 with dashes.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">meta</span>
            <span class="types"><span class="type">pandoc.MetaMap</span></span>
         A metadata block.
        </li>
        <li><span class="parameter">name</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         A parameter name.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

        The value of that parameter.
    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <code>nil</code> if there is no such parameter.</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        An error message.</li>
    </ol>

    <h3>Raises:</h3>
    An error if there is no parameter of that name.



</dd>
    <dt>
    <a name = "meta_params"></a>
    <strong>meta_params (meta)</strong>
    </dt>
    <dd>
    Get parameters from the document&rsquo;s metadata field.</p>

<p> See <a href="index.html#meta_param">meta_param</a> on how parameter names are translated to
 metadata field names.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">meta</span>
            <span class="types"><span class="type">pandoc.MetaMap</span></span>
         A metadata block.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">tab</span></span>
        A mapping of keys to values.
    </ol>




</dd>
    <dt>
    <a name = "main"></a>
    <strong>main (doc)</strong>
    </dt>
    <dd>
    Collect citations and add bibliographic data to a document.</p>

<p> See the manual for details.</p>

<p> <h3>Side-effects:</h3></p>

<p> If errors occur, error messages are printed to STDERR.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">doc</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
         A document.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
        <code>doc</code>, but with bibliographic data added.
    </ol>
     <h3>Or</h3>
    <ol>

           <span class="types"><span class="type">nil</span></span>
        <code>nil</code> if nothing was done or an error occurred.
    </ol>

    <h3>Raises:</h3>
    See <a href="index.html#http_get">http_get</a>.



</dd>
</dl>


</div> <!-- id="content" -->
</div> <!-- id="main" -->
<div id="about">
<i>generated by <a href="http://github.com/stevedonovan/LDoc">LDoc 1.4.6</a></i>
<i style="float:right;">Last updated 2021-11-28 15:59:19 </i>
</div> <!-- id="about" -->
</div> <!-- id="container" -->
</body>
</html>
