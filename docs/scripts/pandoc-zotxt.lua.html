<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<head>
    <title>Reference</title>
    <link rel="stylesheet" href="../ldoc.css" type="text/css" />
</head>
<body>

<div id="container">

<div id="product">
	<div id="product_logo"></div>
	<div id="product_name"><big><b></b></big></div>
	<div id="product_description"></div>
</div> <!-- id="product" -->


<div id="main">


<!-- Menu -->

<div id="navigation">
<br/>
<h1>pandoc-zotxt.lua</h1>


<h2>Contents</h2>
<ul>
<li><a href="#Functions">Functions</a></li>
<li><a href="#Tables">Tables</a></li>
<li><a href="#Fields">Fields</a></li>
</ul>


<h2>Scripts</h2>
<ul class="nowrap">
  <li><strong>pandoc-zotxt.lua</strong></li>
</ul>
<h2>Topics</h2>
<ul class="">
  <li><a href="../topics/README.md.html">README</a></li>
</ul>

</div>

<div id="content">

<h1>Script <code>pandoc-zotxt.lua</code></h1>
<p>
<h2>SYNOPSIS</h2>

<p> <strong>pandoc</strong> <strong>-L</strong> <em>pandoc-zotxt.lua</em> <strong>-C</strong></p>


<h2> DESCRIPTION</h2>

<p> <strong>pandoc-zotxt.lua</strong> looks up sources of citations in Zotero and adds them
 either to a document's "references" metadata field or to a bibliography file,
 where <strong>pandoc</strong> can pick them up.</p>
</p>
<p> Cite your sources using "easy citekeys" (provided by <em>zotxt</em>) or "Better BibTeX
 Citation Keys" (provided by Better BibTeX for Zotero). Then tell <strong>pandoc</strong> to
 filter your document through <strong>pandoc-zotxt.lua</strong> before processing citations.
 Zotero must be running, of course. That's all there is to it.</p>

<p> <strong>pandoc-zotxt.lua</strong> only queries Zotero for sources that are defined neither
 in the "references" metadata field nor in any bibliography file.</p>


<h2> BIBLIOGRAPHY FILES</h2>

<p> If you set the "zotero-bibliography" metadata field to a filename, then
 <strong>pandoc-zotxt.lua</strong> adds sources to that file, rather than to the
 "references" metadata field. This speeds up subsequent processing
 of the same document, because <strong>pandoc-zotxt.lua</strong> will only fetch those
 sources from Zotero that are not yet in that file. It will also add the
 path of that file to the document's "bibliography" metadata field, so that
 <strong>pandoc</strong> picks up those sources (if you have already set another
 bibliography file, it neither changes that file nor removes it from the
 document's metadata; Pandoc will process both files).</p>

<p> The biblography is stored as a JSON file, so the filename must end with
 ".json". You can safely set "zotero-bibliography" and "bibliography" at
 the same time.</p>

<p> <strong>pandoc-zotxt.lua</strong> interprets relative filenames as relative to the
 directory of the first input file that you pass to <strong>pandoc</strong> or, if you
 do not pass any input file, as relative to the current working directory.
 However, you may want to use a single bibliography file for all of your
 documents.</p>

<p> <strong>pandoc-zotxt.lua</strong> only ever adds sources to the bibliography file.
 It doesn't update or delete them. If you want to update the sources in your
 bibliography file, delete it. <strong>pandoc-zotxt.lua</strong> will then regenerate
 it from scratch.</p>


<h2> EXAMPLES</h2>


<pre>
pandoc -L pandoc-zotxt.lua -C &lt;&lt;EOF
See @doe2020Title <span class="keyword">for</span> details.
EOF
</pre>

<p> This instructs Pandoc to filter the input through <strong>pandoc-zotxt.lua</strong>,
 which then looks up the bibligraphic data of the source with the citation
 key "doe2020Title" in Zotero before Pandoc processes citations.</p>


<pre>
pandoc -L pandoc-zotxt.lua -C &lt;&lt;EOF
<span class="comment">---
</span>zotero-bibliography: bibliography.json
<span class="comment">---
</span>See @doe2020Title <span class="keyword">for</span> details.
EOF
</pre>

<p> This instructs <strong>pandoc-zotxt.lua</strong> to store bibliographic data in a file
 named "bibliography.json" and to add that file to the metadata field
 "bibliography", so that Pandoc picks it up. "bibliography.json" is placed in
 the same directory as "document.md", since "document.md" is the first input
 file given. The next time you process "document.md", <strong>pandoc-zotxt.lua</strong> will
 <em>not</em> look up "doe2020Title" in Zotero, since "bibliography.json" already
 contains data for that source.</p>


<h2> KNOWN ISSUES</h2>

<p> Zotero, from v5.0.71 onwards, does not allow browsers to access its
 interface. It defines "browser" as any user agent that sets the "User
 Agent" HTTP header to a string that starts with "Mozilla/". However,
 Zotero v5.0.71 and v5.0.72 fail to handle HTTP requests from user
 agents that do not set the "User Agent" HTTP header. And <strong>pandoc</strong> does
 not. As a consequence, <strong>pandoc-zotxt.lua</strong> cannot retrieve data from these
 versions of Zotero, that is, unless you tell <strong>pandoc</strong> to set that header.
 If you cannot upgrade to a more recent version of Zotero, you can make
 <strong>pandoc</strong> set that header by passing, for instance, <strong>--request-header</strong>
 <em>User-Agent:Pandoc/2</em>. If you must set the "User Agent" HTTP header to a
 string that starts with "Mozilla/", you can still get <strong>pandoc</strong> to connect
 to Zotero by setting the HTTP header "Zotero-Allowed-Request". You do so by
 passing <strong>--request-header</strong> <em>Zotero-Allowed-Request:X</em>.</p>


<h2> KNOWN ISSUES</h2>

<p> <strong>pandoc-zotxt.lua</strong> ignores Pandoc's <strong>--resource-path</strong> option.</p>


<h2> CAVEATS</h2>

<p> <strong>pandoc-zotxt.lua</strong> is Unicode-agnostic.</p>


<h2> SEE ALSO</h2>

<ul>
    <li><a href="https://github.com/egh/zotxt">zotxt</a></li>
    <li><a href="https://retorque.re/zotero-better-bibtex/">Better BibTeX</a></li>
</ul>

<p> pandoc(1)</p>
    <h3>Info:</h3>
    <ul>
        <li><strong>Copyright</strong>: 2018, 2019, 2020 Odin Kroeger</li>
        <li><strong>Release</strong>: 1.0.1b</li>
        <li><strong>License</strong>: MIT</li>
        <li><strong>Author</strong>: Odin Kroeger</li>
    </ul>


<h2><a href="#Functions">Functions</a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#split_path">split_path (path)</a></td>
	<td class="summary">Splits a file's path into a directory and a filename part.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#warn">warn (msg, ...)</a></td>
	<td class="summary">Prints warnings to STDERR.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#is_path_absolute">is_path_absolute (path)</a></td>
	<td class="summary">Checks if a path is absolute.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#get_input_directory">get_input_directory ()</a></td>
	<td class="summary">Returns the directory of the first input file or '.'.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#read_file">read_file (fname)</a></td>
	<td class="summary">Returns the content of a file.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#write_file">write_file (str, fname)</a></td>
	<td class="summary">Writes data to a file.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#read_json_file">read_json_file (fname)</a></td>
	<td class="summary">Reads a JSON file.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#write_json_file">write_json_file (data, fname)</a></td>
	<td class="summary">Writes JSON data to a file.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#read_yaml_file">read_yaml_file (fname)</a></td>
	<td class="summary">Reads a CSL YAML file.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#read_url">read_url (url)</a></td>
	<td class="summary">Retrieves data from a URL via an HTTP GET request.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#conv_nums_to_strs">conv_nums_to_strs (data)</a></td>
	<td class="summary">Converts all numbers in a multi-dimensional table to strings.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#get_source_csljson">get_source_csljson (citekey, parse)</a></td>
	<td class="summary">Retrieves bibliographic data (low-level).</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#get_source_csl">get_source_csl (citekey)</a></td>
	<td class="summary">Retrieves bibliographic data (for use in JSON files).</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#get_source">get_source (citekey)</a></td>
	<td class="summary">Retrieves bibliographic data (for <code>references</code> metadata field).</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#get_used_citekeys">get_used_citekeys (doc)</a></td>
	<td class="summary">Collects citation keys used in document.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#get_refs_citekeys">get_refs_citekeys (doc)</a></td>
	<td class="summary">Returns citation keys in <code>references</code> metadata field.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#get_biblio_citekeys">get_biblio_citekeys (doc)</a></td>
	<td class="summary">Returns the citation keys in bibliography files.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#update_bibliography">update_bibliography (citekeys, fname)</a></td>
	<td class="summary">Adds sources to a bibliography file.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#add_bibliography">add_bibliography (citekeys, meta)</a></td>
	<td class="summary">Adds sources to a bibliography file and that file to the metadata.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#add_references">add_references (citekeys, meta)</a></td>
	<td class="summary">Adds sources to <code>references</code> metadata field.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#main">main (doc)</a></td>
	<td class="summary">Collects sources and adds bibliographic data to a document.</td>
	</tr>
</table>
<h2><a href="#Tables">Tables</a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#ZOTXT_KEYTYPES">ZOTXT_KEYTYPES</a></td>
	<td class="summary">Types of citation keys.</td>
	</tr>
</table>
<h2><a href="#Fields">Fields</a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#NAME">NAME</a></td>
	<td class="summary">The name of this script.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#VERSION">VERSION</a></td>
	<td class="summary">The version of this script.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#PATH_SEP">PATH_SEP</a></td>
	<td class="summary">The path seperator of the operating system.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#EOL">EOL</a></td>
	<td class="summary">The end of line sequence of the operating system.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#ZOTXT_BASE_URL">ZOTXT_BASE_URL</a></td>
	<td class="summary">The URL to lookup citation data.</td>
	</tr>
</table>

<br/>
<br/>


    <h2 class="section-header "><a name="Functions"></a>Functions</h2>

    <dl class="function">
    <dt>
    <a name = "split_path"></a>
    <strong>split_path (path)</strong>
    </dt>
    <dd>
    Splits a file's path into a directory and a filename part.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">path</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         The path to the file.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        The file's path.</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         The file's name.</p>

<p> This function makes an educated guess given the string it's passed.
 It doesn't look at the filesystem. The guess is educated enough though.</li>
    </ol>




</dd>
    <dt>
    <a name = "warn"></a>
    <strong>warn (msg, ...)</strong>
    </dt>
    <dd>
    Prints warnings to STDERR. </p>

<p> Prefixes messages with <a href="../index.html#NAME">NAME</a> and ": ".
 Also appends <a href="../index.html#EOL">EOL</a>.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">msg</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         A message to write to STDERR.
        </li>
        <li><span class="parameter">...</span>
         Arguments (think <a href="https://www.lua.org/manual/5.1/manual.html#pdf-string.format">string.format</a>) for <code>msg</code>.
        </li>
    </ul>





</dd>
    <dt>
    <a name = "is_path_absolute"></a>
    <strong>is_path_absolute (path)</strong>
    </dt>
    <dd>
    Checks if a path is absolute.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">path</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         A path.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">bool</span></span>
        <code>true</code> if the path is absolute, <code>false</code> otherwise.
    </ol>




</dd>
    <dt>
    <a name = "get_input_directory"></a>
    <strong>get_input_directory ()</strong>
    </dt>
    <dd>
    Returns the directory of the first input file or '.'.



    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        The directory the first input file is in.
    </ol>




</dd>
    <dt>
    <a name = "read_file"></a>
    <strong>read_file (fname)</strong>
    </dt>
    <dd>
    Returns the content of a file.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">fname</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         Name of the file.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        The content of the file.
    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <code>nil</code> if an error occurred.</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        An error message.</li>
        <li>
           <span class="types"><span class="type">int</span></span>
        The error number.</li>
    </ol>




</dd>
    <dt>
    <a name = "write_file"></a>
    <strong>write_file (str, fname)</strong>
    </dt>
    <dd>
    Writes data to a file.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">str</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         Data.
        </li>
        <li><span class="parameter">fname</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         Name of the file.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">bool</span></span>
        <code>true</code> if <code>data</code> was written to the file.
    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <code>nil</code> if an error occurred.</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        An error message.</li>
        <li>
           <span class="types"><span class="type">int</span></span>
        The error number.</li>
    </ol>




</dd>
    <dt>
    <a name = "read_json_file"></a>
    <strong>read_json_file (fname)</strong>
    </dt>
    <dd>
    Reads a JSON file.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">fname</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         Name of the file.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

        The parsed data.
    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <code>nil</code> if an error occurred.</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        An error message.</li>
        <li>
           <span class="types"><span class="type">int</span></span>
         An error number.
  Positive numbers are OS error numbers,
  negative numbers indicate a JSON decoding error.</li>
    </ol>




</dd>
    <dt>
    <a name = "write_json_file"></a>
    <strong>write_json_file (data, fname)</strong>
    </dt>
    <dd>
    Writes JSON data to a file. </p>

<p> Terminates files with <a href="../index.html#EOL">EOL</a>.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">data</span>
         Data.
        </li>
        <li><span class="parameter">fname</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         Name of the file.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">bool</span></span>
        <code>true</code> if <code>data</code> was written to the file.
    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <code>nil</code> if an error occurred.</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        An error message.</li>
        <li>
           <span class="types"><span class="type">int</span></span>
         An error number.
  Positive numbers are OS error numbers,
  negative numbers indicate a JSON decoding error.</li>
    </ol>




</dd>
    <dt>
    <a name = "read_yaml_file"></a>
    <strong>read_yaml_file (fname)</strong>
    </dt>
    <dd>
    Reads a CSL YAML file.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">fname</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         Name of the file.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

        The parsed data.
    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <code>nil</code> if the file could not be read.</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        An error message.</li>
        <li>
           <span class="types"><span class="type">int</span></span>
         An error number.
  Positive numbers are OS error numbers,
  negative numbers indicate a YAML decoding error.</li>
    </ol>

    <h3>Raises:</h3>
     An error if the given YAML code cannot be decoded.
  But only if you are <em>not</em> using Pandoc v2.10 or later.
  This error cannot be caught.



</dd>
    <dt>
    <a name = "read_url"></a>
    <strong>read_url (url)</strong>
    </dt>
    <dd>
    Retrieves data from a URL via an HTTP GET request. </p>

<p> This is a function of its own only in order for the test scripts to
 be able to easily replace it with a function that redirects HTTP GET
 requests to canned responses.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">url</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         The URL.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        The data.
    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <code>nil</code> if no data could be retrieved. But only if you
  are using Pandoc v2.10 or later. Otherwise an error is raised.</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        An error message.</li>
        <li>
           <span class="types"><span class="type">userdata</span></span>
        A pandoc error value.</li>
    </ol>

    <h3>Raises:</h3>
    An error if no data can be retrieved. But only if you are <em>not</em>
  using Pandoc v2.10 or later. This error cannot be caught.



</dd>
    <dt>
    <a name = "conv_nums_to_strs"></a>
    <strong>conv_nums_to_strs (data)</strong>
    </dt>
    <dd>
    Converts all numbers in a multi-dimensional table to strings. </p>

<p> Also converts floating point numbers to integers. This is needed
 because all numbers are floating point numbers in JSON, but some
 versions of Pandoc expect integers.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">data</span>
         Data of any type.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

        The given data, with all numbers converted into strings.
    </ol>




</dd>
    <dt>
    <a name = "get_source_csljson"></a>
    <strong>get_source_csljson (citekey, parse)</strong>
    </dt>
    <dd>
    Retrieves bibliographic data (low-level). </p>

<p> Takes a citation key and a parsing function, queries <em>zotxt</em> for that
 citation key, passes whatever <em>zotxt</em> returns to the parsing function,
 and then returns whatever the parsing function returns.</p>

<p> Tries every citation key type defined in <a href="../index.html#ZOTXT_KEYTYPES">ZOTXT_KEYTYPES</a>, until
 the query is successful, that is, the parsing function does <em>not</em>
 raise an error. If the parsing function raises an error, the
 next citation key type is tried.</p>

<p> This is a low-level function and should not be called directly.
 Use <a href="../index.html#get_source">get_source</a> or <a href="../index.html#get_source_csl">get_source_csl</a>.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">citekey</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         The citation key of the source,
  e.g., 'name:2019word', 'name2019TwoWords'.
        </li>
        <li><span class="parameter">parse</span>
            <span class="types"><span class="type">func</span></span>
         A function takes a CSL JSON string and
  returns bibliophic data.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        A CSL JSON string.
    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <code>nil</code> if an error occurred.</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        An error message.</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         The type of error that occurred, where
  <code>read_err</code> means that no data could be read from zotxt, and
  <code>no_match</code> that no meaningful data could be found for <code>citekey</code>.</li>
    </ol>

    <h3>Raises:</h3>
     An error if <code>citekey</code> is the empty string or
  if no data can be read from zotxt <em>and</em> you are <em>not</em>
  using Pandoc v2.10 or later. The latter error cannot be caught.



</dd>
    <dt>
    <a name = "get_source_csl"></a>
    <strong>get_source_csl (citekey)</strong>
    </dt>
    <dd>
    Retrieves bibliographic data (for use in JSON files). </p>

<p> Returns bibliographic data as Lua data structure, <em>not</em> as a Pandoc
 data structure. That is, the return value of this function can be
 passed to <a href="../index.html#write_json_file">write_json_file</a>, but should <em>not</em> be stored in the
 <code>references</code> metadata field. (Unless you are using a version of
 Pandoc prior to v2.11.)


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">citekey</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         The citation key of the source,
  e.g., 'name:2019word', 'name2019TwoWords'.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
        A CSL item.
    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <code>nil</code> if the source wasn't found or an error occurred.</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        An error message.</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        The type of that error. See <a href="../index.html#get_source_csljson">get_source_csljson</a>.</li>
    </ol>

    <h3>Raises:</h3>
    See <a href="../index.html#get_source_csljson">get_source_csljson</a>.



</dd>
    <dt>
    <a name = "get_source"></a>
    <strong>get_source (citekey)</strong>
    </dt>
    <dd>
    Retrieves bibliographic data (for <code>references</code> metadata field). </p>

<p> Returns data as a Pandoc data structure, which can be used in the
 <code>references</code> metadata field. (Regardless of what version of Pandoc
 you use.)


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">citekey</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         The citation key of the source,
  e.g., 'name:2019word', 'name2019TwoWords'.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
        Bibliographic data for that item.
    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <code>nil</code> if the source wasn't found or an error occurred.</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        An error message.</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        The type of that error. See <a href="../index.html#get_source_csljson">get_source_csljson</a>.</li>
    </ol>

    <h3>Raises:</h3>
    See <a href="../index.html#get_source_csljson">get_source_csljson</a>.



</dd>
    <dt>
    <a name = "get_used_citekeys"></a>
    <strong>get_used_citekeys (doc)</strong>
    </dt>
    <dd>
    Collects citation keys used in document.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">doc</span>
            <span class="types"><span class="type">pandoc.Doc</span></span>
         A document.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
        A <a href="https://www.lua.org/pil/11.5.html">Set</a> of citation keys.
    </ol>




</dd>
    <dt>
    <a name = "get_refs_citekeys"></a>
    <strong>get_refs_citekeys (doc)</strong>
    </dt>
    <dd>
    Returns citation keys in <code>references</code> metadata field.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">doc</span>
            <span class="types"><span class="type">pandoc.Doc</span></span>
         A document.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
        A <a href="https://www.lua.org/pil/11.5.html">Set</a> of citation keys.
    </ol>




</dd>
    <dt>
    <a name = "get_biblio_citekeys"></a>
    <strong>get_biblio_citekeys (doc)</strong>
    </dt>
    <dd>
    Returns the citation keys in bibliography files.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">doc</span>
            <span class="types"><span class="type">pandoc.Doc</span></span>
         A document.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
        A <a href="https://www.lua.org/pil/11.5.html">Set</a> of citation keys.
    </ol>




</dd>
    <dt>
    <a name = "update_bibliography"></a>
    <strong>update_bibliography (citekeys, fname)</strong>
    </dt>
    <dd>
    Adds sources to a bibliography file. </p>

<p> If a source is already in the bibliography file, the data of that source
 will <em>not</em> be updated in the file.</p>

<p> Prints an error message to STDERR for every source that cannot be found.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">citekeys</span>
            <span class="types"><span class="type">tab</span></span>
         <a href="https://www.lua.org/pil/11.5.html">Set</a>
  of citation keys that should be added, e.g.,
  <code>{[&apos;name:2019word&apos;]=true, &apos;name2019WordWordWord&apos;=true}</code>.
        </li>
        <li><span class="parameter">fname</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         The name of the bibliography file.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">bool</span></span>
        <code>true</code> if the bibliography file was updated
  or no update was needed.
    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <code>nil</code> if an error occurrs.</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        An error message, if applicable.</li>
        <li>
           <span class="types"><span class="type">int</span></span>
         An error number, if applicable.
  Positive numbers are OS error numbers,
  a negative number indicates that no data could be retrieved.</li>
    </ol>

    <h3>Raises:</h3>
    See <a href="../index.html#get_source_csljson">get_source_csljson</a>.



</dd>
    <dt>
    <a name = "add_bibliography"></a>
    <strong>add_bibliography (citekeys, meta)</strong>
    </dt>
    <dd>
    Adds sources to a bibliography file and that file to the metadata. </p>

<p> Behaves in the same way as <a href="../index.html#update_bibliography">update_bibliography</a>, but also adds the
 the given bibliography file to the metadata field <code>bibliography</code>
 (existing bibliography files are kept).


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">citekeys</span>
            <span class="types"><span class="type">tab</span></span>
         <a href="https://www.lua.org/pil/11.5.html">Set</a>
  of citation keys that should be added, e.g.,
  <code>{[&apos;name:2019word&apos;]=true, &apos;name2019WordWordWord&apos;=true}</code>.
        </li>
        <li><span class="parameter">meta</span>
            <span class="types"><span class="type">pandoc.Meta</span></span>
         A metadata block, with the field
  <code>zotero-bibliography</code> set to the filename of the bibliography file.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">pandoc.Meta</span></span>
        An updated metadata block, with the field
  <code>bibliography</code> added if needed.
    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <code>nil</code> if no sources were found,
  <code>zotero-bibliography</code> is not set, or an error occurred.</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        An error message, if applicable.</li>
    </ol>

    <h3>Raises:</h3>
    See <a href="../index.html#get_source_csljson">get_source_csljson</a>.



</dd>
    <dt>
    <a name = "add_references"></a>
    <strong>add_references (citekeys, meta)</strong>
    </dt>
    <dd>

<p>Adds sources to <code>references</code> metadata field. </p>

<p> Prints an error message to STDERR for</p>

<ul>
    <li>every source that cannot be found.</li>
    <li>every citation key that is defined more than once.</li>
</ul>




    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">citekeys</span>
            <span class="types"><span class="type">tab</span></span>
         <a href="https://www.lua.org/pil/11.5.html">Set</a>
  of citation keys that should be added, e.g.,
  <code>{[&apos;name:2019word&apos;]=true, &apos;name2019WordWordWord&apos;=true}</code>.
        </li>
        <li><span class="parameter">meta</span>
            <span class="types"><span class="type">pandoc.Meta</span></span>
         A metadata block.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">pandoc.Meta</span></span>
        An updated metadata block,
  with the field <code>references</code> added if needed.
    </ol>
     <h3>Or</h3>
    <ol>
        <li>
           <span class="types"><span class="type">nil</span></span>
        <code>nil</code> if no sources were found or an error occurred.</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        An error message, if applicable.</li>
    </ol>

    <h3>Raises:</h3>
    See <a href="../index.html#get_source_csljson">get_source_csljson</a>.



</dd>
    <dt>
    <a name = "main"></a>
    <strong>main (doc)</strong>
    </dt>
    <dd>
    Collects sources and adds bibliographic data to a document. </p>

<p> Prints messages to STDERR if errors occur.</p>

<p> See the manual for detais.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">doc</span>
            <span class="types"><span class="type">pandoc.Pandoc</span></span>
         A document.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">pandoc.Pandoc</span></span>
        <code>doc</code>, but with bibliographic data added.
    </ol>
     <h3>Or</h3>
    <ol>

           <span class="types"><span class="type">nil</span></span>
        <code>nil</code> if nothing was done or an error occurred.
    </ol>

    <h3>Raises:</h3>
    See <a href="../index.html#get_source_csljson">get_source_csljson</a>.



</dd>
</dl>
    <h2 class="section-header "><a name="Tables"></a>Tables</h2>

    <dl class="function">
    <dt>
    <a name = "ZOTXT_KEYTYPES"></a>
    <strong>ZOTXT_KEYTYPES</strong>
    </dt>
    <dd>
    Types of citation keys. </p>

<p> See <a href="../index.html#get_source_csljson">get_source_csljson</a> and <a href="https://github.com/egh/zotxt">https://github.com/egh/zotxt</a> for details.


    <h3>Fields:</h3>
    <ul>
        <li><span class="parameter">betterbibtexkey</span>
        Better BibTeX citation key
        </li>
        <li><span class="parameter">easykey</span>
        zotxt easy citekey
        </li>
        <li><span class="parameter">key</span>
        Zotero item ID
        </li>
    </ul>





</dd>
</dl>
    <h2 class="section-header "><a name="Fields"></a>Fields</h2>

    <dl class="function">
    <dt>
    <a name = "NAME"></a>
    <strong>NAME</strong>
    </dt>
    <dd>
    The name of this script.







</dd>
    <dt>
    <a name = "VERSION"></a>
    <strong>VERSION</strong>
    </dt>
    <dd>
    The version of this script.







</dd>
    <dt>
    <a name = "PATH_SEP"></a>
    <strong>PATH_SEP</strong>
    </dt>
    <dd>
    The path seperator of the operating system.







</dd>
    <dt>
    <a name = "EOL"></a>
    <strong>EOL</strong>
    </dt>
    <dd>
    The end of line sequence of the operating system.







</dd>
    <dt>
    <a name = "ZOTXT_BASE_URL"></a>
    <strong>ZOTXT_BASE_URL</strong>
    </dt>
    <dd>
    The URL to lookup citation data. </p>

<p> See <a href="../index.html#get_source_csljson">get_source_csljson</a> and <a href="https://github.com/egh/zotxt">https://github.com/egh/zotxt</a> for details.







</dd>
</dl>


</div> <!-- id="content" -->
</div> <!-- id="main" -->
<div id="about">
<i>generated by <a href="http://github.com/stevedonovan/LDoc">LDoc 1.4.6</a></i>
<i style="float:right;">Last updated 2021-04-05 19:01:49 </i>
</div> <!-- id="about" -->
</div> <!-- id="container" -->
</body>
</html>
