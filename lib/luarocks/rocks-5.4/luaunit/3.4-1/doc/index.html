
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Welcome to LuaUnit’s documentation! &#8212; LuaUnit 3.3 documentation</title>
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="nav-item nav-item-0"><a href="#">LuaUnit 3.3 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Welcome to LuaUnit’s documentation!</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="welcome-to-luaunit-s-documentation">
<h1>Welcome to LuaUnit’s documentation!<a class="headerlink" href="#welcome-to-luaunit-s-documentation" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>LuaUnit is a popular unit-testing framework for Lua, with an interface typical
of xUnit libraries (Python unittest, Junit, NUnit, …). It supports
several output formats (Text, TAP, JUnit, …) to be used directly or work with Continuous Integration platforms
(Jenkins, Hudson, …).</p>
<p>For simplicity, LuaUnit is contained into a single-file and has no external dependency. To start using it,
just add the file <em>luaunit.lua</em> to your project. A <a class="reference external" href="https://luarocks.org/modules/bluebird75/luaunit">LuaRocks package</a>  is also available.</p>
<p>Tutorial and reference documentation is available on <a class="reference external" href="http://luaunit.readthedocs.org/en/latest/">Read-the-docs</a> .</p>
<p>LuaUnit also provides some dedicated support to scientific computing. See the section <a class="reference internal" href="#scientific-computing-and-luaunit">Scientific computing and LuaUnit</a></p>
<p>LuaUnit may also be used as an assertion library. In that case, you will call the assertion functions, which generate errors
when the assertion fails. The error includes a detailed analysis of the failed assertion, like when executing a test suite.</p>
<p>LuaUnit provides another generic usage function: <a class="reference internal" href="#prettystr" title="prettystr"><code class="xref py py-func docutils literal notranslate"><span class="pre">prettystr()</span></code></a> which converts any value to a nicely
formatted string. It supports in particular tables, nested table and even recursive tables.</p>
</div>
<div class="section" id="more-details">
<h2>More details<a class="headerlink" href="#more-details" title="Permalink to this headline">¶</a></h2>
<p>LuaUnit provides a wide range of assertions and goes into great efforts to provide the most useful output. For example
since version 3.3 , comparing lists will provide a detailed difference analysis:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>-- lua test code. Can you spot the difference ?
function TestListCompare:test1()
    local A = { 121221, 122211, 121221, 122211, 121221, 122212, 121212, 122112, 122121, 121212, 122121 }
    local B = { 121221, 122211, 121221, 122211, 121221, 122212, 121212, 122112, 121221, 121212, 122121 }
    lu.assertEquals( A, B )
end

$ lua test_some_lists_comparison.lua

TestListCompare.test1 ... FAIL
test/some_lists_comparisons.lua:22: expected:

List difference analysis:
* lists A (actual) and B (expected) have the same size
* lists A and B start differing at index 9
* lists A and B are equal again from index 10
* Common parts:
  = A[1], B[1]: 121221
  = A[2], B[2]: 122211
  = A[3], B[3]: 121221
  = A[4], B[4]: 122211
  = A[5], B[5]: 121221
  = A[6], B[6]: 122212
  = A[7], B[7]: 121212
  = A[8], B[8]: 122112
* Differing parts:
  - A[9]: 122121
  + B[9]: 121221
* Common parts at the end of the lists
  = A[10], B[10]: 121212
  = A[11], B[11]: 122121
</pre></div>
</div>
<p>The command-line options provide a flexible interface to select tests by name or patterns, control output
format, set verbosity and more. See <a class="reference internal" href="#using-the-command-line">Using the command-line</a> .</p>
<p>LuaUnit is very well tested: code coverage is 99.5% . The test suite is run on every version of Lua (Lua 5.1 to 5.3, LuaJIT 2.0 and 2.1 beta)
and on many OS (Windows Seven, Windows Server 2012, MacOs X and Ubuntu). You can check the continuous build results on <a class="reference external" href="https://travis-ci.org/bluebird75/luaunit">Travis-CI</a> and <a class="reference external" href="https://ci.appveyor.com/project/bluebird75/luaunit/history">AppVeyor</a> .</p>
<p>LuaUnit is maintained on GitHub: <a class="reference external" href="https://github.com/bluebird75/luaunit">https://github.com/bluebird75/luaunit</a> . We gladly accept feature requests and even better Pull Requests.</p>
<p>LuaUnit is released under the BSD license.</p>
<div class="section" id="installation">
<h3>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h3>
<p>LuaUnit is packed into a single-file. To make start using it, just add the file to your project.</p>
<p>Several installation methods are available.</p>
<div class="section" id="luarocks">
<h4>LuaRocks<a class="headerlink" href="#luarocks" title="Permalink to this headline">¶</a></h4>
<p>LuaUnit is available as a <a class="reference external" href="https://luarocks.org/modules/bluebird75/luaunit">LuaRocks package</a> .</p>
</div>
<div class="section" id="github">
<h4>GitHub<a class="headerlink" href="#github" title="Permalink to this headline">¶</a></h4>
<p>The simplest way to install LuaUnit is to fetch the GitHub version:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git clone git@github.com:bluebird75/luaunit.git
</pre></div>
</div>
<p>Then copy the file luaunit.lua into your project or the Lua libs directory.</p>
<p>The version in development on GitHub is always stable and can be used safely.</p>
<p>On Linux, you can also install it into your Lua directories</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo python doit.py install
</pre></div>
</div>
<p>If that fail, edit the function <em>install()</em> in the file <em>doit.py</em> to adjust
the Lua version and installation directory. It uses, by default, Linux paths that depend on the version.</p>
</div>
</div>
<div class="section" id="upgrade-note">
<h3>Upgrade note<a class="headerlink" href="#upgrade-note" title="Permalink to this headline">¶</a></h3>
<p><strong>Important note when upgrading from version below 3.1</strong> : there is a break of backward compatibility in version 3.1, assertions functions are no longer exported directly to the global namespace. See <a class="reference internal" href="#luaunit-global-asserts"><span class="std std-ref">Enabling global or module-level functions</span></a> on how to adjust or restore previous behavior.</p>
</div>
<div class="section" id="luaunit-development">
<h3>LuaUnit development<a class="headerlink" href="#luaunit-development" title="Permalink to this headline">¶</a></h3>
<p>See <a class="reference internal" href="#developing-luaunit">Developing luaunit</a></p>
</div>
<div class="section" id="version-and-changelog">
<h3>Version and Changelog<a class="headerlink" href="#version-and-changelog" title="Permalink to this headline">¶</a></h3>
<p>This documentation describes the functionality of LuaUnit v3.2 .</p>
<div class="section" id="new-in-version-3-4-02-march-2021">
<h4>New in version 3.4 - 02 March 2021<a class="headerlink" href="#new-in-version-3-4-02-march-2021" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>support for Lua 5.4</p></li>
<li><p><a class="reference internal" href="#assertAlmostEquals" title="assertAlmostEquals"><code class="xref py py-func docutils literal notranslate"><span class="pre">assertAlmostEquals()</span></code></a> works also on tables and nested structures</p></li>
<li><p>choose test output style with environment variable <cite>LUAUNIT_OUTPUT</cite></p></li>
<li><p><code class="xref py py-func docutils literal notranslate"><span class="pre">runner:setOutputType()</span></code> accepts the xml filename as second argument when using the format <em>junit</em></p></li>
<li><p>improve printing of table information in case of cycles</p></li>
<li><p>add ability to skip tests with <a class="reference internal" href="#skip" title="skip"><code class="xref py py-func docutils literal notranslate"><span class="pre">skip()</span></code></a> and <a class="reference internal" href="#skipIf" title="skipIf"><code class="xref py py-func docutils literal notranslate"><span class="pre">skipIf()</span></code></a></p></li>
<li><p>detect attempts to exit the test suite before it is finished running</p></li>
<li><p>add <a class="reference internal" href="#assertErrorMsgContentEquals" title="assertErrorMsgContentEquals"><code class="xref py py-func docutils literal notranslate"><span class="pre">assertErrorMsgContentEquals()</span></code></a> to validate exactly any error message</p></li>
<li><p>filter out some stack entries when printing assertions (useful when embedding LuaUnit inside another test layer) with <a class="reference internal" href="#strip-extra-entries-in-stack-trace"><span class="std std-ref">luaunit.STRIP_EXTRA_ENTRIES_IN_STACK_TRACE</span></a></p></li>
<li><p>add <a class="reference internal" href="#assertTableContains" title="assertTableContains"><code class="xref py py-func docutils literal notranslate"><span class="pre">assertTableContains()</span></code></a> and <a class="reference internal" href="#assertNotTableContains" title="assertNotTableContains"><code class="xref py py-func docutils literal notranslate"><span class="pre">assertNotTableContains()</span></code></a> to verify the presence of a given value within a table</p></li>
<li><p>remove option <cite>TABLE_EQUALS_KEYBYCONTENT</cite>, it did not make sense</p></li>
<li><dl class="simple">
<dt>bugfix:</dt><dd><ul>
<li><p><a class="reference internal" href="#assertIs" title="assertIs"><code class="xref py py-func docutils literal notranslate"><span class="pre">assertIs()</span></code></a>/<a class="reference internal" href="#assertNotIs" title="assertNotIs"><code class="xref py py-func docutils literal notranslate"><span class="pre">assertNotIs()</span></code></a> deals better with protected metatables</p></li>
<li><p><a class="reference internal" href="#assertEquals" title="assertEquals"><code class="xref py py-func docutils literal notranslate"><span class="pre">assertEquals()</span></code></a> deals better with tables containing cycles of different structure</p></li>
<li><p>fix table length comparison for table returning inconsistent length</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="new-in-version-3-3-6-mar-2018">
<h4>New in version 3.3 - 6. Mar 2018<a class="headerlink" href="#new-in-version-3-3-6-mar-2018" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><dl class="simple">
<dt>General</dt><dd><ul>
<li><p>when comparing lists with <a class="reference internal" href="#assertEquals" title="assertEquals"><code class="xref py py-func docutils literal notranslate"><span class="pre">assertEquals()</span></code></a>, failure message provides an advanced comparison of the lists</p></li>
<li><p><a class="reference internal" href="#assertErrorMsgEquals" title="assertErrorMsgEquals"><code class="xref py py-func docutils literal notranslate"><span class="pre">assertErrorMsgEquals()</span></code></a> can check for error raised as tables</p></li>
<li><p>tests may be finished early with <a class="reference internal" href="#fail" title="fail"><code class="xref py py-func docutils literal notranslate"><span class="pre">fail()</span></code></a>, <a class="reference internal" href="#failIf" title="failIf"><code class="xref py py-func docutils literal notranslate"><span class="pre">failIf()</span></code></a>, <a class="reference internal" href="#success" title="success"><code class="xref py py-func docutils literal notranslate"><span class="pre">success()</span></code></a> or <a class="reference internal" href="#successIf" title="successIf"><code class="xref py py-func docutils literal notranslate"><span class="pre">successIf()</span></code></a></p></li>
<li><p>improve printing of recursive tables</p></li>
<li><p>improvements and fixes to JUnit and TAP output</p></li>
<li><p>stricter <a class="reference internal" href="#assertTrue" title="assertTrue"><code class="xref py py-func docutils literal notranslate"><span class="pre">assertTrue()</span></code></a> and <a class="reference internal" href="#assertFalse" title="assertFalse"><code class="xref py py-func docutils literal notranslate"><span class="pre">assertFalse()</span></code></a>: they only succeed with boolean values</p></li>
<li><p>add <a class="reference internal" href="#assertEvalToTrue" title="assertEvalToTrue"><code class="xref py py-func docutils literal notranslate"><span class="pre">assertEvalToTrue()</span></code></a> and <a class="reference internal" href="#assertEvalToFalse" title="assertEvalToFalse"><code class="xref py py-func docutils literal notranslate"><span class="pre">assertEvalToFalse()</span></code></a> with previous <a class="reference internal" href="#assertTrue" title="assertTrue"><code class="xref py py-func docutils literal notranslate"><span class="pre">assertTrue()</span></code></a>/<a class="reference internal" href="#assertFalse" title="assertFalse"><code class="xref py py-func docutils literal notranslate"><span class="pre">assertFalse()</span></code></a> behavior of coercing to boolean before asserting</p></li>
<li><p>all assertion functions accept an optional extra message, to be printed along the failure</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>New command-line arguments:</dt><dd><ul>
<li><p>can now shuffle tests with <code class="docutils literal notranslate"><span class="pre">--shuffle</span></code> or <code class="docutils literal notranslate"><span class="pre">-s</span></code></p></li>
<li><p>possibility to repeat tests (for example to trigger a JIT), with <code class="docutils literal notranslate"><span class="pre">--repeat</span> <span class="pre">NUM</span></code> or <code class="docutils literal notranslate"><span class="pre">-r</span> <span class="pre">NUM</span></code></p></li>
<li><p>more flexible test selection with inclusion (<code class="docutils literal notranslate"><span class="pre">--pattern</span></code> / <code class="docutils literal notranslate"><span class="pre">-p</span></code>) or exclusion (<code class="docutils literal notranslate"><span class="pre">--exclude</span></code> / <code class="docutils literal notranslate"><span class="pre">-x</span></code>) or combination of both</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Scientific computing dedicated support (see documentation):</dt><dd><ul>
<li><p>provide the machine epsilon in EPS</p></li>
<li><p>new functions: <a class="reference internal" href="#assertNan" title="assertNan"><code class="xref py py-func docutils literal notranslate"><span class="pre">assertNan()</span></code></a>, <a class="reference internal" href="#assertInf" title="assertInf"><code class="xref py py-func docutils literal notranslate"><span class="pre">assertInf()</span></code></a>, <a class="reference internal" href="#assertPlusInf" title="assertPlusInf"><code class="xref py py-func docutils literal notranslate"><span class="pre">assertPlusInf()</span></code></a>, <a class="reference internal" href="#assertMinusInf" title="assertMinusInf"><code class="xref py py-func docutils literal notranslate"><span class="pre">assertMinusInf()</span></code></a>, <a class="reference internal" href="#assertPlusZero" title="assertPlusZero"><code class="xref py py-func docutils literal notranslate"><span class="pre">assertPlusZero()</span></code></a>, <a class="reference internal" href="#assertMinusZero" title="assertMinusZero"><code class="xref py py-func docutils literal notranslate"><span class="pre">assertMinusZero()</span></code></a> and
their negative version</p></li>
<li><p>in <a class="reference internal" href="#assertAlmostEquals" title="assertAlmostEquals"><code class="xref py py-func docutils literal notranslate"><span class="pre">assertAlmostEquals()</span></code></a>, margin no longer provides a default value of 1E-11, the machine epsilon is used instead</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Platform and continuous integration support:</dt><dd><ul>
<li><p>validate LuaUnit on MacOs platform (thank to Travis CI)</p></li>
<li><p>validate LuaUnit with 32 bits numbers (floats) and 64 bits numbers (double)</p></li>
<li><p>add test coverage measurements thank to coveralls.io . Status: 99.76% of the code is verified.</p></li>
<li><p>use cache for AppVeyor and Travis builds</p></li>
<li><p>support for <code class="docutils literal notranslate"><span class="pre">luarocks</span> <span class="pre">doc</span></code> command</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>General doc improvements (detailed description of all output, more cross-linking between sections)</p></li>
</ul>
</div>
<div class="section" id="new-in-version-3-2-12-jul-2016">
<h4>New in version 3.2 - 12. Jul 2016<a class="headerlink" href="#new-in-version-3-2-12-jul-2016" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Add command-line option to stop on first error or failure. See <a class="reference internal" href="#other-options">Other options</a></p></li>
<li><p>Distinguish between failures (failed assertion) and errors</p></li>
<li><p>Support for new versions: Lua 5.3 and LuaJIT (2.0, 2.1 beta)</p></li>
<li><p>Validation of all lua versions on Travis CI and AppVeyor</p></li>
<li><p>Add compatibility layer with forked luaunit v2.x</p></li>
<li><p>Added documentation about development process. See <a class="reference internal" href="#developing-luaunit">Developing luaUnit</a></p></li>
<li><p>Improved support for table containing keys of type table. See <a class="reference internal" href="#comparing-table-keys-table"><span class="std std-ref">Annex B: Comparing tables with keys of type table</span></a></p></li>
<li><p>Small bug fixes, several internal improvements</p></li>
<li><p>Availability of a Luarock package. See <cite>https://luarocks.org/modules/bluebird75/luaunit</cite> .</p></li>
</ul>
</div>
<div class="section" id="new-in-version-3-1-10-mar-2015">
<h4>New in version 3.1 - 10. Mar 2015<a class="headerlink" href="#new-in-version-3-1-10-mar-2015" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>luaunit no longer pollutes global namespace, unless defining EXPORT_ASSERT_TO_GLOBALS to true. See  <a class="reference internal" href="#luaunit-global-asserts"><span class="std std-ref">Enabling global or module-level functions</span></a></p></li>
<li><p>fixes and validation of JUnit XML generation</p></li>
<li><p>strip luaunit internal information from stacktrace</p></li>
<li><p>general improvements of test results with duration and other details</p></li>
<li><p>improve printing for tables, with an option to always print table id. See <a class="reference internal" href="#table-printing"><span class="std std-ref">Annex A: More on table printing</span></a></p></li>
<li><p>fix printing of recursive tables</p></li>
</ul>
<p><strong>Important note when upgrading to version 3.1</strong> : assertions functions are
no longer exported directly to the global namespace. See <a class="reference internal" href="#luaunit-global-asserts"><span class="std std-ref">Enabling global or module-level functions</span></a></p>
</div>
<div class="section" id="new-in-version-3-0-9-oct-2014">
<h4>New in version 3.0 - 9. Oct 2014<a class="headerlink" href="#new-in-version-3-0-9-oct-2014" title="Permalink to this headline">¶</a></h4>
<p>Because LuaUnit was forked and released as some 2.x version, version number
is now jumping to 3.0 .</p>
<ul class="simple">
<li><p>full documentation available in text, html and pdf at <a class="reference external" href="http://luaunit.read-the-docs.org">http://luaunit.read-the-docs.org</a></p></li>
<li><p>new output format: JUnit, compatible with Bamboo and other CI platforms. See <a class="reference internal" href="#output-formats">Output formats</a></p></li>
<li><p>much better table assertions</p></li>
<li><p>new assertions for strings, with patterns and case insensitivity: assertStrContains,
assertNotStrContains, assertNotStrIContains, assertStrIContains, assertStrMatches</p></li>
<li><p>new assertions for floats: assertAlmostEquals, assertNotAlmostEquals</p></li>
<li><p>type assertions: assertIsString, assertIsNumber, …</p></li>
<li><p>error assertions: assertErrorMsgEquals, assertErrorMsgContains, assertErrorMsgMatches</p></li>
<li><p>improved error messages for several assertions</p></li>
<li><p>command-line options to select test, control output type and verbosity</p></li>
</ul>
</div>
<div class="section" id="new-in-version-1-5-8-nov-2012">
<h4>New in version 1.5 - 8. Nov 2012<a class="headerlink" href="#new-in-version-1-5-8-nov-2012" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>compatibility with Lua 5.1 and 5.2</p></li>
<li><p>better object model internally</p></li>
<li><p>a lot more of internal tests</p></li>
<li><p>several internal bug fixes</p></li>
<li><p>make it easy to customize the test output</p></li>
<li><p>running test functions no longer requires a wrapper</p></li>
<li><p>several level of verbosity</p></li>
</ul>
</div>
<div class="section" id="new-in-version-1-4-26-jul-2012">
<h4>New in version 1.4 - 26. Jul 2012<a class="headerlink" href="#new-in-version-1-4-26-jul-2012" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>switch from X11 to more popular BSD license</p></li>
<li><p>add TAP output format for integration into Jenkins. See <a class="reference internal" href="#output-formats">Output formats</a></p></li>
<li><p>official repository now on GitHub</p></li>
</ul>
</div>
<div class="section" id="new-in-version-1-3-30-oct-2007">
<h4>New in version 1.3 - 30. Oct 2007<a class="headerlink" href="#new-in-version-1-3-30-oct-2007" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>port to lua 5.1</p></li>
<li><p>iterate over the test classes, methods and functions in the alphabetical order</p></li>
<li><p>change the default order of expected, actual in assertEquals.  See <a class="reference internal" href="#equality-assertions">Equality assertions</a></p></li>
</ul>
</div>
<div class="section" id="version-1-2-13-jun-2005">
<h4>Version 1.2 - 13. Jun 2005<a class="headerlink" href="#version-1-2-13-jun-2005" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>first public release</p></li>
</ul>
</div>
<div class="section" id="version-1-1">
<h4>Version 1.1<a class="headerlink" href="#version-1-1" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>move global variables to internal variables</p></li>
<li><p>assertion order is configurable between expected/actual or actual/expected. See <a class="reference internal" href="#equality-assertions">Equality assertions</a></p></li>
<li><p>new assertion to check that a function call returns an error</p></li>
<li><p>display the calling stack when an error is spotted</p></li>
<li><p>two verbosity level, like in python unittest</p></li>
</ul>
</div>
</div>
</div>
<div class="section" id="getting-started-with-luaunit">
<h2>Getting started with LuaUnit<a class="headerlink" href="#getting-started-with-luaunit" title="Permalink to this headline">¶</a></h2>
<p>This section will guide you through a step by step usage of <em>LuaUnit</em> . The full source code
of the example below is available in the : <a class="reference internal" href="#source-code-example">source_code_example</a> or in the file <em>my_test_suite.lua</em>
in the doc directory.</p>
<div class="section" id="setting-up-your-test-script">
<h3>Setting up your test script<a class="headerlink" href="#setting-up-your-test-script" title="Permalink to this headline">¶</a></h3>
<p>To get started, create your file <em>my_test_suite.lua</em> .</p>
<p>The script should import LuaUnit:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">lu</span> <span class="o">=</span> <span class="n">require</span><span class="p">(</span><span class="s1">&#39;luaunit&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The last line executes your script with LuaUnit and exit with the
proper error code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span> <span class="n">lu</span><span class="o">.</span><span class="n">LuaUnit</span><span class="o">.</span><span class="n">run</span><span class="p">()</span> <span class="p">)</span>
</pre></div>
</div>
<p>Now, run your file with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">lua</span> <span class="n">my_test_suite</span><span class="o">.</span><span class="n">lua</span>
</pre></div>
</div>
<p>It prints something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Ran</span> <span class="mi">0</span> <span class="n">tests</span> <span class="ow">in</span> <span class="mf">0.000</span> <span class="n">seconds</span><span class="p">,</span> <span class="mi">0</span> <span class="n">successes</span><span class="p">,</span> <span class="mi">0</span> <span class="n">failures</span>
<span class="n">OK</span>
</pre></div>
</div>
<p>Now, your testing framework is in place, you can start writing tests.</p>
</div>
<div class="section" id="writing-tests">
<h3>Writing tests<a class="headerlink" href="#writing-tests" title="Permalink to this headline">¶</a></h3>
<p>LuaUnit scans all variables that start with <em>test</em> or <em>Test</em>.
If they are functions, or if they are tables that contain
functions that start with <em>test</em> or <em>Test</em>, they are run as part of the test suite.</p>
<p>So just write a function whose name starts with test. Inside test functions, use the assertions functions provided by LuaUnit, such
as <a class="reference internal" href="#assertEquals" title="assertEquals"><code class="xref py py-func docutils literal notranslate"><span class="pre">assertEquals()</span></code></a>.</p>
<p>Let’s see that in practice.</p>
<p>Suppose you want to test the following add function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span> <span class="n">add</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">)</span>
    <span class="o">--</span> <span class="n">add</span> <span class="n">positive</span> <span class="n">numbers</span>
    <span class="o">--</span> <span class="k">return</span> <span class="mi">0</span> <span class="k">if</span> <span class="nb">any</span> <span class="n">of</span> <span class="n">the</span> <span class="n">numbers</span> <span class="n">are</span> <span class="mi">0</span>
    <span class="o">--</span> <span class="n">error</span> <span class="k">if</span> <span class="nb">any</span> <span class="n">of</span> <span class="n">the</span> <span class="n">two</span> <span class="n">numbers</span> <span class="n">are</span> <span class="n">negative</span>
    <span class="k">if</span> <span class="n">v1</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">v2</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="n">then</span>
        <span class="n">error</span><span class="p">(</span><span class="s1">&#39;Can only add positive or null numbers, received &#39;</span><span class="o">..</span><span class="n">v1</span><span class="o">..</span><span class="s1">&#39; and &#39;</span><span class="o">..</span><span class="n">v2</span><span class="p">)</span>
    <span class="n">end</span>
    <span class="k">if</span> <span class="n">v1</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">v2</span> <span class="o">==</span> <span class="mi">0</span> <span class="n">then</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="n">end</span>
    <span class="k">return</span> <span class="n">v1</span><span class="o">+</span><span class="n">v2</span>
<span class="n">end</span>
</pre></div>
</div>
<p>You write the following tests:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span> <span class="n">testAddPositive</span><span class="p">()</span>
    <span class="n">lu</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span>
<span class="n">end</span>

<span class="n">function</span> <span class="n">testAddZero</span><span class="p">()</span>
    <span class="n">lu</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">lu</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">add</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">lu</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">add</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
<span class="n">end</span>
</pre></div>
</div>
<p><a class="reference internal" href="#assertEquals" title="assertEquals"><code class="xref py py-func docutils literal notranslate"><span class="pre">assertEquals()</span></code></a> is the most commonly used assertion function. It
verifies that both argument are equals, in the order actual value, expected value.</p>
<p>Rerun your test script (<code class="docutils literal notranslate"><span class="pre">-v</span></code> is to activate a more verbose output):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ lua my_test_suite.lua -v
</pre></div>
</div>
<p>It now prints:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Started</span> <span class="n">on</span> <span class="mi">02</span><span class="o">/</span><span class="mi">19</span><span class="o">/</span><span class="mi">17</span> <span class="mi">22</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">53</span>
    <span class="n">TestAdd</span><span class="o">.</span><span class="n">testAddPositive</span> <span class="o">...</span> <span class="n">Ok</span>
    <span class="n">TestAdd</span><span class="o">.</span><span class="n">testAddZero</span> <span class="o">...</span> <span class="n">Ok</span>
<span class="o">=========================================================</span>
<span class="n">Ran</span> <span class="mi">2</span> <span class="n">tests</span> <span class="ow">in</span> <span class="mf">0.003</span> <span class="n">seconds</span><span class="p">,</span> <span class="mi">2</span> <span class="n">successes</span><span class="p">,</span> <span class="mi">0</span> <span class="n">failures</span>
<span class="n">OK</span>
</pre></div>
</div>
<p>You always have:</p>
<ul class="simple">
<li><p>the date at which the test suite was started</p></li>
<li><p>the group to which the function belongs (usually, the name of the function table, and <em>&lt;TestFunctions&gt;</em> for all direct test functions)</p></li>
<li><p>the name of the function being executed</p></li>
<li><p>a report at the end, with number of executed test, number of non selected tests if any, number of failures, number of errors (if any) and duration.</p></li>
</ul>
<p>The difference between failures and errors are:</p>
<ul class="simple">
<li><p>luaunit assertion functions generate failures</p></li>
<li><p>any unexpected error during execution generates an error</p></li>
<li><p>failures or errors during setup() or teardown() always generate errors</p></li>
</ul>
<p>If we continue with our example, we also want to test that when the function receives negative numbers, it generates an error. Use
<a class="reference internal" href="#assertError" title="assertError"><code class="xref py py-func docutils literal notranslate"><span class="pre">assertError()</span></code></a> or even better, <a class="reference internal" href="#assertErrorMsgContains" title="assertErrorMsgContains"><code class="xref py py-func docutils literal notranslate"><span class="pre">assertErrorMsgContains()</span></code></a> to also validate the content
of the error message. There are other types or error checking functions, see <a class="reference internal" href="#error-assertions">Error assertions</a> . Here
we use <a class="reference internal" href="#assertErrorMsgContains" title="assertErrorMsgContains"><code class="xref py py-func docutils literal notranslate"><span class="pre">assertErrorMsgContains()</span></code></a> . First argument is the expected message, then the function to call
and the optional arguments:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span> <span class="n">testAddError</span><span class="p">()</span>
    <span class="n">lu</span><span class="o">.</span><span class="n">assertErrorMsgContains</span><span class="p">(</span><span class="s1">&#39;Can only add positive or null numbers, received 2 and -3&#39;</span><span class="p">,</span> <span class="n">add</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">)</span>
<span class="n">end</span>
</pre></div>
</div>
<p>Now, suppose we also have the following function to test:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span> <span class="n">adder</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="o">--</span> <span class="k">return</span> <span class="n">a</span> <span class="n">function</span> <span class="n">that</span> <span class="n">adds</span> <span class="n">v</span> <span class="n">to</span> <span class="n">its</span> <span class="n">argument</span> <span class="n">using</span> <span class="n">add</span>
    <span class="n">function</span> <span class="n">closure</span><span class="p">(</span> <span class="n">x</span> <span class="p">)</span> <span class="k">return</span> <span class="n">x</span><span class="o">+</span><span class="n">v</span> <span class="n">end</span>
    <span class="k">return</span> <span class="n">closure</span>
<span class="n">end</span>
</pre></div>
</div>
<p>We want to test the type of the value returned by adder and its behavior. LuaUnit
provides assertion for type testing (see <a class="reference internal" href="#type-assertions">Type assertions</a> ). In this case, we use
<a class="reference internal" href="#assertIsFunction" title="assertIsFunction"><code class="xref py py-func docutils literal notranslate"><span class="pre">assertIsFunction()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span> <span class="n">testAdder</span><span class="p">()</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">adder</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">lu</span><span class="o">.</span><span class="n">assertIsFunction</span><span class="p">(</span> <span class="n">f</span> <span class="p">)</span>
    <span class="n">lu</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span> <span class="n">f</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="mi">5</span> <span class="p">)</span>
<span class="n">end</span>
</pre></div>
</div>
</div>
<div class="section" id="grouping-tests-setup-teardown-functionality">
<h3>Grouping tests, setup/teardown functionality<a class="headerlink" href="#grouping-tests-setup-teardown-functionality" title="Permalink to this headline">¶</a></h3>
<p>When the number of tests starts to grow, you usually organise them
into separate groups. You can do that with LuaUnit by putting them
inside a table (whose name must start with <em>Test</em> or <em>test</em> ).</p>
<p>For example, assume we have a second function to test:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span> <span class="n">div</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">)</span>
    <span class="o">--</span> <span class="n">divide</span> <span class="n">positive</span> <span class="n">numbers</span>
    <span class="o">--</span> <span class="k">return</span> <span class="mi">0</span> <span class="k">if</span> <span class="nb">any</span> <span class="n">of</span> <span class="n">the</span> <span class="n">numbers</span> <span class="n">are</span> <span class="mi">0</span>
    <span class="o">--</span> <span class="n">error</span> <span class="k">if</span> <span class="nb">any</span> <span class="n">of</span> <span class="n">the</span> <span class="n">two</span> <span class="n">numbers</span> <span class="n">are</span> <span class="n">negative</span>
    <span class="k">if</span> <span class="n">v1</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">v2</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="n">then</span>
        <span class="n">error</span><span class="p">(</span><span class="s1">&#39;Can only divide positive or null numbers, received &#39;</span><span class="o">..</span><span class="n">v1</span><span class="o">..</span><span class="s1">&#39; and &#39;</span><span class="o">..</span><span class="n">v2</span><span class="p">)</span>
    <span class="n">end</span>
    <span class="k">if</span> <span class="n">v1</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">v2</span> <span class="o">==</span> <span class="mi">0</span> <span class="n">then</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="n">end</span>
    <span class="k">return</span> <span class="n">v1</span><span class="o">/</span><span class="n">v2</span>
<span class="n">end</span>
</pre></div>
</div>
<p>We move the tests related to the function add into their own table:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TestAdd</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">function</span> <span class="n">TestAdd</span><span class="p">:</span><span class="n">testAddPositive</span><span class="p">()</span>
        <span class="n">lu</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">end</span>

    <span class="n">function</span> <span class="n">TestAdd</span><span class="p">:</span><span class="n">testAddZero</span><span class="p">()</span>
        <span class="n">lu</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">lu</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">add</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">lu</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">add</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">end</span>

    <span class="n">function</span> <span class="n">TestAdd</span><span class="p">:</span><span class="n">testAddError</span><span class="p">()</span>
        <span class="n">lu</span><span class="o">.</span><span class="n">assertErrorMsgContains</span><span class="p">(</span><span class="s1">&#39;Can only add positive or null numbers, received 2 and -3&#39;</span><span class="p">,</span> <span class="n">add</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">end</span>

    <span class="n">function</span> <span class="n">TestAdd</span><span class="p">:</span><span class="n">testAdder</span><span class="p">()</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">adder</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">lu</span><span class="o">.</span><span class="n">assertIsFunction</span><span class="p">(</span> <span class="n">f</span> <span class="p">)</span>
        <span class="n">lu</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span> <span class="n">f</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="mi">5</span> <span class="p">)</span>
    <span class="n">end</span>
<span class="o">--</span> <span class="n">end</span> <span class="n">of</span> <span class="n">table</span> <span class="n">TestAdd</span>
</pre></div>
</div>
<p>Then we create a second set of tests for div:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TestDiv</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">function</span> <span class="n">TestDiv</span><span class="p">:</span><span class="n">testDivPositive</span><span class="p">()</span>
        <span class="n">lu</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">div</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">end</span>

    <span class="n">function</span> <span class="n">TestDiv</span><span class="p">:</span><span class="n">testDivZero</span><span class="p">()</span>
        <span class="n">lu</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">div</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">lu</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">div</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">lu</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">div</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">end</span>

    <span class="n">function</span> <span class="n">TestDiv</span><span class="p">:</span><span class="n">testDivError</span><span class="p">()</span>
        <span class="n">lu</span><span class="o">.</span><span class="n">assertErrorMsgContains</span><span class="p">(</span><span class="s1">&#39;Can only divide positive or null numbers, received 2 and -3&#39;</span><span class="p">,</span> <span class="n">div</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">end</span>
<span class="o">--</span> <span class="n">end</span> <span class="n">of</span> <span class="n">table</span> <span class="n">TestDiv</span>
</pre></div>
</div>
<p>Execution of the test suite now looks like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Started</span> <span class="n">on</span> <span class="mi">02</span><span class="o">/</span><span class="mi">19</span><span class="o">/</span><span class="mi">17</span> <span class="mi">22</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">53</span>
    <span class="n">TestAdd</span><span class="o">.</span><span class="n">testAddError</span> <span class="o">...</span> <span class="n">Ok</span>
    <span class="n">TestAdd</span><span class="o">.</span><span class="n">testAddPositive</span> <span class="o">...</span> <span class="n">Ok</span>
    <span class="n">TestAdd</span><span class="o">.</span><span class="n">testAddZero</span> <span class="o">...</span> <span class="n">Ok</span>
    <span class="n">TestAdd</span><span class="o">.</span><span class="n">testAdder</span> <span class="o">...</span> <span class="n">Ok</span>
    <span class="n">TestDiv</span><span class="o">.</span><span class="n">testDivError</span> <span class="o">...</span> <span class="n">Ok</span>
    <span class="n">TestDiv</span><span class="o">.</span><span class="n">testDivPositive</span> <span class="o">...</span> <span class="n">Ok</span>
    <span class="n">TestDiv</span><span class="o">.</span><span class="n">testDivZero</span> <span class="o">...</span> <span class="n">Ok</span>
<span class="o">=========================================================</span>
<span class="n">Ran</span> <span class="mi">7</span> <span class="n">tests</span> <span class="ow">in</span> <span class="mf">0.006</span> <span class="n">seconds</span><span class="p">,</span> <span class="mi">7</span> <span class="n">successes</span><span class="p">,</span> <span class="mi">0</span> <span class="n">failures</span>
<span class="n">OK</span>
</pre></div>
</div>
<p>When tests are defined in tables, you can optionally define two special
functions, <em>setUp()</em> and <em>tearDown()</em>, which will be executed
respectively before and after every test.</p>
<p>These function may be used to create specific resources for the
test being executed and cleanup the test environment.</p>
<p>For a practical example, imagine that we have a <em>log()</em> function
that writes strings to a log file on disk. The file is created
upon first usage of the function, and the filename is defined
by calling the function <em>initLog()</em>.</p>
<p>The tests for these functions would take advantage of the <em>setup/teardown</em>
functionality to prepare a log filename shared
by all tests, make sure that all tests start with a non existing
log file name, and delete the log filename after every test:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TestLogger</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">function</span> <span class="n">TestLogger</span><span class="p">:</span><span class="n">setUp</span><span class="p">()</span>
        <span class="o">--</span> <span class="n">define</span> <span class="n">the</span> <span class="n">fname</span> <span class="n">to</span> <span class="n">use</span> <span class="k">for</span> <span class="n">logging</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;mytmplog.log&#39;</span>
        <span class="o">--</span> <span class="n">make</span> <span class="n">sure</span> <span class="n">the</span> <span class="n">file</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">already</span> <span class="n">exists</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">)</span>
    <span class="n">end</span>

    <span class="n">function</span> <span class="n">TestLogger</span><span class="p">:</span><span class="n">testLoggerCreatesFile</span><span class="p">()</span>
        <span class="n">initLog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">)</span>
        <span class="n">log</span><span class="p">(</span><span class="s1">&#39;toto&#39;</span><span class="p">)</span>
        <span class="o">--</span> <span class="n">make</span> <span class="n">sure</span> <span class="n">that</span> <span class="n">our</span> <span class="n">log</span> <span class="n">file</span> <span class="n">was</span> <span class="n">created</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">lu</span><span class="o">.</span><span class="n">assertNotNil</span><span class="p">(</span> <span class="n">f</span> <span class="p">)</span>
        <span class="n">f</span><span class="p">:</span><span class="n">close</span><span class="p">()</span>
    <span class="n">end</span>

    <span class="n">function</span> <span class="n">TestLogger</span><span class="p">:</span><span class="n">tearDown</span><span class="p">()</span>
        <span class="o">--</span> <span class="n">cleanup</span> <span class="n">our</span> <span class="n">log</span> <span class="n">file</span> <span class="n">after</span> <span class="nb">all</span> <span class="n">tests</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">)</span>
    <span class="n">end</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><em>Errors generated during execution of setUp() or tearDown()
functions are considered test failures.</em></p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><em>For compatibility with luaunit v2 and other lua unit-test frameworks,
setUp() and tearDown() may also be named setup(), SetUp(), Setup() and teardown(), TearDown(), Teardown().</em></p>
</div>
</div>
<div class="section" id="using-the-command-line">
<h3>Using the command-line<a class="headerlink" href="#using-the-command-line" title="Permalink to this headline">¶</a></h3>
<p>You can control the LuaUnit execution from the command-line:</p>
<p><strong>Output format</strong></p>
<p>Choose the test output format with <code class="docutils literal notranslate"><span class="pre">-o</span></code> or <code class="docutils literal notranslate"><span class="pre">--output</span></code>. Available formats are:</p>
<ul class="simple">
<li><p>text: the default output format</p></li>
<li><p>nil: no output at all</p></li>
<li><p>tap: TAP format</p></li>
<li><p>junit: output junit xml</p></li>
</ul>
<p>Example of non-verbose text format:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ lua doc/my_test_suite.lua
.......
Ran 7 tests in 0.003 seconds, 7 successes, 0 failures
OK
</pre></div>
</div>
<p>Example of TAP format:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ lua doc/my_test_suite.lua -o TAP
1..7
# Started on 02/19/17 22:15:53
# Starting class: TestAdd
ok     1        TestAdd.testAddError
ok     2        TestAdd.testAddPositive
ok     3        TestAdd.testAddZero
ok     4        TestAdd.testAdder
# Starting class: TestDiv
ok     5        TestDiv.testDivError
ok     6        TestDiv.testDivPositive
ok     7        TestDiv.testDivZero
# Ran 7 tests in 0.007 seconds, 7 successes, 0 failures
</pre></div>
</div>
<p>Output formats may also be controlled by the following environment variables:
* LUAUNIT_OUTPUT: output format to use
* LUAUNIT_JUNIT_FNAME: for junit output format, name of the xml file</p>
<p>For a more detailed overview of all formats and their verbosity see the section <a class="reference internal" href="#output-formats">Output formats</a> .</p>
<p><strong>List of tests to run</strong></p>
<p>You can list some test names on the command-line to run only those tests.
The name must be the exact match of either the test table, the test function or the test table
and the test method. The option may be repeated.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>-- Run all TestAdd table tests and one test of TestDiv table.
$ lua doc/my_test_suite.lua TestAdd TestDiv.testDivError -v
Started on 02/19/17 22:15:53
    TestAdd.testAddError ... Ok
    TestAdd.testAddPositive ... Ok
    TestAdd.testAddZero ... Ok
    TestAdd.testAdder ... Ok
    TestDiv.testDivError ... Ok
=========================================================
Ran 5 tests in 0.003 seconds, 5 successes, 0 failures
OK
</pre></div>
</div>
<p><strong>Including / excluding tests</strong></p>
<p>The most flexible approach for selecting tests to use the include and exclude functionality.
With <code class="docutils literal notranslate"><span class="pre">--pattern</span></code> or <code class="docutils literal notranslate"><span class="pre">-p</span></code>, you can provide a lua pattern and only the tests that contain
the pattern will actually be run.</p>
<dl class="simple">
<dt>Example::</dt><dd><p>– Run all tests of zero testing and error testing
– by using the magic character .
$ lua my_test_suite.lua -v -p Err.r -p Z.ro</p>
</dd>
</dl>
<p>For our test suite, it gives the following output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Started</span> <span class="n">on</span> <span class="mi">02</span><span class="o">/</span><span class="mi">19</span><span class="o">/</span><span class="mi">17</span> <span class="mi">22</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">53</span>
    <span class="n">TestAdd</span><span class="o">.</span><span class="n">testAddError</span> <span class="o">...</span> <span class="n">Ok</span>
    <span class="n">TestAdd</span><span class="o">.</span><span class="n">testAddZero</span> <span class="o">...</span> <span class="n">Ok</span>
    <span class="n">TestDiv</span><span class="o">.</span><span class="n">testDivError</span> <span class="o">...</span> <span class="n">Ok</span>
    <span class="n">TestDiv</span><span class="o">.</span><span class="n">testDivZero</span> <span class="o">...</span> <span class="n">Ok</span>
<span class="o">=========================================================</span>
<span class="n">Ran</span> <span class="mi">4</span> <span class="n">tests</span> <span class="ow">in</span> <span class="mf">0.003</span> <span class="n">seconds</span><span class="p">,</span> <span class="mi">4</span> <span class="n">successes</span><span class="p">,</span> <span class="mi">0</span> <span class="n">failures</span><span class="p">,</span> <span class="mi">3</span> <span class="n">non</span><span class="o">-</span><span class="n">selected</span>
<span class="n">OK</span>
</pre></div>
</div>
<p>The number of tests ignored by the selection is printed, along
with the test result. The pattern can be any lua pattern. Be sure to exclude all magic
characters with % (like -+?*) and protect your pattern from the shell
interpretation by putting it in quotes.</p>
<p>You can also exclude tests that match some patterns:</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>-- Run all tests except zero testing and except error testing
$ lua my_test_suite.lua -v -x Error -x Zero
</pre></div>
</div>
<p>For our test suite, it gives the following output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Started</span> <span class="n">on</span> <span class="mi">02</span><span class="o">/</span><span class="mi">19</span><span class="o">/</span><span class="mi">17</span> <span class="mi">22</span><span class="p">:</span><span class="mi">29</span><span class="p">:</span><span class="mi">45</span>
    <span class="n">TestAdd</span><span class="o">.</span><span class="n">testAddPositive</span> <span class="o">...</span> <span class="n">Ok</span>
    <span class="n">TestAdd</span><span class="o">.</span><span class="n">testAdder</span> <span class="o">...</span> <span class="n">Ok</span>
    <span class="n">TestDiv</span><span class="o">.</span><span class="n">testDivPositive</span> <span class="o">...</span> <span class="n">Ok</span>
<span class="o">=========================================================</span>
<span class="n">Ran</span> <span class="mi">3</span> <span class="n">tests</span> <span class="ow">in</span> <span class="mf">0.003</span> <span class="n">seconds</span><span class="p">,</span> <span class="mi">3</span> <span class="n">successes</span><span class="p">,</span> <span class="mi">0</span> <span class="n">failures</span><span class="p">,</span> <span class="mi">4</span> <span class="n">non</span><span class="o">-</span><span class="n">selected</span>
<span class="n">OK</span>
</pre></div>
</div>
<p>You can also combine test selection and test exclusion. See <a class="reference internal" href="#flexible-test-selection">Flexible test selection</a></p>
</div>
<div class="section" id="conclusion">
<h3>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h3>
<p>You now know enough of LuaUnit to start writing your test suite. Check
the reference documentation for a complete list of
assertions, command-line options and specific behavior.</p>
</div>
</div>
<div class="section" id="reference-documentation">
<h2>Reference documentation<a class="headerlink" href="#reference-documentation" title="Permalink to this headline">¶</a></h2>
<div class="section" id="command-line-options">
<h3>Command-line options<a class="headerlink" href="#command-line-options" title="Permalink to this headline">¶</a></h3>
<p>Usage: lua &lt;your_test_suite.lua&gt; [options] [testname1 [testname2] …]</p>
<p><strong>Test names</strong></p>
<p>When no test names are supplied, all tests are collected.</p>
<p>The syntax for supplying test names can be either: name of the function, name of the table
or [name of the table].[name of the function]. Only the supplied tests will be executed.</p>
<p>Selecting tests with –pattern and –exclude is usually more flexible. See <a class="reference internal" href="#flexible-test-selection">Flexible test selection</a></p>
<p><strong>Options</strong></p>
<dl class="option-list">
<dt><kbd><span class="option">--output</span>, <span class="option">-o <var>FORMAT</var></span></kbd></dt>
<dd><p>Set output format to FORMAT. Possible values: text, tap, junit, nil . See <a class="reference internal" href="#output-formats">Output formats</a></p>
</dd>
<dt><kbd><span class="option">--name</span>, <span class="option">-n <var>FILENAME</var></span></kbd></dt>
<dd><p>For junit format only, mandatory name of xml file. Ignored for other formats.</p>
</dd>
<dt><kbd><span class="option">--pattern</span>, <span class="option">-p <var>PATTERN</var></span></kbd></dt>
<dd><p>Execute all test names matching the Lua PATTERN. May be repeated to include severals patterns. See <a class="reference internal" href="#flexible-test-selection">Flexible test selection</a></p>
</dd>
<dt><kbd><span class="option">--exclude</span>, <span class="option">-x <var>PATTERN</var></span></kbd></dt>
<dd><p>Exclude all test names matching the Lua PATTERN. May be repeated to exclude severals patterns. See <a class="reference internal" href="#flexible-test-selection">Flexible test selection</a></p>
</dd>
<dt><kbd><span class="option">--repeat</span>, <span class="option">-r <var>NUM</var></span></kbd></dt>
<dd><p>Repeat all tests NUM times, e.g. to trigger the JIT. See <a class="reference internal" href="#other-options">Other options</a></p>
</dd>
<dt><kbd><span class="option">--shuffle</span>, <span class="option">-s</span></kbd></dt>
<dd><p>Shuffle tests before running them. See <a class="reference internal" href="#other-options">Other options</a></p>
</dd>
<dt><kbd><span class="option">--error</span>, <span class="option">-e</span></kbd></dt>
<dd><p>Stop on first error. See <a class="reference internal" href="#other-options">Other options</a></p>
</dd>
<dt><kbd><span class="option">--failure</span>, <span class="option">-f</span></kbd></dt>
<dd><p>Stop on first failure or error. See <a class="reference internal" href="#other-options">Other options</a></p>
</dd>
<dt><kbd><span class="option">--verbose</span>, <span class="option">-v</span></kbd></dt>
<dd><p>Increase verbosity</p>
</dd>
<dt><kbd><span class="option">--quiet</span>, <span class="option">-q</span></kbd></dt>
<dd><p>Set verbosity to minimum</p>
</dd>
<dt><kbd><span class="option">--help</span>, <span class="option">-h</span></kbd></dt>
<dd><p>Print help</p>
</dd>
<dt><kbd><span class="option">--version</span></kbd></dt>
<dd><p>Version information of LuaUnit</p>
</dd>
</dl>
<div class="section" id="output-formats">
<h4>Output formats<a class="headerlink" href="#output-formats" title="Permalink to this headline">¶</a></h4>
<p>Choose the output format with the syntax <code class="docutils literal notranslate"><span class="pre">-o</span> <span class="pre">FORMAT</span></code> or <code class="docutils literal notranslate"><span class="pre">--output</span> <span class="pre">FORMAT</span></code> or the environment variable <code class="docutils literal notranslate"><span class="pre">LUAUNIT_OUTPUT</span></code>.</p>
<p>Formats available:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">text</span></code>: the default output format of LuaUnit</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tap</span></code>: output compatible with the <a class="reference external" href="http://testanything.org/">Test Anything Protocol</a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">junit</span></code>: output compatible with the <em>JUnit XML</em> format (used by many CI
platforms). The XML is written to the file provided with the <code class="docutils literal notranslate"><span class="pre">--name</span></code> or <code class="docutils literal notranslate"><span class="pre">-n</span></code> option or the environment variable <code class="docutils literal notranslate"><span class="pre">LUAUNIT_JUNIT_FNAME</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nil</span></code>: no output at all</p></li>
</ul>
<p>For more information on each format, see <a class="reference internal" href="#output-formats-details">Output formats details</a></p>
</div>
<div class="section" id="other-options">
<h4>Other options<a class="headerlink" href="#other-options" title="Permalink to this headline">¶</a></h4>
<p><strong>Stopping on first error or failure</strong></p>
<p>If <code class="docutils literal notranslate"><span class="pre">--failure</span></code> or <code class="docutils literal notranslate"><span class="pre">-f</span></code> is passed as an option, LuaUnit will stop on the first failure or error and display the test results.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">--error</span></code> or <code class="docutils literal notranslate"><span class="pre">-e</span></code> is passed as an option, LuaUnit will stop on the first error (but continue on failures).</p>
<p><strong>Randomize test order</strong></p>
<p>If <code class="docutils literal notranslate"><span class="pre">--shuffle</span></code> or <code class="docutils literal notranslate"><span class="pre">-s</span></code> is passed as an option, LuaUnit will execute tests in random order. The randomisation works on all test functions
and methods. As a consequence test methods of a given class may be splitted into multiple location, generating several test class creation and destruction.</p>
<p><strong>Repeat test</strong></p>
<p>When using luajit, the just-in-time compiler will kick in only after a given function has been executed a sufficient number of times. To make sure
that the JIT is not introducing any bug, LuaUnit provides a way to repeat a test may times, with <code class="docutils literal notranslate"><span class="pre">--repeat</span></code> or <code class="docutils literal notranslate"><span class="pre">-r</span></code> followed by a number.</p>
</div>
<div class="section" id="flexible-test-selection">
<h4>Flexible test selection<a class="headerlink" href="#flexible-test-selection" title="Permalink to this headline">¶</a></h4>
<p>LuaUnit provides very flexible way to select which tests to execute. We will illustrate this with several examples.</p>
<p>In the examples, we use a test suite composed of the following test funcions:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span> <span class="n">class</span><span class="p">:</span> <span class="n">TestAdd</span>
<span class="n">TestAdd</span><span class="o">.</span><span class="n">testAddError</span>
<span class="n">TestAdd</span><span class="o">.</span><span class="n">testAddPositive</span>
<span class="n">TestAdd</span><span class="o">.</span><span class="n">testAddZero</span>
<span class="n">TestAdd</span><span class="o">.</span><span class="n">testAdder</span>

<span class="o">--</span> <span class="n">class</span><span class="p">:</span> <span class="n">TestDiv</span>
<span class="n">TestDiv</span><span class="o">.</span><span class="n">testDivError</span>
<span class="n">TestDiv</span><span class="o">.</span><span class="n">testDivPositive</span>
<span class="n">TestDiv</span><span class="o">.</span><span class="n">testDivZero</span>
</pre></div>
</div>
<p>With <code class="docutils literal notranslate"><span class="pre">--pattern</span></code> or <code class="docutils literal notranslate"><span class="pre">-p</span></code>, you can provide a lua pattern and only the tests that contain
the pattern will actually be run.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>-- Run all tests of zero testing and error testing
-- by using the magic character .
$ lua mytest_suite.lua -v -p Err.r -p Z.ro
Started on 02/19/17 22:29:45
    TestAdd.testAddError ... Ok
    TestAdd.testAddZero ... Ok
    TestDiv.testDivError ... Ok
    TestDiv.testDivZero ... Ok
=========================================================
Ran 4 tests in 0.004 seconds, 4 successes, 0 failures, 3 non-selected
OK
</pre></div>
</div>
<p>The number of tests ignored by the selection is printed, along
with the test result. The tests <em>TestAdd.testAdder testAdd.testPositive and
testDiv.testDivPositive</em> have been correctly ignored.</p>
<p>The pattern can be any lua pattern. Be sure to exclude all magic
characters with % (like <code class="docutils literal notranslate"><span class="pre">-+?*</span></code>) and protect your pattern from the shell
interpretation by putting it in quotes.</p>
<p>With <code class="docutils literal notranslate"><span class="pre">--exclude</span></code> or <code class="docutils literal notranslate"><span class="pre">-x</span></code>, you can provide a lua pattern of tests which should
be excluded from execution.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>-- Run all tests except zero testing and except error testing
$ lua mytest_suite.lua -v -x Error -x Zero
Started on 02/19/17 22:29:45
    TestAdd.testAddPositive ... Ok
    TestAdd.testAdder ... Ok
    TestDiv.testDivPositive ... Ok
=========================================================
Ran 3 tests in 0.003 seconds, 3 successes, 0 failures, 4 non-selected
OK
</pre></div>
</div>
<p>You can also combine test selection and test exclusion. The rules are the following:</p>
<ul class="simple">
<li><p>if the first argument encountered is a inclusion pattern, the list of tests start empty</p></li>
<li><p>if the first argument encountered is an exclusion pattern, the list of tests start with all tests of the suite</p></li>
<li><p>each subsequent inclusion pattern will add new tests to the list</p></li>
<li><p>each subsequent exclusion pattern will remove test from the list</p></li>
<li><p>the final list is the list of tests executed</p></li>
</ul>
<p>In pure logic term, inclusion is the equivalent of <code class="docutils literal notranslate"><span class="pre">or</span> <span class="pre">match(pattern)</span></code> and exclusion is <code class="docutils literal notranslate"><span class="pre">and</span> <span class="pre">not</span> <span class="pre">match(pattern)</span></code> .</p>
<p>Let’s look at some practical examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>-- Add all tests which include the word Add
-- except the test Adder
-- and also include the Zero tests
$ lua my_test_suite.lua -v --pattern Add --exclude Adder --pattern Zero
Started on 02/19/17 22:29:45
    TestAdd.testAddError ... Ok
    TestAdd.testAddPositive ... Ok
    TestAdd.testAddZero ... Ok
    TestDiv.testDivZero ... Ok
=========================================================
Ran 4 tests in 0.003 seconds, 4 successes, 0 failures, 3 non-selected
OK
</pre></div>
</div>
</div>
</div>
<div class="section" id="luaunit-runner-object">
<h3>LuaUnit runner object<a class="headerlink" href="#luaunit-runner-object" title="Permalink to this headline">¶</a></h3>
<p>The various options set on the command-line can be overridden by creating a LuaUnit runner explicitely and calling specific functions on it.</p>
<dl class="py function">
<dt id="LuaUnit.new">
<code class="sig-prename descclassname">LuaUnit.</code><code class="sig-name descname">new</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#LuaUnit.new" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The execution of a LuaUnit test suite is controlled through a runner object. This object is created with <cite>LuaUnit.new()</cite> .</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">lu</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s1">&#39;luaunit&#39;</span><span class="p">)</span>


<span class="n">runner</span> <span class="o">=</span> <span class="n">lu</span><span class="p">.</span><span class="n">LuaUnit</span><span class="p">.</span><span class="n">new</span><span class="p">()</span>
<span class="c1">-- use the runner object...</span>
<span class="n">runner</span><span class="p">.</span><span class="n">runSuite</span><span class="p">()</span>
</pre></div>
</div>
<dl class="py function">
<dt>
<code class="sig-name descname">runner:setVerbosity( verbosity )</code></dt>
<dd></dd></dl>

<p>Set the verbosity of the runner. The value is an integer ranging from lu.VERBOSITY_QUIET to lu.VERBOSITY_VERBOSE .</p>
<dl class="py function">
<dt>
<code class="sig-name descname">runner:setQuitOnError( quitOnError )</code></dt>
<dd></dd></dl>

<p>Set the quit-on-first-error behavior, like the command-line <cite>–xx</cite>. The argument is a boolean value.</p>
<dl class="py function">
<dt>
<code class="sig-name descname">runner:setQuitOnFailuer( quitOnFailure )</code></dt>
<dd></dd></dl>

<p>Set the quit-on-first-failure-or-error behavior, like the command-line <cite>–xx</cite>. The argument is a boolean value.</p>
<dl class="py function">
<dt>
<code class="sig-name descname">runner:setRepeat( repeatNumber )</code></dt>
<dd></dd></dl>

<p>Set the number of times a test function is executed, like the command-line <cite>-xx</cite>. The argument is an integer.</p>
<dl class="py function">
<dt>
<code class="sig-name descname">runner:setShuffle( shuffle )</code></dt>
<dd></dd></dl>

<p>Set whether the test are run in randomized, like the command-line <cite>–shuffle</cite>. The argument is a boolean value.</p>
<dl class="py function">
<dt>
<code class="sig-name descname">runner:setOutputType(type [, junit_fname])</code></dt>
<dd></dd></dl>

<p>Set the output type of the test suite. See <a class="reference internal" href="#output-formats">Output formats</a> for possible values. When setting the format <cite>junit</cite>, it
is mandatory to set the filename receiving the xml output. This can be done by passing it as second argument of this function.</p>
<dl class="py function">
<dt>
<code class="sig-name descname">runner:runSuite( [arguments] )</code></dt>
<dd></dd></dl>

<p>This function runs the test suite.</p>
<p><strong>Arguments</strong></p>
<p>If no arguments are supplied, it parses the command-line arguments of the script
and interpret them. If arguments are supplied to the function, they are parsed
as the command-line. It uses the same syntax.</p>
<p>Test names may be supplied in arguments, to execute
only these specific tests. Note that when explicit names are provided
LuaUnit does not require the test names to necessarily start with <em>test</em>.</p>
<p>If no test names were supplied, a general test collection process is done
and the resulting tests are executed.</p>
<p><strong>Return value</strong></p>
<p>It returns the number of failures and errors. On
success 0 is returned, making is suitable for an exit code.</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">lu</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s1">&#39;luaunit&#39;</span><span class="p">)</span>

<span class="n">runner</span> <span class="o">=</span> <span class="n">lu</span><span class="p">.</span><span class="n">LuaUnit</span><span class="p">.</span><span class="n">new</span><span class="p">()</span>
<span class="nb">os.exit</span><span class="p">(</span><span class="n">runner</span><span class="p">.</span><span class="n">runSuite</span><span class="p">())</span>
</pre></div>
</div>
<p>Example of using pattern to select tests:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">..</span> <span class="n">code</span><span class="o">-</span><span class="n">block</span><span class="p">::</span> <span class="n">lua</span>
</pre></div>
</div>
<blockquote>
<div><p>lu = require(‘luaunit’)</p>
<p>runner = lu.LuaUnit.new()
– execute tests matching the ‘withXY’ pattern
os.exit(runner.runSuite(‘–pattern’, ‘withXY’)</p>
</div></blockquote>
<p>Example of explicitly selecting tests:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">..</span> <span class="n">code</span><span class="o">-</span><span class="n">block</span><span class="p">::</span> <span class="n">lua</span>
</pre></div>
</div>
<blockquote>
<div><p>lu = require(‘luaunit’)</p>
<p>runner = lu.LuaUnit.new()
os.exit(runner.runSuite(‘testABC’, ‘testDEF’))</p>
</div></blockquote>
<dl class="py function">
<dt id="LuaUnit.run">
<code class="sig-prename descclassname">LuaUnit.</code><code class="sig-name descname">run</code><span class="sig-paren">(</span><span class="optional">[</span><em class="sig-param">arguments</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#LuaUnit.run" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>This function may be called directly from the LuaUnit table. It will
create internally a LuaUnit runner and pass all arguments to it.</p>
<p>Arguments and return value is the same as <code class="xref py py-func docutils literal notranslate"><span class="pre">runner:runSuite()</span></code></p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">..</span> <span class="n">code</span><span class="o">-</span><span class="n">block</span><span class="p">::</span> <span class="n">lua</span>
</pre></div>
</div>
<blockquote>
<div><p>– execute tests matching the ‘withXY’ pattern
os.exit(lu.LuaUnit.run(‘–pattern’, ‘withXY’))</p>
</div></blockquote>
<dl class="py function">
<dt>
<code class="sig-name descname">runner:runSuiteByInstances( listOfNameAndInstances  )</code></dt>
<dd></dd></dl>

<p>This function runs test without performing the global test collection process on the global namespace, the test
are explicitely provided as argument, along with their names.</p>
<p>Before execution, the function will parse the script command-line, like <code class="xref py py-func docutils literal notranslate"><span class="pre">funner:runSuite()</span></code>.</p>
<p>Input is provided as a list of { name, test_instance } . test_instance can either be a function or a table containing
test functions starting with the prefix “test”.</p>
<p>Example of using runSuiteByInstances</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">lu</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s1">&#39;luaunit&#39;</span><span class="p">)</span>

<span class="n">runner</span> <span class="o">=</span> <span class="n">lu</span><span class="p">.</span><span class="n">LuaUnit</span><span class="p">.</span><span class="n">new</span><span class="p">()</span>
<span class="nb">os.exit</span><span class="p">(</span><span class="n">runner</span><span class="p">.</span><span class="n">runSuiteByInstances</span><span class="p">(</span> <span class="p">{</span><span class="s1">&#39;mySpecialTest1&#39;</span><span class="p">,</span> <span class="n">mySpecialTest1</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;mySpecialTest2&#39;</span><span class="p">,</span> <span class="n">mySpecialTest2</span><span class="p">}</span> <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="skipping-and-ending-test">
<h3>Skipping and ending test<a class="headerlink" href="#skipping-and-ending-test" title="Permalink to this headline">¶</a></h3>
<p>LuaUnit allows to force test ending in several ways.</p>
<p><strong>Test skipping</strong></p>
<dl class="py function">
<dt id="skip">
<code class="sig-name descname">skip</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">message</span></em><span class="sig-paren">)</span><a class="headerlink" href="#skip" title="Permalink to this definition">¶</a></dt>
<dd><p>Stops the ongoing test and mark it as skipped with the given message. This can be used
to deactivate a given test.</p>
</dd></dl>

<dl class="py function">
<dt id="skipIf">
<code class="sig-name descname">skipIf</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">condition</span></em>, <em class="sig-param"><span class="n">message</span></em><span class="sig-paren">)</span><a class="headerlink" href="#skipIf" title="Permalink to this definition">¶</a></dt>
<dd><p>If the condition <em>condition</em> evaluates to <em>true</em>, stops the ongoing test and mark it as skipped with the given message.
Else, continue the test execution normally.</p>
<p>The expected usage is to call the function at the beginning of the test to
verify if the conditions are met for executing such tests.</p>
</dd></dl>

<dl class="py function">
<dt id="runOnlyIf">
<code class="sig-name descname">runOnlyIf</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">condition</span></em>, <em class="sig-param"><span class="n">message</span></em><span class="sig-paren">)</span><a class="headerlink" href="#runOnlyIf" title="Permalink to this definition">¶</a></dt>
<dd><p>If condition evaluates to <em>false</em>, stops the ongoing test and mark it as skipped with the
given message. This is the opposite behavior of <a class="reference internal" href="#skipIf" title="skipIf"><code class="xref py py-func docutils literal notranslate"><span class="pre">skipIf()</span></code></a> .</p>
<p>The expected usage is to call the function at the beginning of the test to
verify if the conditions are met for executing such tests.</p>
</dd></dl>

<p>Number of skipped tests, if any, are reported at the end of the execution.</p>
<p><strong>Force test failing</strong></p>
<dl class="py function">
<dt id="fail">
<code class="sig-name descname">fail</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">message</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fail" title="Permalink to this definition">¶</a></dt>
<dd><p>Stops the ongoing test and mark it as failed with the given message.</p>
</dd></dl>

<dl class="py function">
<dt id="failIf">
<code class="sig-name descname">failIf</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">condition</span></em>, <em class="sig-param"><span class="n">message</span></em><span class="sig-paren">)</span><a class="headerlink" href="#failIf" title="Permalink to this definition">¶</a></dt>
<dd><p>If the condition <em>condition</em> evaluates to <em>true</em>, stops the ongoing test and mark it as failed with the given message.
Else, continue the test execution normally.</p>
</dd></dl>

<p><strong>Force test success</strong></p>
<dl class="py function">
<dt id="success">
<code class="sig-name descname">success</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#success" title="Permalink to this definition">¶</a></dt>
<dd><p>Stops the ongoing test and mark it as successful.</p>
</dd></dl>

<dl class="py function">
<dt id="successIf">
<code class="sig-name descname">successIf</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">condition</span></em><span class="sig-paren">)</span><a class="headerlink" href="#successIf" title="Permalink to this definition">¶</a></dt>
<dd><p>If the condition <em>condition</em> evaluates to <em>true</em>, stops the ongoing test and mark it as successful.
Else, continue the test execution normally.</p>
</dd></dl>

</div>
<div class="section" id="output-formats-details">
<h3>Output formats details<a class="headerlink" href="#output-formats-details" title="Permalink to this headline">¶</a></h3>
<p>To demonstrate the different output formats, we will take the example of the <a class="reference internal" href="#getting-started-with-luaunit">Getting started with LuaUnit</a>
section and add the following two failing cases:</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">TestWithFailures</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c1">-- two failing tests</span>

    <span class="kr">function</span> <span class="nc">TestWithFailures</span><span class="p">:</span><span class="nf">testFail1</span><span class="p">()</span>
        <span class="kd">local</span> <span class="n">a</span><span class="o">=</span><span class="s2">&quot;toto&quot;</span>
        <span class="kd">local</span> <span class="n">b</span><span class="o">=</span><span class="s2">&quot;titi&quot;</span>
        <span class="n">lu</span><span class="p">.</span><span class="n">assertEquals</span><span class="p">(</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="p">)</span> <span class="c1">--oops, two values are not equal</span>
    <span class="kr">end</span>

    <span class="kr">function</span> <span class="nc">TestWithFailures</span><span class="p">:</span><span class="nf">testFail2</span><span class="p">()</span>
        <span class="kd">local</span> <span class="n">a</span><span class="o">=</span><span class="mi">1</span>
        <span class="kd">local</span> <span class="n">b</span><span class="o">=</span><span class="s1">&#39;toto&#39;</span>
        <span class="kd">local</span> <span class="n">c</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="c1">--oops, can not add string and numbers</span>
        <span class="kr">return</span> <span class="n">c</span>
    <span class="kr">end</span>
</pre></div>
</div>
<p><strong>Text format</strong></p>
<p>By default, LuaUnit uses the output format TEXT, with minimum verbosity:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ lua my_test_suite.lua
.......FE
Failed tests:
-------------
1) TestWithFailures.testFail1
doc\my_test_suite_with_failures.lua:79: expected: &quot;titi&quot;
actual: &quot;toto&quot;
stack traceback:
        doc\my_test_suite_with_failures.lua:79: in function &#39;TestWithFailures.testFail1&#39;

2) TestWithFailures.testFail2
doc\my_test_suite_with_failures.lua:85: attempt to perform arithmetic on local &#39;b&#39; (a string value)
stack traceback:
        [C]: in function &#39;xpcall&#39;

Ran 9 tests in 0.001 seconds, 7 successes, 1 failure, 1 error
</pre></div>
</div>
<p>This format is heavily inspired by python unit-test library. One character is printed
for every test executed, a dot for a successful test, a <strong>F</strong> for a test with failure and
a <strong>E</strong> for a test with an error.</p>
<p>At the end of the test suite execution, the details of the failures or errors are given, with an
informative message and a full stack trace.</p>
<p>The last line sums up the number of test executed, successful, failed, in error and not selected if any.
When all tests are successful, a line with just OK is added:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ lua doc\my_test_suite.lua
.......
Ran 7 tests in 0.002 seconds, 7 successes, 0 failures
OK
</pre></div>
</div>
<p>The text format is also available as a more verbose version, by adding the <code class="docutils literal notranslate"><span class="pre">--verbose</span></code> flag:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ lua doc\my_test_suite_with_failures.lua --verbose
Started on 02/20/17 21:47:21
    TestAdd.testAddError ... Ok
    TestAdd.testAddPositive ... Ok
    TestAdd.testAddZero ... Ok
    TestAdd.testAdder ... Ok
    TestDiv.testDivError ... Ok
    TestDiv.testDivPositive ... Ok
    TestDiv.testDivZero ... Ok
    TestWithFailures.testFail1 ... FAIL
doc\my_test_suite_with_failures.lua:79: expected: &quot;titi&quot;
actual: &quot;toto&quot;
    TestWithFailures.testFail2 ... ERROR
doc\my_test_suite_with_failures.lua:85: attempt to perform arithmetic on local &#39;b&#39; (a string value)
=========================================================
Failed tests:
-------------
1) TestWithFailures.testFail1
doc\my_test_suite_with_failures.lua:79: expected: &quot;titi&quot;
actual: &quot;toto&quot;
stack traceback:
        doc\my_test_suite_with_failures.lua:79: in function &#39;TestWithFailures.testFail1&#39;

2) TestWithFailures.testFail2
doc\my_test_suite_with_failures.lua:85: attempt to perform arithmetic on local &#39;b&#39; (a string value)
stack traceback:
        [C]: in function &#39;xpcall&#39;

Ran 9 tests in 0.008 seconds, 7 successes, 1 failure, 1 error
</pre></div>
</div>
<p>In this format, you get:</p>
<ul class="simple">
<li><p>a first line with date-time at which the test was started</p></li>
<li><p>one line per test executed</p></li>
<li><p>the test line is ended by <strong>Ok</strong>, <strong>FAIL</strong>, or <strong>ERROR</strong> in case the test is not successful</p></li>
<li><p>a summary of the failed tests with all details, like in the compact version.</p></li>
</ul>
<p>This format is usually interesting if some tests print debug output, to match the output to the test.</p>
<p><strong>JUNIT format</strong></p>
<p>The Junit XML format was introduced by the <a class="reference external" href="http://junit.org/junit4/">Java testing framework JUnit</a> and has been then used by many continuous
integration platform as an interoperability format between test suites and the platform.</p>
<p>To output in the JUnit XML format, you use the format junit with <code class="docutils literal notranslate"><span class="pre">--output</span> <span class="pre">junit</span></code> and specify the XML filename with <code class="docutils literal notranslate"><span class="pre">--name</span> <span class="pre">&lt;filename&gt;</span></code> . On
the standard output, LuaUnit will print information about the test progress in a simple format.</p>
<p>Let’s see with a simple example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ lua my_test_suite_with_failures.lua -o junit -n toto.xml
# XML output to toto.xml
# Started on 02/24/17 09:54:59
# Starting class: TestAdd
# Starting test: TestAdd.testAddError
# Starting test: TestAdd.testAddPositive
# Starting test: TestAdd.testAddZero
# Starting test: TestAdd.testAdder
# Starting class: TestDiv
# Starting test: TestDiv.testDivError
# Starting test: TestDiv.testDivPositive
# Starting test: TestDiv.testDivZero
# Starting class: TestWithFailures
# Starting test: TestWithFailures.testFail1
# Failure: doc/my_test_suite_with_failures.lua:79: expected: &quot;titi&quot;
# actual: &quot;toto&quot;
# Starting test: TestWithFailures.testFail2
# Error: doc/my_test_suite_with_failures.lua:85: attempt to perform arithmetic on local &#39;b&#39; (a string value)
# Ran 9 tests in 0.007 seconds, 7 successes, 1 failure, 1 error
</pre></div>
</div>
<p>On the standard output, you will see the date-time, the name of the XML file, one line for each test started, a summary
of the failure or errors when they occurs and the usual one line summary of the test execution: number of tests run, successful, failed,
in error and number of non selected tests if any.</p>
<p>The XML file generated by this execution is the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;testsuites&gt;
    &lt;testsuite name=&quot;LuaUnit&quot; id=&quot;00001&quot; package=&quot;&quot; hostname=&quot;localhost&quot; tests=&quot;9&quot; timestamp=&quot;2017-02-24T09:54:59&quot; time=&quot;0.007&quot; errors=&quot;1&quot; failures=&quot;1&quot;&gt;
        &lt;properties&gt;
            &lt;property name=&quot;Lua Version&quot; value=&quot;Lua 5.2&quot;/&gt;
            &lt;property name=&quot;LuaUnit Version&quot; value=&quot;3.2&quot;/&gt;
        &lt;/properties&gt;
        &lt;testcase classname=&quot;TestAdd&quot; name=&quot;TestAdd.testAddError&quot; time=&quot;0.001&quot;&gt;
        &lt;/testcase&gt;
        &lt;testcase classname=&quot;TestAdd&quot; name=&quot;TestAdd.testAddPositive&quot; time=&quot;0.001&quot;&gt;
        &lt;/testcase&gt;
        &lt;testcase classname=&quot;TestAdd&quot; name=&quot;TestAdd.testAddZero&quot; time=&quot;0.000&quot;&gt;
        &lt;/testcase&gt;
        &lt;testcase classname=&quot;TestAdd&quot; name=&quot;TestAdd.testAdder&quot; time=&quot;0.000&quot;&gt;
        &lt;/testcase&gt;
        &lt;testcase classname=&quot;TestDiv&quot; name=&quot;TestDiv.testDivError&quot; time=&quot;0.000&quot;&gt;
        &lt;/testcase&gt;
        &lt;testcase classname=&quot;TestDiv&quot; name=&quot;TestDiv.testDivPositive&quot; time=&quot;0.000&quot;&gt;
        &lt;/testcase&gt;
        &lt;testcase classname=&quot;TestDiv&quot; name=&quot;TestDiv.testDivZero&quot; time=&quot;0.001&quot;&gt;
        &lt;/testcase&gt;
        &lt;testcase classname=&quot;TestWithFailures&quot; name=&quot;TestWithFailures.testFail1&quot; time=&quot;0.000&quot;&gt;
            &lt;failure type=&quot;doc/my_test_suite_with_failures.lua:79: expected: &amp;quot;titi&amp;quot;
actual: &amp;quot;toto&amp;quot;&quot;&gt;
                &lt;![CDATA[stack traceback:
        doc/my_test_suite_with_failures.lua:79: in function &#39;TestWithFailures.testFail1&#39;]]&gt;&lt;/failure&gt;
        &lt;/testcase&gt;
        &lt;testcase classname=&quot;TestWithFailures&quot; name=&quot;TestWithFailures.testFail2&quot; time=&quot;0.000&quot;&gt;
            &lt;error type=&quot;doc/my_test_suite_with_failures.lua:85: attempt to perform arithmetic on local &amp;apos;b&amp;apos; (a string value)&quot;&gt;
                &lt;![CDATA[stack traceback:
        [C]: in function &#39;xpcall&#39;]]&gt;&lt;/error&gt;
        &lt;/testcase&gt;
    &lt;system-out/&gt;
    &lt;system-err/&gt;
    &lt;/testsuite&gt;
&lt;/testsuites&gt;
</pre></div>
</div>
<p>As you can see, the XML file is quite rich in terms of information. The verbosity level has no effect on junit output, all verbosity give the same output.</p>
<p>Slight inconsistencies exist in the exact XML format in the different continuous integration suites. LuaUnit provides a compatible output which
is validated against <a class="reference external" href="https://github.com/bluebird75/luaunit/blob/LUAUNIT_V3_2_1/junitxml/junit-jenkins.xsd">Jenkins/Hudson schema</a> . If you ever find an problem in the XML formats, please report a bug to us, more testing is always welcome.</p>
<p><strong>TAP format</strong></p>
<p>The <a class="reference external" href="https://testanything.org/">TAP format</a> for test results has been around since 1988. LuaUnit produces TAP reports compatible with version 12 of
the specification.</p>
<p>Example with minimal verbosiy:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ lua my_test_suite_with_failures.lua -o tap --quiet
1..9
# Started on 02/24/17 22:09:31
# Starting class: TestAdd
ok     1        TestAdd.testAddError
ok     2        TestAdd.testAddPositive
ok     3        TestAdd.testAddZero
ok     4        TestAdd.testAdder
# Starting class: TestDiv
ok     5        TestDiv.testDivError
ok     6        TestDiv.testDivPositive
ok     7        TestDiv.testDivZero
# Starting class: TestWithFailures
not ok 8        TestWithFailures.testFail1
not ok 9        TestWithFailures.testFail2
# Ran 9 tests in 0.003 seconds, 7 successes, 1 failure, 1 error
</pre></div>
</div>
<p>With minimal verbosity, you have one line for each test run, with the status of the test, and one comment line
when starting the test suite, when starting a new class or when finishing the test.</p>
<p>Example with default verbosiy:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ lua my_test_suite_with_failures.lua -o tap
1..9
# Started on 02/24/17 22:09:31
# Starting class: TestAdd
ok     1        TestAdd.testAddError
ok     2        TestAdd.testAddPositive
ok     3        TestAdd.testAddZero
ok     4        TestAdd.testAdder
# Starting class: TestDiv
ok     5        TestDiv.testDivError
ok     6        TestDiv.testDivPositive
ok     7        TestDiv.testDivZero
# Starting class: TestWithFailures
not ok 8        TestWithFailures.testFail1
    doc/my_test_suite_with_failures.lua:79: expected: &quot;titi&quot;
    actual: &quot;toto&quot;
not ok 9        TestWithFailures.testFail2
    doc/my_test_suite_with_failures.lua:85: attempt to perform arithmetic on local &#39;b&#39; (a string value)
# Ran 9 tests in 0.005 seconds, 7 successes, 1 failure, 1 error
</pre></div>
</div>
<p>In the default mode, the failure or error message is displayed in the failing test diagnostic part.</p>
<p>Example with full verbosiy:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ lua my_test_suite_with_failures.lua -o tap --verbose
1..9
# Started on 02/24/17 22:09:31
# Starting class: TestAdd
ok     1        TestAdd.testAddError
ok     2        TestAdd.testAddPositive
ok     3        TestAdd.testAddZero
ok     4        TestAdd.testAdder
# Starting class: TestDiv
ok     5        TestDiv.testDivError
ok     6        TestDiv.testDivPositive
ok     7        TestDiv.testDivZero
# Starting class: TestWithFailures
not ok 8        TestWithFailures.testFail1
    doc/my_test_suite_with_failures.lua:79: expected: &quot;titi&quot;
    actual: &quot;toto&quot;
    stack traceback:
        doc/my_test_suite_with_failures.lua:79: in function &#39;TestWithFailures.testFail1&#39;
not ok 9        TestWithFailures.testFail2
    doc/my_test_suite_with_failures.lua:85: attempt to perform arithmetic on local &#39;b&#39; (a string value)
    stack traceback:
        [C]: in function &#39;xpcall&#39;
# Ran 9 tests in 0.007 seconds, 7 successes, 1 failure, 1 error
</pre></div>
</div>
<p>With maximum verbosity, the stack trace is also displayed in the test diagnostic.</p>
<p><strong>NIL format</strong></p>
<p>With the nil format output, absolutely nothing is displayed while running the tests. Only the
exit code of the command can tell whether the test was successful or not:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ lua my_test_suite_with_failures.lua -o nil --verbose
$
</pre></div>
</div>
<p>This mode is used by LuaUnit for its internal validation.</p>
</div>
<div class="section" id="test-collection-and-execution-process">
<h3>Test collection and execution process<a class="headerlink" href="#test-collection-and-execution-process" title="Permalink to this headline">¶</a></h3>
<div class="section" id="test-collection">
<h4>Test collection<a class="headerlink" href="#test-collection" title="Permalink to this headline">¶</a></h4>
<p>The test collection and execution process is the following:</p>
<ul class="simple">
<li><p>If a list of tests is specified on the command-line or as argument to the <em>runSuite()</em> or <em>runSuiteByInstances()</em>, this
the considered list of tests to run.</p></li>
<li><p>If no list of tests is specified, the global namespace <em>_G</em> is searched for names starting by <em>test</em> or <em>Test</em>. All
such names are put into the list of tests to run (provided they reference either a function or a table).</p></li>
<li><p>All tables are then scanned for table functions starting with <em>test</em> or <em>Test</em>, which are then added to the list of tests to run</p></li>
<li><p>From the list of tests to run, include and exclude patterns are applied</p></li>
<li><p>If shuffling is activated, the list is randomized. Else, it is sorted in alphabetical order.</p></li>
</ul>
<p>This constitutes the final list of tests to run.</p>
</div>
<div class="section" id="test-execution">
<h4>Test execution<a class="headerlink" href="#test-execution" title="Permalink to this headline">¶</a></h4>
<p>Each test function is run in a protected call. If any luaunit assertion fails (assertEquals, …), the test is considered as a failure. If
an error is generated during the test execution, the test is marked as in error. Both errors and failures are reported at the end of the execution.</p>
<p>When executing a table containing tests, the following methods are also considered:</p>
<ul class="simple">
<li><p><em>setUp()</em> is called prior to each test execution. Any failure or error during <em>setUp()</em> will prevent the test from being executed and will
be reported in the test suite.</p></li>
<li><p><em>tearDown()</em> is called after each test, even if the <em>setUp()</em> or the test failed. Any failure or error during <em>tearDown()</em> will be reported
in the test suite.</p></li>
</ul>
</div>
</div>
<div class="section" id="assertions-functions">
<h3>Assertions functions<a class="headerlink" href="#assertions-functions" title="Permalink to this headline">¶</a></h3>
<p>We will now list all assertion functions. For every functions, the failure
message tries to be as informative as possible, by displaying the expectation and value that caused the failure. It
relies on the <a class="reference internal" href="#prettystr" title="prettystr"><code class="xref py py-func docutils literal notranslate"><span class="pre">prettystr()</span></code></a> for printing nicely formatted values.</p>
<p>All function accept an optional extra message which if provided, is printed along with the failure message.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>see <a class="reference internal" href="#table-printing"><span class="std std-ref">Annex A: More on table printing</span></a> for more information on how LuaUnit prints tables.</p>
</div>
<div class="section" id="equality-assertions">
<h4>Equality assertions<a class="headerlink" href="#equality-assertions" title="Permalink to this headline">¶</a></h4>
<p>All equality assertions functions take two arguments, in the order
<em>actual value</em> then <em>expected value</em>. Some people are more familiar
with the order <em>expected value</em> then <em>actual value</em>. It is possible to configure
LuaUnit to use the opposite order for all equality assertions, by setting up a module
variable:</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">lu</span><span class="p">.</span><span class="n">ORDER_ACTUAL_EXPECTED</span><span class="o">=</span><span class="kc">false</span>
</pre></div>
</div>
<p>The order only matters for the message that is displayed in case of failures. It does
not influence the test itself.</p>
<dl class="py function">
<dt id="assertEquals">
<code class="sig-name descname">assertEquals</code><span class="sig-paren">(</span><em class="sig-param">actual</em>, <em class="sig-param">expected</em><span class="optional">[</span>, <em class="sig-param">extra_msg</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#assertEquals" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Alias</strong>: <em>assert_equals()</em></p>
<p>Assert that two values are equal. This is the most used function for assertion within LuaUnit.
The values being compared may be integers, floats, strings, tables, functions or a combination of
those. If provided, <em>extra_msg</em> is a string which will be printed along with the failure message.</p>
<p>When comparing floating point numbers, it is better to use <a class="reference internal" href="#assertAlmostEquals" title="assertAlmostEquals"><code class="xref py py-func docutils literal notranslate"><span class="pre">assertAlmostEquals()</span></code></a> which supports a margin
for the equality verification.</p>
<p>For tables, the comparison supports nested tables and cyclic structures. To be equal, two tables must
have the same keys and the value associated with a key must compare equal with assertEquals() (using a recursive
algorithm).</p>
<p>When displaying the difference between two tables used as lists, LuaUnit performs an analysis of the list content
to pinpoint the place where the list actually differs. See the below example:</p>
</dd></dl>

<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>-- lua test code. Can you spot the difference ?
function TestListCompare:test1()
    local A = { 121221, 122211, 121221, 122211, 121221, 122212, 121212, 122112, 122121, 121212, 122121 }
    local B = { 121221, 122211, 121221, 122211, 121221, 122212, 121212, 122112, 121221, 121212, 122121 }
    lu.assertEquals( A, B )
end

$ lua test_some_lists_comparison.lua

TestListCompare.test1 ... FAIL
test/some_lists_comparisons.lua:22: expected:

List difference analysis:
* lists A (actual) and B (expected) have the same size
* lists A and B start differing at index 9
* lists A and B are equal again from index 10
* Common parts:
  = A[1], B[1]: 121221
  = A[2], B[2]: 122211
  = A[3], B[3]: 121221
  = A[4], B[4]: 122211
  = A[5], B[5]: 121221
  = A[6], B[6]: 122212
  = A[7], B[7]: 121212
  = A[8], B[8]: 122112
* Differing parts:
  - A[9]: 122121
  + B[9]: 121221
* Common parts at the end of the lists
  = A[10], B[10]: 121212
  = A[11], B[11]: 122121
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>see <a class="reference internal" href="#comparing-table-keys-table"><span class="std std-ref">Annex B: Comparing tables with keys of type table</span></a> for information on comparison of tables containing keys of type table.</p>
<p>LuaUnit provides other table-related assertions, see <a class="reference internal" href="#assert-table"><span class="std std-ref">Table assertions</span></a> .</p>
</div>
<dl class="py function">
<dt id="assertNotEquals">
<code class="sig-name descname">assertNotEquals</code><span class="sig-paren">(</span><em class="sig-param">actual</em>, <em class="sig-param">expected</em><span class="optional">[</span>, <em class="sig-param">extra_msg</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#assertNotEquals" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Alias</strong>: <em>assert_not_equals()</em></p>
<p>Assert that two values are different. The assertion
fails if the two values are identical. It behaves exactly like <a class="reference internal" href="#assertEquals" title="assertEquals"><code class="xref py py-func docutils literal notranslate"><span class="pre">assertEquals()</span></code></a> but checks
for the opposite condition.</p>
<p>If provided, <em>extra_msg</em> is a string which will be printed along with the failure message.</p>
</dd></dl>

</div>
<div class="section" id="value-assertions">
<h4>Value assertions<a class="headerlink" href="#value-assertions" title="Permalink to this headline">¶</a></h4>
<p>LuaUnit contains several flavours of true/false assertions, to be used in different contexts.
Usually, when asserting for <em>true</em> or <em>false</em>, you want strict assertions (<em>nil</em> should not
assert to <em>false</em>); <em>assertTrue()</em> and <em>assertFalse()</em> are the functions for this purpose. In some cases though,
you want Lua coercion rules to apply (e.g. value <em>1</em> or string <em>“hello”</em> yields <em>true</em>) and the right functions to use
are <em>assertEvalToTrue()</em> and <em>assertEvalToFalse()</em>. Finally, you have the <em>assertNotTrue()</em> and <em>assertNotFalse()</em> to verify
that a value is anything but the boolean <em>true</em> or <em>false</em>.</p>
<p>The below table sums it up:</p>
<blockquote>
<div><p><strong>True assertion family</strong></p>
</div></blockquote>
<table class="docutils align-default">
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 32%" />
<col style="width: 27%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Input Value</p></th>
<th class="head"><p>assertTrue()</p></th>
<th class="head"><p>assertEvalToTrue()</p></th>
<th class="head"><p>assertNotTrue()</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><em>true</em></p></td>
<td><p>OK</p></td>
<td><p>OK</p></td>
<td><p>OK</p></td>
</tr>
<tr class="row-odd"><td><p><em>false</em></p></td>
<td><p>Fail</p></td>
<td><p>Fail</p></td>
<td><p>Fail</p></td>
</tr>
<tr class="row-even"><td><p><em>nil</em></p></td>
<td><p>Fail</p></td>
<td><p>Fail</p></td>
<td><p>OK</p></td>
</tr>
<tr class="row-odd"><td><p><em>0</em></p></td>
<td><p>Fail</p></td>
<td><p>OK</p></td>
<td><p>OK</p></td>
</tr>
<tr class="row-even"><td><p><em>1</em></p></td>
<td><p>Fail</p></td>
<td><p>OK</p></td>
<td><p>OK</p></td>
</tr>
<tr class="row-odd"><td><p><em>“hello”</em></p></td>
<td><p>Fail</p></td>
<td><p>OK</p></td>
<td><p>OK</p></td>
</tr>
</tbody>
</table>
<blockquote>
<div><p><strong>False assertion family</strong></p>
</div></blockquote>
<table class="docutils align-default">
<colgroup>
<col style="width: 20%" />
<col style="width: 27%" />
<col style="width: 22%" />
<col style="width: 32%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Input Value</p></th>
<th class="head"><p>assertNotFalse()</p></th>
<th class="head"><p>assertFalse()</p></th>
<th class="head"><p>assertEvalToFalse()</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><em>true</em></p></td>
<td><p>Fail</p></td>
<td><p>Fail</p></td>
<td><p>Fail</p></td>
</tr>
<tr class="row-odd"><td><p><em>false</em></p></td>
<td><p>OK</p></td>
<td><p>OK</p></td>
<td><p>OK</p></td>
</tr>
<tr class="row-even"><td><p><em>nil</em></p></td>
<td><p>Fail</p></td>
<td><p>OK</p></td>
<td><p>OK</p></td>
</tr>
<tr class="row-odd"><td><p><em>0</em></p></td>
<td><p>Fail</p></td>
<td><p>Fail</p></td>
<td><p>Fail</p></td>
</tr>
<tr class="row-even"><td><p><em>1</em></p></td>
<td><p>Fail</p></td>
<td><p>Fail</p></td>
<td><p>Fail</p></td>
</tr>
<tr class="row-odd"><td><p><em>“hello”</em></p></td>
<td><p>Fail</p></td>
<td><p>Fail</p></td>
<td><p>Fail</p></td>
</tr>
</tbody>
</table>
<dl class="py function">
<dt id="assertEvalToTrue">
<code class="sig-name descname">assertEvalToTrue</code><span class="sig-paren">(</span><em class="sig-param">value</em><span class="optional">[</span>, <em class="sig-param">extra_msg</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#assertEvalToTrue" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Alias</strong>: <em>assert_eval_to_true()</em></p>
<p>Assert that a given value evals to <code class="docutils literal notranslate"><span class="pre">true</span></code>. Lua coercion rules are applied
so that values like <code class="docutils literal notranslate"><span class="pre">0</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">1.17</span></code> <strong>succeed</strong> in this assertion. If provided,
extra_msg is a string which will be printed along with the failure message.</p>
<p>See <a class="reference internal" href="#assertTrue" title="assertTrue"><code class="xref py py-func docutils literal notranslate"><span class="pre">assertTrue()</span></code></a> for a strict assertion to boolean <code class="docutils literal notranslate"><span class="pre">true</span></code>.</p>
</dd></dl>

<dl class="py function">
<dt id="assertEvalToFalse">
<code class="sig-name descname">assertEvalToFalse</code><span class="sig-paren">(</span><em class="sig-param">value</em><span class="optional">[</span>, <em class="sig-param">extra_msg</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#assertEvalToFalse" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Alias</strong>: <em>assert_eval_to_false()</em></p>
<p>Assert that a given value eval to <code class="docutils literal notranslate"><span class="pre">false</span></code>. Lua coercion rules are applied
so that <code class="docutils literal notranslate"><span class="pre">nil</span></code> and <code class="docutils literal notranslate"><span class="pre">false</span></code>  <strong>succeed</strong> in this assertion. If provided, extra_msg
is a string which will be printed along with the failure message.</p>
<p>See <a class="reference internal" href="#assertFalse" title="assertFalse"><code class="xref py py-func docutils literal notranslate"><span class="pre">assertFalse()</span></code></a> for a strict assertion to boolean <code class="docutils literal notranslate"><span class="pre">false</span></code>.</p>
</dd></dl>

<dl class="py function">
<dt id="assertTrue">
<code class="sig-name descname">assertTrue</code><span class="sig-paren">(</span><em class="sig-param">value</em><span class="optional">[</span>, <em class="sig-param">extra_msg</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#assertTrue" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Alias</strong>: <em>assert_true()</em></p>
<p>Assert that a given value is strictly <code class="docutils literal notranslate"><span class="pre">true</span></code>. Lua coercion rules do not apply
so that values like <code class="docutils literal notranslate"><span class="pre">0</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">1.17</span></code> <strong>fail</strong> in this assertion. If provided,
extra_msg is a string which will be printed along with the failure message.</p>
<p>See <a class="reference internal" href="#assertEvalToTrue" title="assertEvalToTrue"><code class="xref py py-func docutils literal notranslate"><span class="pre">assertEvalToTrue()</span></code></a> for an assertion to <code class="docutils literal notranslate"><span class="pre">true</span></code> where Lua coercion rules apply.</p>
</dd></dl>

<dl class="py function">
<dt id="assertFalse">
<code class="sig-name descname">assertFalse</code><span class="sig-paren">(</span><em class="sig-param">value</em><span class="optional">[</span>, <em class="sig-param">extra_msg</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#assertFalse" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Alias</strong>: <em>assert_false()</em></p>
<p>Assert that a given value is strictly <code class="docutils literal notranslate"><span class="pre">false</span></code>. Lua coercion rules do not apply
so that <code class="docutils literal notranslate"><span class="pre">nil</span></code> <strong>fails</strong> in this assertion. If provided, <em>extra_msg</em> is a string
which will be printed along with the failure message.</p>
<p>See <a class="reference internal" href="#assertEvalToFalse" title="assertEvalToFalse"><code class="xref py py-func docutils literal notranslate"><span class="pre">assertEvalToFalse()</span></code></a> for an assertion to <code class="docutils literal notranslate"><span class="pre">false</span></code> where Lua coertion fules apply.</p>
</dd></dl>

<dl class="py function">
<dt id="assertNil">
<code class="sig-name descname">assertNil</code><span class="sig-paren">(</span><em class="sig-param">value</em><span class="optional">[</span>, <em class="sig-param">extra_msg</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#assertNil" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Aliases</strong>: <em>assert_nil()</em>, <em>assertIsNil()</em>, <em>assert_is_nil()</em></p>
<p>Assert that a given value is <em>nil</em> . If provided, <em>extra_msg</em> is
a string which will be printed along with the failure message.</p>
</dd></dl>

<dl class="py function">
<dt id="assertNotNil">
<code class="sig-name descname">assertNotNil</code><span class="sig-paren">(</span><em class="sig-param">value</em><span class="optional">[</span>, <em class="sig-param">extra_msg</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#assertNotNil" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Aliases</strong>: <em>assert_not_nil()</em>, <em>assertNotIsNil()</em>, <em>assert_not_is_nil()</em></p>
<p>Assert that a given value is not <em>nil</em> . Lua coercion rules are applied
so that values like <code class="docutils literal notranslate"><span class="pre">0</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">false</span></code> all validate the assertion.
If provided, <em>extra_msg</em> is a string which will be printed along with the failure message.</p>
</dd></dl>

<dl class="py function">
<dt id="assertIs">
<code class="sig-name descname">assertIs</code><span class="sig-paren">(</span><em class="sig-param">actual</em>, <em class="sig-param">expected</em><span class="optional">[</span>, <em class="sig-param">extra_msg</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#assertIs" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Alias</strong>: <em>assert_is()</em></p>
<p>Assert that two variables are identical. For string, numbers, boolean and for nil,
this gives the same result as <a class="reference internal" href="#assertEquals" title="assertEquals"><code class="xref py py-func docutils literal notranslate"><span class="pre">assertEquals()</span></code></a> . For the other types, identity
means that the two variables refer to the same object.
If provided, <em>extra_msg</em> is a string which will be printed along with the failure message.</p>
<p><strong>Example :</strong></p>
</dd></dl>

<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">s1</span><span class="o">=</span><span class="s1">&#39;toto&#39;</span>
<span class="n">s2</span><span class="o">=</span><span class="s1">&#39;to&#39;</span><span class="o">..</span><span class="s1">&#39;to&#39;</span>
<span class="n">t1</span><span class="o">=</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">}</span>
<span class="n">t2</span><span class="o">=</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">}</span>
<span class="n">v1</span><span class="o">=</span><span class="kc">nil</span>
<span class="n">v2</span><span class="o">=</span><span class="kc">false</span>

<span class="n">lu</span><span class="p">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span><span class="n">s1</span><span class="p">)</span> <span class="c1">-- ok</span>
<span class="n">lu</span><span class="p">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span><span class="n">s2</span><span class="p">)</span> <span class="c1">-- ok</span>
<span class="n">lu</span><span class="p">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span><span class="n">t1</span><span class="p">)</span> <span class="c1">-- ok</span>
<span class="n">lu</span><span class="p">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span><span class="n">t2</span><span class="p">)</span> <span class="c1">-- fail</span>
<span class="n">lu</span><span class="p">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">)</span> <span class="c1">-- fail</span>
</pre></div>
</div>
<dl class="py function">
<dt id="assertNotIs">
<code class="sig-name descname">assertNotIs</code><span class="sig-paren">(</span><em class="sig-param">actual</em>, <em class="sig-param">expected</em><span class="optional">[</span>, <em class="sig-param">extra_msg</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#assertNotIs" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Alias</strong>: <em>assert_not_is()</em></p>
<p>Assert that two variables are not identical, in the sense that they do not
refer to the same value. If provided, <em>extra_msg</em> is a string which will be printed along with the failure message.</p>
<p>See <a class="reference internal" href="#assertIs" title="assertIs"><code class="xref py py-func docutils literal notranslate"><span class="pre">assertIs()</span></code></a> for more details.</p>
</dd></dl>

</div>
<div class="section" id="string-assertions">
<h4>String assertions<a class="headerlink" href="#string-assertions" title="Permalink to this headline">¶</a></h4>
<p>Assertions related to string and patterns.</p>
<dl class="py function">
<dt id="assertStrContains">
<code class="sig-name descname">assertStrContains</code><span class="sig-paren">(</span><em class="sig-param">str</em>, <em class="sig-param">sub</em><span class="optional">[</span>, <em class="sig-param">isPattern</em><span class="optional">[</span>, <em class="sig-param">extra_msg</em><span class="optional">]</span><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#assertStrContains" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Alias</strong>: <em>assert_str_contains()</em></p>
<p>Assert that the string <em>str</em> contains the substring or pattern <em>sub</em>.
If provided, <em>extra_msg</em> is a string which will be printed along with the failure message.</p>
<p>By default, substring is searched in the string. If <em>isPattern</em>
is provided and is true, <em>sub</em> is treated as a pattern which
is searched inside the string <em>str</em> .</p>
</dd></dl>

<dl class="py function">
<dt id="assertStrIContains">
<code class="sig-name descname">assertStrIContains</code><span class="sig-paren">(</span><em class="sig-param">str</em>, <em class="sig-param">sub</em><span class="optional">[</span>, <em class="sig-param">extra_msg</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#assertStrIContains" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Alias</strong>: <em>assert_str_icontains()</em></p>
<p>Assert that the string <em>str</em> contains the given substring <em>sub</em>, irrespective of the case.
If provided, <em>extra_msg</em> is a string which will be printed along with the failure message.</p>
<p>Note that unlike <code class="xref py py-func docutils literal notranslate"><span class="pre">assertStrcontains()</span></code>, you can not search for a pattern.</p>
</dd></dl>

<dl class="py function">
<dt id="assertNotStrContains">
<code class="sig-name descname">assertNotStrContains</code><span class="sig-paren">(</span><em class="sig-param">str</em>, <em class="sig-param">sub</em><span class="optional">[</span>, <em class="sig-param">isPattern</em><span class="optional">[</span>, <em class="sig-param">extra_msg</em><span class="optional">]</span><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#assertNotStrContains" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Alias</strong>: <em>assert_not_str_contains()</em></p>
<p>Assert that the string <em>str</em> does not contain the substring or pattern <em>sub</em>.
If provided, <em>extra_msg</em> is a string which will be printed along with the failure message.</p>
<p>By default, the substring is searched in the string. If <em>isPattern</em>
is provided and is true, <em>sub</em> is treated as a pattern which
is searched inside the string <em>str</em> .</p>
</dd></dl>

<dl class="py function">
<dt id="assertNotStrIContains">
<code class="sig-name descname">assertNotStrIContains</code><span class="sig-paren">(</span><em class="sig-param">str</em>, <em class="sig-param">sub</em><span class="optional">[</span>, <em class="sig-param">extra_msg</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#assertNotStrIContains" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Alias</strong>: <em>assert_not_str_icontains()</em></p>
<p>Assert that the string <em>str</em> does not contain the substring <em>sub</em>, irrespective of the case.
If provided, <em>extra_msg</em> is a string which will be printed along with the failure message.</p>
<p>Note that unlike <code class="xref py py-func docutils literal notranslate"><span class="pre">assertNotStrcontains()</span></code>, you can not search for a pattern.</p>
</dd></dl>

<dl class="py function">
<dt id="assertStrMatches">
<code class="sig-name descname">assertStrMatches</code><span class="sig-paren">(</span><em class="sig-param">str</em>, <em class="sig-param">pattern</em><span class="optional">[</span>, <em class="sig-param">start</em><span class="optional">[</span>, <em class="sig-param">final</em><span class="optional">[</span>, <em class="sig-param">extra_msg</em><span class="optional">]</span><span class="optional">]</span><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#assertStrMatches" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Alias</strong>: <em>assert_str_matches()</em></p>
<p>Assert that the string <em>str</em> matches the full pattern <em>pattern</em>.</p>
<p>If <em>start</em> and <em>final</em> are not provided or are <em>nil</em>, the pattern must match the full string, from start to end. The
function allows to specify the expected start and end position of the pattern in the string. If provided,
<em>extra_msg</em> is a string which will be printed along with the failure message.</p>
</dd></dl>

</div>
<div class="section" id="error-assertions">
<h4>Error assertions<a class="headerlink" href="#error-assertions" title="Permalink to this headline">¶</a></h4>
<p>Error related assertions, to verify error generation and error messages.</p>
<dl class="py function">
<dt id="assertError">
<code class="sig-name descname">assertError</code><span class="sig-paren">(</span><em class="sig-param">func</em>, <em class="sig-param">...</em><span class="sig-paren">)</span><a class="headerlink" href="#assertError" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Alias</strong>: <em>assert_error()</em></p>
<p>Assert that calling functions <em>func</em> with the arguments yields an error. If the
function does not yield an error, the assertion fails.</p>
<p>Note that the error message itself is not checked, which means that this function
does not distinguish between the legitimate error that you expect and another error
that might be triggered by mistake.</p>
<p>The next functions provide a better approach to error testing, by checking
explicitly the error message content.</p>
</dd></dl>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When testing LuaUnit, switching from <em>assertError()</em> to  <em>assertErrorMsgEquals()</em>
revealed quite a few bugs!</p>
</div>
<dl class="py function">
<dt id="assertErrorMsgEquals">
<code class="sig-name descname">assertErrorMsgEquals</code><span class="sig-paren">(</span><em class="sig-param">expectedMsg</em>, <em class="sig-param">func</em>, <em class="sig-param">...</em><span class="sig-paren">)</span><a class="headerlink" href="#assertErrorMsgEquals" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Alias</strong>: <em>assert_error_msg_equals()</em></p>
<p>Assert that calling function <em>func</em> will generate exactly the given error message. If the
function does not yield an error, or if the error message is not identical, the assertion fails.</p>
<p>Be careful when using this function that error messages usually contain the file name and
line number information of where the error was generated. This is usually inconvenient so we have
introduced the <a class="reference internal" href="#assertErrorMsgContentEquals" title="assertErrorMsgContentEquals"><code class="xref py py-func docutils literal notranslate"><span class="pre">assertErrorMsgContentEquals()</span></code></a> . Be sure to check it.</p>
</dd></dl>

<dl class="py function">
<dt id="assertErrorMsgContentEquals">
<code class="sig-name descname">assertErrorMsgContentEquals</code><span class="sig-paren">(</span><em class="sig-param">expectedMsg</em>, <em class="sig-param">func</em>, <em class="sig-param">...</em><span class="sig-paren">)</span><a class="headerlink" href="#assertErrorMsgContentEquals" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Alias</strong>: <em>assert_error_msg_content_equals()</em></p>
<p>Assert that calling function <em>func</em> will generate exactly the given error message, excluding the
file and line information. File and line information may change as your programs evolve so we
find this version more convenient than <a class="reference internal" href="#assertErrorMsgEquals" title="assertErrorMsgEquals"><code class="xref py py-func docutils literal notranslate"><span class="pre">assertErrorMsgEquals()</span></code></a> .</p>
</dd></dl>

<dl class="py function">
<dt id="assertErrorMsgContains">
<code class="sig-name descname">assertErrorMsgContains</code><span class="sig-paren">(</span><em class="sig-param">partialMsg</em>, <em class="sig-param">func</em>, <em class="sig-param">...</em><span class="sig-paren">)</span><a class="headerlink" href="#assertErrorMsgContains" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Alias</strong>: <em>assert_error_msg_contains()</em></p>
<p>Assert that calling function <em>func</em> will generate an error message containing <em>partialMsg</em> . If the
function does not yield an error, or if the expected message is not contained in the error message, the
assertion fails.</p>
</dd></dl>

<dl class="py function">
<dt id="assertErrorMsgMatches">
<code class="sig-name descname">assertErrorMsgMatches</code><span class="sig-paren">(</span><em class="sig-param">expectedPattern</em>, <em class="sig-param">func</em>, <em class="sig-param">...</em><span class="sig-paren">)</span><a class="headerlink" href="#assertErrorMsgMatches" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Alias</strong>: <em>assert_error_msg_matches()</em></p>
<p>Assert that calling function <em>func</em> will generate an error message matching <em>expectedPattern</em> . If the
function does not yield an error, or if the error message does not match the provided patternm the
assertion fails.</p>
<p>Note that matching is done from the start to the end of the error message. Be sure to escape magic all magic
characters with <code class="docutils literal notranslate"><span class="pre">%</span></code> (like <code class="docutils literal notranslate"><span class="pre">-+.?*</span></code>) .</p>
</dd></dl>

</div>
<div class="section" id="type-assertions">
<h4>Type assertions<a class="headerlink" href="#type-assertions" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>The following functions all perform type checking on their argument. If the
received value is not of the right type, the failure message will contain
the expected type, the received type and the received value to help you
identify better the problem.</p>
</div></blockquote>
<dl class="py function">
<dt id="assertIsNumber">
<code class="sig-name descname">assertIsNumber</code><span class="sig-paren">(</span><em class="sig-param">value</em><span class="optional">[</span>, <em class="sig-param">extra_msg</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#assertIsNumber" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Aliases</strong>: <em>assertNumber()</em>, <em>assert_is_number()</em>, <em>assert_number()</em></p>
<p>Assert that the argument is a number (integer or float).
If provided, <em>extra_msg</em> is a string which will be printed along with the failure message.</p>
</dd></dl>

<dl class="py function">
<dt id="assertIsString">
<code class="sig-name descname">assertIsString</code><span class="sig-paren">(</span><em class="sig-param">value</em><span class="optional">[</span>, <em class="sig-param">extra_msg</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#assertIsString" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Aliases</strong>: <em>assertString()</em>, <em>assert_is_string()</em>, <em>assert_string()</em></p>
<p>Assert that the argument is a string.
If provided, <em>extra_msg</em> is a string which will be printed along with the failure message.</p>
</dd></dl>

<dl class="py function">
<dt id="assertIsTable">
<code class="sig-name descname">assertIsTable</code><span class="sig-paren">(</span><em class="sig-param">value</em><span class="optional">[</span>, <em class="sig-param">extra_msg</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#assertIsTable" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Aliases</strong>: <em>assertTable()</em>, <em>assert_is_table()</em>, <em>assert_table()</em></p>
<p>Assert that the argument is a table.
If provided, <em>extra_msg</em> is a string which will be printed along with the failure message.</p>
</dd></dl>

<dl class="py function">
<dt id="assertIsBoolean">
<code class="sig-name descname">assertIsBoolean</code><span class="sig-paren">(</span><em class="sig-param">value</em><span class="optional">[</span>, <em class="sig-param">extra_msg</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#assertIsBoolean" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Aliases</strong>: <em>assertBoolean()</em>, <em>assert_is_boolean()</em>, <em>assert_boolean()</em></p>
<p>Assert that the argument is a boolean.
If provided, <em>extra_msg</em> is a string which will be printed along with the failure message.</p>
</dd></dl>

<dl class="py function">
<dt id="assertIsNil">
<code class="sig-name descname">assertIsNil</code><span class="sig-paren">(</span><em class="sig-param">value</em><span class="optional">[</span>, <em class="sig-param">extra_msg</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#assertIsNil" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Aliases</strong>: <em>assertNil()</em>, <em>assert_is_nil()</em>, <em>assert_nil()</em></p>
<p>Assert that the argument is nil.
If provided, <em>extra_msg</em> is a string which will be printed along with the failure message.</p>
</dd></dl>

<dl class="py function">
<dt id="assertIsFunction">
<code class="sig-name descname">assertIsFunction</code><span class="sig-paren">(</span><em class="sig-param">value</em><span class="optional">[</span>, <em class="sig-param">extra_msg</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#assertIsFunction" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Aliases</strong>: <em>assertFunction()</em>, <em>assert_is_function()</em>, <em>assert_function()</em></p>
<p>Assert that the argument is a function.
If provided, <em>extra_msg</em> is a string which will be printed along with the failure message.</p>
</dd></dl>

<dl class="py function">
<dt id="assertIsUserdata">
<code class="sig-name descname">assertIsUserdata</code><span class="sig-paren">(</span><em class="sig-param">value</em><span class="optional">[</span>, <em class="sig-param">extra_msg</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#assertIsUserdata" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Aliases</strong>: <em>assertUserdata()</em>, <em>assert_is_userdata()</em>, <em>assert_userdata()</em></p>
<p>Assert that the argument is a userdata.
If provided, <em>extra_msg</em> is a string which will be printed along with the failure message.</p>
</dd></dl>

<dl class="py function">
<dt id="assertIsCoroutine">
<code class="sig-name descname">assertIsCoroutine</code><span class="sig-paren">(</span><em class="sig-param">value</em><span class="optional">[</span>, <em class="sig-param">extra_msg</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#assertIsCoroutine" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Aliases</strong>: <em>assertCoroutine()</em>, <em>assert_is_coroutine()</em>, <em>assert_coroutine()</em></p>
<p>Assert that the argument is a coroutine (an object with type <em>thread</em> ).
If provided, <em>extra_msg</em> is a string which will be printed along with the failure message.</p>
</dd></dl>

<dl class="py function">
<dt id="assertIsThread">
<code class="sig-name descname">assertIsThread</code><span class="sig-paren">(</span><em class="sig-param">value</em><span class="optional">[</span>, <em class="sig-param">extra_msg</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#assertIsThread" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Aliases</strong>: <em>assertIsThread()</em>, <em>assertThread()</em>, <em>assert_is_thread()</em>, <em>assert_thread()</em></p>
<p>Same function as :func:assertIsCoroutine . Since Lua coroutines have the type thread, it’s not
clear which name is the clearer, so we provide syntax for both names.
If provided, <em>extra_msg</em> is a string which will be printed along with the failure message.</p>
</dd></dl>

</div>
<div class="section" id="table-assertions">
<span id="assert-table"></span><h4>Table assertions<a class="headerlink" href="#table-assertions" title="Permalink to this headline">¶</a></h4>
<dl class="py function">
<dt id="assertItemsEquals">
<code class="sig-name descname">assertItemsEquals</code><span class="sig-paren">(</span><em class="sig-param">actual</em>, <em class="sig-param">expected</em><span class="optional">[</span>, <em class="sig-param">extra_msg</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#assertItemsEquals" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Alias</strong>: <em>assert_items_equals()</em></p>
<p>Assert that two tables contain the same items, irrespective of their keys.
If provided, <em>extra_msg</em> is a string which will be printed along with the failure message.</p>
<p>This function is practical for example if you want to compare two lists but
where items are not in the same order:</p>
</dd></dl>

<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">lu</span><span class="p">.</span><span class="n">assertItemsEquals</span><span class="p">(</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">},</span> <span class="p">{</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">}</span> <span class="p">)</span> <span class="c1">-- assertion succeeds</span>
</pre></div>
</div>
<blockquote>
<div><p>The comparison is not recursive on the items: if any of the items are tables,
they are compared using table equality (like as in <a class="reference internal" href="#assertEquals" title="assertEquals"><code class="xref py py-func docutils literal notranslate"><span class="pre">assertEquals()</span></code></a> ), where
the key matters.</p>
</div></blockquote>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">lu</span><span class="p">.</span><span class="n">assertItemsEquals</span><span class="p">(</span> <span class="p">{</span><span class="mi">1</span><span class="p">,{</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">},</span><span class="mi">4</span><span class="p">},</span> <span class="p">{</span><span class="mi">4</span><span class="p">,{</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,},</span><span class="mi">1</span><span class="p">}</span> <span class="p">)</span> <span class="c1">-- assertion fails because {2,3} ~= {3,2}</span>
</pre></div>
</div>
<dl class="py function">
<dt id="assertTableContains">
<code class="sig-name descname">assertTableContains</code><span class="sig-paren">(</span><em class="sig-param">table</em>, <em class="sig-param">element</em><span class="optional">[</span>, <em class="sig-param">extra_msg</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#assertTableContains" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Alias</strong>: <em>assert_table_contains()</em></p>
<p>Assert that the table contains at least one key with value <cite>element</cite>. Element
may be of any type (including table), the recursive equality algorithm of assertEquals()
is used for verifying the presence of the element.
If provided, <em>extra_msg</em> is a string which will be printed along with the failure message.</p>
</dd></dl>

<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">lu</span><span class="p">.</span><span class="n">assertTableContains</span><span class="p">(</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">},</span> <span class="s1">&#39;b&#39;</span> <span class="p">)</span> <span class="c1">-- assertion succeeds</span>
<span class="n">lu</span><span class="p">.</span><span class="n">assertTableContains</span><span class="p">(</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="p">{</span><span class="mi">4</span><span class="p">}</span> <span class="p">},</span> <span class="p">{</span><span class="mi">4</span><span class="p">}</span> <span class="p">}</span> <span class="c1">-- assertion succeeds</span>
</pre></div>
</div>
<dl class="py function">
<dt id="assertNotTableContains">
<code class="sig-name descname">assertNotTableContains</code><span class="sig-paren">(</span><em class="sig-param">table</em>, <em class="sig-param">element</em><span class="optional">[</span>, <em class="sig-param">extra_msg</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#assertNotTableContains" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Alias</strong>: <em>assert_not_table_contains()</em></p>
<p>Negative version of <a class="reference internal" href="#assertTableContains" title="assertTableContains"><code class="xref py py-func docutils literal notranslate"><span class="pre">assertTableContains()</span></code></a> .</p>
<p>Assert that the table contains no element with value <cite>element</cite>. Element
may be of any type (including table), the recursive equality algorithm of assertEquals()
is used for verifying the presence of the element.
If provided, <em>extra_msg</em> is a string which will be printed along with the failure message.</p>
</dd></dl>

<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">lu</span><span class="p">.</span><span class="n">assertNotTableContains</span><span class="p">(</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">},</span> <span class="s1">&#39;e&#39;</span> <span class="p">)</span> <span class="c1">-- assertion succeeds</span>
<span class="n">lu</span><span class="p">.</span><span class="n">assertNotTableContains</span><span class="p">(</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="p">{</span><span class="mi">4</span><span class="p">}</span> <span class="p">},</span> <span class="p">{</span><span class="mi">5</span><span class="p">}</span> <span class="p">}</span> <span class="c1">-- assertion succeeds</span>
</pre></div>
</div>
</div>
<div class="section" id="scientific-computing-and-luaunit">
<h4>Scientific computing and LuaUnit<a class="headerlink" href="#scientific-computing-and-luaunit" title="Permalink to this headline">¶</a></h4>
<p>LuaUnit is used by the CERN for the MAD-NG program, the forefront of computational physics in the field of particle accelerator design and simulation (See <a class="reference external" href="http://mad.web.cern.ch/mad/">MAD</a>). Thank to the feedback of a scientific computing developer, LuaUnit has been enhanced with some facilities for scientific applications (see all assertions functions below).</p>
<p>The floating point library used by Lua is the one provided by the C compiler which built Lua. It is usually compliant with <a class="reference external" href="https://en.wikipedia.org/wiki/IEEE_754">IEEE-754</a> . As such,
it can yields results such as <em>plus infinity</em>, <em>minus infinity</em> or <em>Not a Number</em> (NaN). The precision of any calculation performed in Lua is
related to the smallest representable floating point value (typically called <em>EPS</em>): 2^-52 for 64 bits floats (type double in the C language) and 2^-23 for 32 bits float
(type float in C).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Lua may be compiled with numbers represented either as 32 bits floats or 64 bits double (as defined by the macro LUA_FLOAT_TYPE in luaconf.h ). LuaUnit has been validated in both these configurations and in particuluar, the epsilon value <em>EPS</em> is adjusted accordingly.</p>
</div>
<p>For more information about performing calculations on computers, please read the reference paper <a class="reference external" href="https://docs.oracle.com/cd/E19957-01/806-3568/ncg_goldberg.html">What Every Computer Scientist Should Know About Floating-Point Arithmetic</a></p>
<p>If your calculation shall be portable to multiple OS or compilers, you may get different calculation errors depending on the OS/compiler. It is therefore important to verify them on every target.</p>
<span class="target" id="minuszero"></span><p id="eps"><strong>EPS</strong> <em>constant</em></p>
<p>The machine epsilon, to be used with <a class="reference internal" href="#assertAlmostEquals" title="assertAlmostEquals"><code class="xref py py-func docutils literal notranslate"><span class="pre">assertAlmostEquals()</span></code></a> .</p>
<p>This is either:</p>
<ul class="simple">
<li><p>2^-52 or ~2.22E-16 (with lua number defined as double)</p></li>
<li><p>2^-23 or ~1.19E-07 (with lua number defined as float)</p></li>
</ul>
<dl class="py function">
<dt id="assertNan">
<code class="sig-name descname">assertNan</code><span class="sig-paren">(</span><em class="sig-param">value</em><span class="optional">[</span>, <em class="sig-param">extra_msg</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#assertNan" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Alias</strong>: <em>assert_nan()</em></p>
<p>Assert that a given number is a <em>NaN</em> (Not a Number), according to the definition of <a class="reference external" href="https://en.wikipedia.org/wiki/IEEE_754">IEEE-754</a> .
If provided, <em>extra_msg</em> is a string which will be printed along with the failure message.</p>
</dd></dl>

<dl class="py function">
<dt id="assertNotNan">
<code class="sig-name descname">assertNotNan</code><span class="sig-paren">(</span><em class="sig-param">value</em><span class="optional">[</span>, <em class="sig-param">extra_msg</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#assertNotNan" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Alias</strong>: <em>assert_not_nan()</em></p>
<p>Assert that a given number is NOT a <em>NaN</em> (Not a Number), according to the definition of <a class="reference external" href="https://en.wikipedia.org/wiki/IEEE_754">IEEE-754</a> .
If provided, <em>extra_msg</em> is a string which will be printed along with the failure message.</p>
</dd></dl>

<dl class="py function">
<dt id="assertPlusInf">
<code class="sig-name descname">assertPlusInf</code><span class="sig-paren">(</span><em class="sig-param">value</em><span class="optional">[</span>, <em class="sig-param">extra_msg</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#assertPlusInf" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Alias</strong>: <em>assert_plus_inf()</em></p>
<p>Assert that a given number is <em>plus infinity</em>, according to the definition of <a class="reference external" href="https://en.wikipedia.org/wiki/IEEE_754">IEEE-754</a> .
If provided, <em>extra_msg</em> is a string which will be printed along with the failure message.</p>
</dd></dl>

<dl class="py function">
<dt id="assertMinusInf">
<code class="sig-name descname">assertMinusInf</code><span class="sig-paren">(</span><em class="sig-param">value</em><span class="optional">[</span>, <em class="sig-param">extra_msg</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#assertMinusInf" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Alias</strong>: <em>assert_minus_inf()</em></p>
<p>Assert that a given number is <em>minus infinity</em>, according to the definition of <a class="reference external" href="https://en.wikipedia.org/wiki/IEEE_754">IEEE-754</a> .
If provided, <em>extra_msg</em> is a string which will be printed along with the failure message.</p>
</dd></dl>

<dl class="py function">
<dt id="assertInf">
<code class="sig-name descname">assertInf</code><span class="sig-paren">(</span><em class="sig-param">value</em><span class="optional">[</span>, <em class="sig-param">extra_msg</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#assertInf" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Alias</strong>: <em>assert_inf()</em></p>
<p>Assert that a given number is <em>infinity</em> (either positive or negative), according to the definition of <a class="reference external" href="https://en.wikipedia.org/wiki/IEEE_754">IEEE-754</a> .
If provided, <em>extra_msg</em> is a string which will be printed along with the failure message.</p>
</dd></dl>

<dl class="py function">
<dt id="assertNotPlusInf">
<code class="sig-name descname">assertNotPlusInf</code><span class="sig-paren">(</span><em class="sig-param">value</em><span class="optional">[</span>, <em class="sig-param">extra_msg</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#assertNotPlusInf" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Alias</strong>: <em>assert_not_plus_inf()</em></p>
<p>Assert that a given number is NOT <em>plus infinity</em>, according to the definition of <a class="reference external" href="https://en.wikipedia.org/wiki/IEEE_754">IEEE-754</a> .
If provided, <em>extra_msg</em> is a string which will be printed along with the failure message.</p>
</dd></dl>

<dl class="py function">
<dt id="assertNotMinusInf">
<code class="sig-name descname">assertNotMinusInf</code><span class="sig-paren">(</span><em class="sig-param">value</em><span class="optional">[</span>, <em class="sig-param">extra_msg</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#assertNotMinusInf" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Alias</strong>: <em>assert_not_minus_inf()</em></p>
<p>Assert that a given number is NOT <em>minus infinity</em>, according to the definition of <a class="reference external" href="https://en.wikipedia.org/wiki/IEEE_754">IEEE-754</a> .
If provided, <em>extra_msg</em> is a string which will be printed along with the failure message.</p>
</dd></dl>

<dl class="py function">
<dt id="assertNotInf">
<code class="sig-name descname">assertNotInf</code><span class="sig-paren">(</span><em class="sig-param">value</em><span class="optional">[</span>, <em class="sig-param">extra_msg</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#assertNotInf" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Alias</strong>: <em>assert_not_inf()</em></p>
<p>Assert that a given number is neither <em>infinity</em> nor <em>minus infinity</em>, according to the definition of <a class="reference external" href="https://en.wikipedia.org/wiki/IEEE_754">IEEE-754</a> .
If provided, <em>extra_msg</em> is a string which will be printed along with the failure message.</p>
</dd></dl>

<dl class="py function">
<dt id="assertPlusZero">
<code class="sig-name descname">assertPlusZero</code><span class="sig-paren">(</span><em class="sig-param">value</em><span class="optional">[</span>, <em class="sig-param">extra_msg</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#assertPlusZero" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Alias</strong>: <em>assert_plus_zero()</em></p>
<p>Assert that a given number is <em>+0</em>, according to the definition of <a class="reference external" href="https://en.wikipedia.org/wiki/IEEE_754">IEEE-754</a> . The
verification is done by dividing by the provided number and verifying that it yields
<em>infinity</em> . If provided, <em>extra_msg</em> is a string which will be printed along with the failure message.</p>
<p>Be careful when dealing with <em>+0</em> and <em>-0</em>, see note above.</p>
</dd></dl>

<dl class="py function">
<dt id="assertMinusZero">
<code class="sig-name descname">assertMinusZero</code><span class="sig-paren">(</span><em class="sig-param">value</em><span class="optional">[</span>, <em class="sig-param">extra_msg</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#assertMinusZero" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Alias</strong>: <em>assert_minus_zero()</em></p>
<p>Assert that a given number is <em>-0</em>, according to the definition of <a class="reference external" href="https://en.wikipedia.org/wiki/IEEE_754">IEEE-754</a> . The
verification is done by dividing by the provided number and verifying that it yields
<em>minus infinity</em> . If provided, <em>extra_msg</em> is a string which will be printed along with the failure message.</p>
<p>Be careful when dealing with <em>+0</em> and <em>-0</em>, see <a class="reference internal" href="#minuszero">MinusZero</a></p>
</dd></dl>

<dl class="py function">
<dt id="assertNotPlusZero">
<code class="sig-name descname">assertNotPlusZero</code><span class="sig-paren">(</span><em class="sig-param">value</em><span class="optional">[</span>, <em class="sig-param">extra_msg</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#assertNotPlusZero" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Alias</strong>: <em>assert_not_plus_zero()</em></p>
<p>Assert that a given number is NOT <em>+0</em>, according to the definition of <a class="reference external" href="https://en.wikipedia.org/wiki/IEEE_754">IEEE-754</a> .
If provided, <em>extra_msg</em> is a string which will be printed along with the failure message.</p>
<p>Be careful when dealing with <em>+0</em> and <em>-0</em>, see <a class="reference internal" href="#minuszero">MinusZero</a></p>
</dd></dl>

<dl class="py function">
<dt id="assertNotMinusZero">
<code class="sig-name descname">assertNotMinusZero</code><span class="sig-paren">(</span><em class="sig-param">value</em><span class="optional">[</span>, <em class="sig-param">extra_msg</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#assertNotMinusZero" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Alias</strong>: <em>assert_not_minus_zero()</em></p>
<p>Assert that a given number is NOT <em>-0</em>, according to the definition of <a class="reference external" href="https://en.wikipedia.org/wiki/IEEE_754">IEEE-754</a> .
If provided, <em>extra_msg</em> is a string which will be printed along with the failure message.</p>
<p>Be careful when dealing with <em>+0</em> and <em>-0</em>, see <a class="reference internal" href="#minuszero">MinusZero</a></p>
</dd></dl>

<dl class="py function">
<dt id="assertAlmostEquals">
<code class="sig-name descname">assertAlmostEquals</code><span class="sig-paren">(</span><em class="sig-param">actual</em>, <em class="sig-param">expected</em><span class="optional">[</span>, <em class="sig-param">margin=EPS</em><span class="optional">[</span>, <em class="sig-param">extra_msg</em><span class="optional">]</span><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#assertAlmostEquals" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Alias</strong>: <em>assert_almost_equals()</em></p>
<p>Assert that two floating point numbers or tables are equal by the defined margin.
If margin is not provided, the machine epsilon <em>EPS</em> is used.
If provided, <em>extra_msg</em> is a string which will be printed along with the failure message.</p>
<p>The function accepts either floating point numbers or tables. Complex structures with
nested tables are supported. Comparing tables with assertAlmostEquals works just like <a class="reference internal" href="#assertEquals" title="assertEquals"><code class="xref py py-func docutils literal notranslate"><span class="pre">assertEquals()</span></code></a>
with the difference that values are compared with a margin instead of with direct equality.</p>
<p>Be careful that depending on the calculation, it might make more sense to measure
the absolute error or the relative error (see below):</p>
</dd></dl>

<dl class="py function">
<dt id="assertNotAlmostEquals">
<code class="sig-name descname">assertNotAlmostEquals</code><span class="sig-paren">(</span><em class="sig-param">actual</em>, <em class="sig-param">expected</em><span class="optional">[</span>, <em class="sig-param">margin=EPS</em><span class="optional">[</span>, <em class="sig-param">extra_msg</em><span class="optional">]</span><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#assertNotAlmostEquals" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Alias</strong>: <em>assert_not_almost_equals()</em></p>
<p>Assert that two floating point numbers are not equal by the defined margin.
If margin is not provided, the machine epsilon <em>EPS</em> is used.
If provided, <em>extra_msg</em> is a string which will be printed along with the failure message.</p>
<p>Be careful that depending on the calculation, it might make more sense to measure
the absolute error or the relative error (see below).</p>
</dd></dl>

<p><strong>Example of absolute versus relative error</strong></p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="c1">-- convert pi/6 radian to 30 degree</span>
<span class="n">pi_div_6_deg_calculated</span> <span class="o">=</span> <span class="nb">math.deg</span><span class="p">(</span><span class="nb">math.pi</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span>
<span class="n">pi_div_6_deg_expected</span> <span class="o">=</span> <span class="mi">30</span>

<span class="c1">-- convert pi/3 radian to 60 degree</span>
<span class="n">pi_div_3_deg_calculated</span> <span class="o">=</span> <span class="nb">math.deg</span><span class="p">(</span><span class="nb">math.pi</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
<span class="n">pi_div_3_deg_expected</span> <span class="o">=</span> <span class="mi">60</span>

<span class="c1">-- check absolute error: it is not constant</span>
<span class="nb">print</span><span class="p">(</span> <span class="p">(</span><span class="n">pi_div_6_deg_expected</span> <span class="o">-</span> <span class="n">pi_div_6_deg_calculated</span><span class="p">)</span> <span class="o">/</span> <span class="n">lu</span><span class="p">.</span><span class="n">EPS</span> <span class="p">)</span> <span class="c1">-- prints: 16</span>
<span class="nb">print</span><span class="p">(</span> <span class="p">(</span><span class="n">pi_div_3_deg_expected</span> <span class="o">-</span> <span class="n">pi_div_3_deg_calculated</span><span class="p">)</span> <span class="o">/</span> <span class="n">lu</span><span class="p">.</span><span class="n">EPS</span> <span class="p">)</span> <span class="c1">-- prints: 32</span>

<span class="c1">-- Better use relative error:</span>
<span class="nb">print</span><span class="p">(</span> <span class="p">(</span> <span class="p">(</span><span class="n">pi_div_6_deg_expected</span> <span class="o">-</span> <span class="n">pi_div_6_deg_calculated</span><span class="p">)</span> <span class="o">/</span> <span class="n">pi_div_6_deg_expected</span><span class="p">)</span> <span class="o">/</span> <span class="n">lu</span><span class="p">.</span><span class="n">EPS</span> <span class="p">)</span> <span class="c1">-- prints: 0.53333</span>
<span class="nb">print</span><span class="p">(</span> <span class="p">(</span> <span class="p">(</span><span class="n">pi_div_3_deg_expected</span> <span class="o">-</span> <span class="n">pi_div_3_deg_calculated</span><span class="p">)</span> <span class="o">/</span> <span class="n">pi_div_3_deg_expected</span><span class="p">)</span> <span class="o">/</span> <span class="n">lu</span><span class="p">.</span><span class="n">EPS</span> <span class="p">)</span> <span class="c1">-- prints: 0.53333</span>

<span class="c1">-- relative error is constant. Assertion can take the form of:</span>
<span class="n">assertAlmostEquals</span><span class="p">(</span> <span class="p">(</span><span class="n">pi_div_6_deg_expected</span> <span class="o">-</span> <span class="n">pi_div_6_deg_calculated</span><span class="p">)</span> <span class="o">/</span> <span class="n">pi_div_6_deg_expected</span><span class="p">,</span> <span class="n">lu</span><span class="p">.</span><span class="n">EPS</span> <span class="p">)</span>
<span class="n">assertAlmostEquals</span><span class="p">(</span> <span class="p">(</span><span class="n">pi_div_3_deg_expected</span> <span class="o">-</span> <span class="n">pi_div_3_deg_calculated</span><span class="p">)</span> <span class="o">/</span> <span class="n">pi_div_3_deg_expected</span><span class="p">,</span> <span class="n">lu</span><span class="p">.</span><span class="n">EPS</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="pretty-printing">
<h4>Pretty printing<a class="headerlink" href="#pretty-printing" title="Permalink to this headline">¶</a></h4>
<dl class="py function">
<dt id="prettystr">
<code class="sig-name descname">prettystr</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">value</span></em><span class="sig-paren">)</span><a class="headerlink" href="#prettystr" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts <em>value</em> to a nicely formatted string, whatever the type of the value.
It supports in particular tables, nested table and even recursive tables.</p>
<p>You can use it in your code to replace calls to <em>tostring()</em> .</p>
</dd></dl>

<p><strong>Example of prettystr()</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">lu</span> <span class="o">=</span> <span class="n">require</span><span class="p">(</span><span class="s1">&#39;luaunit&#39;</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">t1</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">}</span>
<span class="o">&gt;</span> <span class="n">t1</span><span class="p">[</span><span class="s1">&#39;toto&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;titi&#39;</span>
<span class="o">&gt;</span> <span class="n">t1</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">function</span> <span class="p">()</span> <span class="n">end</span>
<span class="o">&gt;</span> <span class="n">t1</span><span class="o">.</span><span class="n">fa</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">t1</span><span class="o">.</span><span class="n">tr</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="nb">print</span><span class="p">(</span> <span class="n">lu</span><span class="o">.</span><span class="n">prettystr</span><span class="p">(</span><span class="n">t1</span><span class="p">)</span> <span class="p">)</span>
<span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="n">function</span><span class="p">:</span> <span class="mi">00635</span><span class="n">d68</span><span class="p">,</span> <span class="n">fa</span><span class="o">=</span><span class="n">false</span><span class="p">,</span> <span class="n">toto</span><span class="o">=</span><span class="s2">&quot;titi&quot;</span><span class="p">,</span> <span class="n">tr</span><span class="o">=</span><span class="n">true</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="enabling-global-or-module-level-functions">
<span id="luaunit-global-asserts"></span><h3>Enabling global or module-level functions<a class="headerlink" href="#enabling-global-or-module-level-functions" title="Permalink to this headline">¶</a></h3>
<p>Versions of LuaUnit before version 3.1 would export all assertions functions to the global namespace. A typical
lua test file would look like this:</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="nb">require</span><span class="p">(</span><span class="s1">&#39;luaunit&#39;</span><span class="p">)</span>

<span class="n">TestToto</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1">--class</span>

    <span class="kr">function</span> <span class="nc">TestToto</span><span class="p">:</span><span class="nf">test1_withFailure</span><span class="p">()</span>
        <span class="kd">local</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">assertEquals</span><span class="p">(</span> <span class="n">a</span> <span class="p">,</span> <span class="mi">1</span> <span class="p">)</span>
        <span class="c1">-- will fail</span>
        <span class="n">assertEquals</span><span class="p">(</span> <span class="n">a</span> <span class="p">,</span> <span class="mi">2</span> <span class="p">)</span>
    <span class="kr">end</span>

<span class="p">[...]</span>
</pre></div>
</div>
<p>However, this is an obsolete practice in Lua. It is now recommended to keep all functions inside the module. Starting
from version 3.1 LuaUnit follows this practice and the code should be adapted to look like this:</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="c1">-- the imported module must be stored</span>
<span class="n">lu</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s1">&#39;luaunit&#39;</span><span class="p">)</span>

<span class="n">TestToto</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1">--class</span>

    <span class="kr">function</span> <span class="nc">TestToto</span><span class="p">:</span><span class="nf">test1_withFailure</span><span class="p">()</span>
        <span class="kd">local</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">lu</span><span class="p">.</span><span class="n">assertEquals</span><span class="p">(</span> <span class="n">a</span> <span class="p">,</span> <span class="mi">1</span> <span class="p">)</span>
        <span class="c1">-- will fail</span>
        <span class="n">lu</span><span class="p">.</span><span class="n">assertEquals</span><span class="p">(</span> <span class="n">a</span> <span class="p">,</span> <span class="mi">2</span> <span class="p">)</span>
    <span class="kr">end</span>

<span class="p">[...]</span>
</pre></div>
</div>
<p>If you prefer the old way, LuaUnit can continue to export assertions functions if you set the following
global variable <strong>prior</strong> to importing LuaUnit:</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="c1">-- this works</span>
<span class="n">EXPORT_ASSERT_TO_GLOBALS</span> <span class="o">=</span> <span class="kc">true</span>
<span class="nb">require</span><span class="p">(</span><span class="s1">&#39;luaunit&#39;</span><span class="p">)</span>

<span class="n">TestToto</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1">--class</span>

    <span class="kr">function</span> <span class="nc">TestToto</span><span class="p">:</span><span class="nf">test1_withFailure</span><span class="p">()</span>
        <span class="kd">local</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">assertEquals</span><span class="p">(</span> <span class="n">a</span> <span class="p">,</span> <span class="mi">1</span> <span class="p">)</span>
        <span class="c1">-- will fail</span>
        <span class="n">assertEquals</span><span class="p">(</span> <span class="n">a</span> <span class="p">,</span> <span class="mi">2</span> <span class="p">)</span>
    <span class="kr">end</span>

<span class="p">[...]</span>
</pre></div>
</div>
</div>
<div class="section" id="variables-controlling-luaunit-behavior">
<h3>Variables controlling LuaUnit behavior<a class="headerlink" href="#variables-controlling-luaunit-behavior" title="Permalink to this headline">¶</a></h3>
<div class="section" id="luaunit-order-actual-expected">
<h4>luaunit.ORDER_ACTUAL_EXPECTED<a class="headerlink" href="#luaunit-order-actual-expected" title="Permalink to this headline">¶</a></h4>
<p>This boolean value defines the order of arguments in assertion functions.</p>
<p>For example, in the code <cite>luaunit.assertEquals( a, b )</cite> , LuaUnit will treat by default
<cite>a</cite> as a calculated value under test (actual value) and <cite>b</cite> as a reference value aginst which <cite>a</cite> is
compared (expected value). This will show up in the error reported for the test:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="o">)</span> TestWithFailures.testFail1
doc<span class="se">\m</span>y_test_suite_with_failures.lua:79: expected: <span class="s2">&quot;titi&quot;</span>
actual: <span class="s2">&quot;toto&quot;</span>
</pre></div>
</div>
<p>If you prefer the opposite convention, i.e having the expected argument as first
and actual argument as second, set the <em>ORDER_ACTUAL_EXPECTED</em> to <em>false</em>.</p>
</div>
<div class="section" id="luaunit-print-table-ref-in-error-msg">
<h4>luaunit.PRINT_TABLE_REF_IN_ERROR_MSG<a class="headerlink" href="#luaunit-print-table-ref-in-error-msg" title="Permalink to this headline">¶</a></h4>
<p>This controls whether table references are always printed along with table or not. See <a class="reference internal" href="#table-printing">table-printing</a> for details. The
default is <cite>false</cite>.</p>
</div>
<div class="section" id="luaunit-strip-extra-entries-in-stack-trace">
<span id="strip-extra-entries-in-stack-trace"></span><h4>luaunit.STRIP_EXTRA_ENTRIES_IN_STACK_TRACE<a class="headerlink" href="#luaunit-strip-extra-entries-in-stack-trace" title="Permalink to this headline">¶</a></h4>
<p>This controls how many extra entries in a stack-trace are stripped. By default, LuaUnit hides all its internals
functions to show only user code in the error stack trace. However, if LuaUnit is used as part of another test
framework, and one wants to also hide this global test framework entries, you can increase the number here. The default
is <em>0</em> .</p>
</div>
<div class="section" id="luaunit-version">
<h4>luaunit.VERSION<a class="headerlink" href="#luaunit-version" title="Permalink to this headline">¶</a></h4>
<p>Current version of LuaUnit as a string.</p>
</div>
</div>
</div>
<div class="section" id="developing-luaunit">
<h2>Developing LuaUnit<a class="headerlink" href="#developing-luaunit" title="Permalink to this headline">¶</a></h2>
<div class="section" id="development-ecosystem">
<h3>Development ecosystem<a class="headerlink" href="#development-ecosystem" title="Permalink to this headline">¶</a></h3>
<p>LuaUnit is developed on <a class="reference external" href="https://github.com/bluebird75/luaunit">GitHub</a>.</p>
<p>Bugs or feature requests should be reported using <a class="reference external" href="https://github.com/bluebird75/luaunit/issues">GitHub issues</a>.</p>
<p>LuaUnit is released under the BSD license.</p>
<p>This documentation is available at <a class="reference external" href="http://luaunit.readthedocs.org/en/latest/">Read-the-docs</a>.</p>
</div>
<div class="section" id="contributing">
<h3>Contributing<a class="headerlink" href="#contributing" title="Permalink to this headline">¶</a></h3>
<p>You may contribute to LuaUnit by reporting bugs or wishes, or by contributing code directly with a pull request.</p>
<p>Some issues on GitHub are marked with label <em>enhancement</em>. Feel also free to pick up such tasks and implement them.</p>
<p>Changes should be proposed as <em>Pull Requests</em> on GitHub.</p>
<p>Thank to our continuous integration setup with Travis-Ci and AppVeyor, all unit-tests and functional tests are run on Linux, Windows and MacOs, with all versions of Lua. So
any <em>Pull Request</em> will show immediately if anything is going unexpected.</p>
<div class="section" id="running-unit-tests">
<h4>Running unit-tests<a class="headerlink" href="#running-unit-tests" title="Permalink to this headline">¶</a></h4>
<p>All proposed changes should pass all unit-tests and if needed, add more unit-tests to cover the bug or the new functionality. Usage is pretty simple:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ lua run_unit_tests.lua
................................................................................
...............................
Ran <span class="m">111</span> tests <span class="k">in</span> <span class="m">0</span>.120 seconds
OK
</pre></div>
</div>
</div>
<div class="section" id="running-functional-tests">
<h4>Running functional tests<a class="headerlink" href="#running-functional-tests" title="Permalink to this headline">¶</a></h4>
<p>Functional tests also exist to validate LuaUnit. Their management is slightly more complicated.</p>
<p>The main goal of functional tests is to validate that LuaUnit output has not been altered. Since LuaUnit supports some standard compliant output (TAP, junitxml), this is very important (and it has been broken in the past).</p>
<p>Functional tests perform the following actions:</p>
<ul>
<li><p>Run the 2 suites: example_with_luaunit.lua, test_with_err_fail_pass.lua (with various options to have successe, failure and/or errors)</p></li>
<li><p>Run every suite with all output format, all verbosity</p></li>
<li><p>Validate the XML output with jenkins/hudson and junit schema</p></li>
<li><p>Compare the results with the reference output ( archived in test/ref ), with some tricks to make the comparison possible :</p>
<blockquote>
<div><ul class="simple">
<li><p>adjustment of the file separator to use the same output on Windows and Unix</p></li>
<li><p>date and test duration is zeroed so that it does not impact the comparison</p></li>
<li><p>adjust the stack trace format which has changed between Lua 5.1, 5.2 and 5.3</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Run some legacy suites or tricky output to manage and verify output: test_with_xml.lua, , compat_luaunit_v2x.lua, legacy_example_with_luaunit.lua</p></li>
</ul>
<p>For functional tests to run, <em>diff</em> must be available on the command line. <em>xmllint</em> is needed to perform the xml validation but
this step is skipped if <em>xmllint</em> can not be found.</p>
<p>When functional tests work well, it looks like this:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ lua run_functional_tests.lua
...............
Ran <span class="m">15</span> tests <span class="k">in</span> <span class="m">9</span>.676 seconds
OK
</pre></div>
</div>
<p>When functional test fail, a diff of the comparison between the reference output and the current output is displayed (it can be quite
long). The list of faulty files is summed-up at the end.</p>
</div>
<div class="section" id="modifying-reference-files-for-functional-tests">
<h4>Modifying reference files for functional tests<a class="headerlink" href="#modifying-reference-files-for-functional-tests" title="Permalink to this headline">¶</a></h4>
<p>The script run_functional_tests.lua supports a –update option, with an optional argument.</p>
<ul>
<li><p><em>–update</em> without argument <strong>overwrites all reference output</strong> with the current output. Use only if you know what you are doing, this is usually a very bad idea!</p></li>
<li><p>The following argument overwrite a specific subset of reference files, select the one that fits your change:</p>
<blockquote>
<div><ul class="simple">
<li><p>TestXml: XML output of test_with_xml</p></li>
<li><p>ExampleXml: XML output of example_with_luaunit</p></li>
<li><p>ExampleTap: TAP output of example_with_luaunit</p></li>
<li><p>ExampleText: text output of example_with_luaunit</p></li>
<li><p>ExampleNil: nil output of example_with_luaunit</p></li>
<li><p>ErrFailPassText: text output of test_with_err_fail_pass</p></li>
<li><p>ErrFailPassTap: TAP output of test_with_err_fail_pass</p></li>
<li><p>ErrFailPassXml: XML output of test_with_err_fail_pass</p></li>
<li><p>StopOnError: errFailPassTextStopOnError-1.txt, -2.txt, -3.txt, -4.txt</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<p>For example to record a change in the test_with_err_fail_pass output</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ lua run_functional_tests.lua --update ErrFailPassXml ErrFailPassTap ErrFailPassText

&gt;&gt;&gt;&gt;&gt;&gt;&gt; Generating test/ref/errFailPassXmlDefault.txt
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Generating test/ref/errFailPassXmlDefault-success.txt
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Generating test/ref/errFailPassXmlDefault-failures.txt
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Generating test/ref/errFailPassXmlQuiet.txt
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Generating test/ref/errFailPassXmlQuiet-success.txt
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Generating test/ref/errFailPassXmlQuiet-failures.txt
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Generating test/ref/errFailPassXmlVerbose.txt
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Generating test/ref/errFailPassXmlVerbose-success.txt
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Generating test/ref/errFailPassXmlVerbose-failures.txt
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Generating test/ref/errFailPassTapDefault.txt
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Generating test/ref/errFailPassTapDefault-success.txt
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Generating test/ref/errFailPassTapDefault-failures.txt
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Generating test/ref/errFailPassTapQuiet.txt
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Generating test/ref/errFailPassTapQuiet-success.txt
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Generating test/ref/errFailPassTapQuiet-failures.txt
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Generating test/ref/errFailPassTapVerbose.txt
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Generating test/ref/errFailPassTapVerbose-success.txt
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Generating test/ref/errFailPassTapVerbose-failures.txt
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Generating test/ref/errFailPassTextDefault.txt
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Generating test/ref/errFailPassTextDefault-success.txt
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Generating test/ref/errFailPassTextDefault-failures.txt
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Generating test/ref/errFailPassTextQuiet.txt
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Generating test/ref/errFailPassTextQuiet-success.txt
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Generating test/ref/errFailPassTextQuiet-failures.txt
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Generating test/ref/errFailPassTextVerbose.txt
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Generating test/ref/errFailPassTextVerbose-success.txt
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Generating test/ref/errFailPassTextVerbose-failures.txt
$
</pre></div>
</div>
<p>You can then commit the new files into git.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>how to commit updated reference outputs</p>
<p>When committing those changes into git, please use if possible an
intelligent git committing tool to commit only the interesting changes.
With SourceTree or SublimeMerge for example, in case of XML changes, I can select only the
lines relevant to the change and avoid committing all the updates to test
duration and test datestamp.</p>
</div>
</div>
<div class="section" id="typical-failures-for-functional-tests">
<h4>Typical failures for functional tests<a class="headerlink" href="#typical-failures-for-functional-tests" title="Permalink to this headline">¶</a></h4>
<p>Functional tests may start failing when:</p>
<ol class="arabic simple">
<li><p>Increasing LuaUnit version</p></li>
<li><p>Improving or breaking LuaUnit output</p></li>
</ol>
<p>This a good place to start looking if you see failures occurring.</p>
</div>
<div class="section" id="using-doit-py">
<h4>Using doit.py<a class="headerlink" href="#using-doit-py" title="Permalink to this headline">¶</a></h4>
<p>The utility <em>doit.py</em> is a useful developer tool to repeat common developer commands.</p>
<p><strong>Running syntax check</strong></p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>doit.py luacheck
</pre></div>
</div>
<p>Run luacheck on the LuaUnit code.</p>
<p><strong>Running unit-tests</strong></p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>doit.py rununittests
</pre></div>
</div>
<p>Use it to run all unit tests, on all installed versions of Lua on the sytem.</p>
<p><strong>Running all tests</strong></p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>doit.py runtests
</pre></div>
</div>
<p>Run luacheck then run unit-tests then run functional tests. Just like the continuous integration.</p>
<p><strong>Creating documentation</strong></p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>doit.py makedoc
</pre></div>
</div>
<p>Runs sphinx to generate the html documentation. You must have sphinx installed on your path.</p>
<p><strong>Preparing a release</strong></p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>doit.py buildrock
</pre></div>
</div>
<p>Create a rock file ready to be uploaded to luarocks, containing a clone of the current git, with documentation generated
README and LICENSE, tests, and everything else stripped out.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>doit.py packageit
</pre></div>
</div>
<p>Create a zip and tar.gz archive suitable to be uploaded to github. The archive is composed of a clone
of the current git content, stripped from everything not related to using luaunit (no CI files, no doit.lu, …)
but with full documentation generated.</p>
</div>
</div>
<div class="section" id="process-of-releasing-a-new-version-of-luaunit">
<h3>Process of releasing a new version of LuaUnit<a class="headerlink" href="#process-of-releasing-a-new-version-of-luaunit" title="Permalink to this headline">¶</a></h3>
<p>The steps are the following:</p>
<ul class="simple">
<li><p>update luaunit with the desired functionality, ready for a release</p></li>
<li><p>update the version number in luaunit.lua</p></li>
<li><p>update the version number in doit.py</p></li>
<li><p>check that all tests pass on all supported lua versions</p></li>
</ul>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>doit.py runtests
</pre></div>
</div>
<ul class="simple">
<li><p>update <em>examples</em> if needed to reflect new features</p></li>
<li><p>update index.rst with documentation of new features/behavior</p></li>
<li><p>update README.md and index.rst with the release information (date and content)</p></li>
<li><p>generate package for github:</p></li>
</ul>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>doit.py packageit
</pre></div>
</div>
<ul class="simple">
<li><dl class="simple">
<dt>verify the content of the packages:</dt><dd><ul>
<li><p>documentation must be properly generated</p></li>
<li><p>examples should work</p></li>
<li><p>unit-tests should pass</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
</div>
<div class="section" id="annexes">
<h2>Annexes<a class="headerlink" href="#annexes" title="Permalink to this headline">¶</a></h2>
<div class="section" id="annex-a-more-on-table-printing">
<span id="table-printing"></span><h3>Annex A: More on table printing<a class="headerlink" href="#annex-a-more-on-table-printing" title="Permalink to this headline">¶</a></h3>
<p>When asserting tables equality, by default, the table content is printed in case of failures. LuaUnit tries to print
tables in a readable format. It is
possible to always display the table id along with the content, by setting a module parameter PRINT_TABLE_REF_IN_ERROR_MSG . This
helps identifying tables:</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kd">local</span> <span class="n">lu</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s1">&#39;luaunit&#39;</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">t1</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">}</span>
<span class="c1">-- normally, t1 is dispalyed as: &quot;{1,2,3}&quot;</span>

<span class="c1">-- if setting this:</span>
<span class="n">lu</span><span class="p">.</span><span class="n">PRINT_TABLE_REF_IN_ERROR_MSG</span> <span class="o">=</span> <span class="kc">true</span>

<span class="c1">-- display of table t1 becomes: &quot;&lt;table: 0x29ab56&gt; {1,2,3}&quot;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>table loops</p>
<p>When displaying table content, it is possible to encounter loops, if for example two table references eachother. In such
cases, LuaUnit display the full table content once, along with the table id, and displays only the table id for the looping
reference.</p>
</div>
<p><strong>Example:</strong> displaying a table with reference loop</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kd">local</span> <span class="n">t1</span> <span class="o">=</span> <span class="p">{}</span>
<span class="kd">local</span> <span class="n">t2</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">t1</span><span class="p">.</span><span class="n">t2</span> <span class="o">=</span> <span class="n">t2</span>
<span class="n">t1</span><span class="p">.</span><span class="n">a</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">}</span>
<span class="n">t2</span><span class="p">.</span><span class="n">t1</span> <span class="o">=</span> <span class="n">t1</span>

<span class="c1">-- when displaying table t1:</span>
<span class="c1">--   table t1 inside t2 is only displayed by its id because t1 is already being displayed</span>
<span class="c1">--   table t2 is displayed along with its id because it is part of a loop.</span>
<span class="c1">-- t1: &quot;&lt;table: 0x29ab56&gt; { a={1,2,3}, t2=&lt;table: 0x27ab23&gt; {t1=&lt;table: 0x29ab56&gt;} }&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="annex-b-comparing-tables-with-keys-of-type-table">
<span id="comparing-table-keys-table"></span><h3>Annex B: Comparing tables with keys of type table<a class="headerlink" href="#annex-b-comparing-tables-with-keys-of-type-table" title="Permalink to this headline">¶</a></h3>
<p>There are a few programs out there which use tables as keys for other tables. How to compare
such tables is delicate.</p>
<p>A small code block is worth a thousand pictures :</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kd">local</span> <span class="n">lu</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s1">&#39;luaunit&#39;</span><span class="p">)</span>

<span class="c1">-- let&#39;s define two tables</span>
<span class="n">t1</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="p">}</span>
<span class="n">t2</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="p">}</span>
<span class="n">lu</span><span class="p">.</span><span class="n">assertEquals</span><span class="p">(</span> <span class="n">t1</span><span class="p">,</span> <span class="n">t2</span> <span class="p">)</span> <span class="c1">-- succeeds</span>

<span class="c1">-- let&#39;s define three tables, with the two above tables as keys</span>
<span class="n">t3</span> <span class="o">=</span> <span class="p">{</span> <span class="n">t1</span><span class="o">=</span><span class="s1">&#39;a&#39;</span> <span class="p">}</span>
<span class="n">t4</span> <span class="o">=</span> <span class="p">{</span> <span class="n">t2</span><span class="o">=</span><span class="s1">&#39;a&#39;</span> <span class="p">}</span>
<span class="n">t5</span> <span class="o">=</span> <span class="p">{</span> <span class="n">t2</span><span class="o">=</span><span class="s1">&#39;a&#39;</span> <span class="p">}</span>
</pre></div>
</div>
<p>The difference between t3 and t4 is that they both reference a key with different table references but
identical table content.</p>
<p>LuaUnit chooses to treat this as two different keys, so t3 and t4 are not considered equal.</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">lu</span><span class="p">.</span><span class="n">assertEquals</span><span class="p">(</span> <span class="n">t3</span><span class="p">,</span> <span class="n">t4</span> <span class="p">)</span> <span class="c1">-- fails</span>
</pre></div>
</div>
<p>If using the same table as key, they are now considered equal:</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">lu</span><span class="p">.</span><span class="n">assertEquals</span><span class="p">(</span> <span class="n">t4</span><span class="p">,</span> <span class="n">t5</span> <span class="p">)</span> <span class="c1">-- fails</span>
</pre></div>
</div>
</div>
<div class="section" id="annex-c-source-code-of-example">
<span id="source-code-example"></span><h3>Annex C: Source code of example<a class="headerlink" href="#annex-c-source-code-of-example" title="Permalink to this headline">¶</a></h3>
<p>Source code of the example used in the <a class="reference internal" href="#getting-started-with-luaunit">Getting started with LuaUnit</a></p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="c1">--</span>
<span class="c1">-- The examples described in the documentation are below.</span>
<span class="c1">--</span>

<span class="n">lu</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s1">&#39;luaunit&#39;</span><span class="p">)</span>

<span class="kr">function</span> <span class="nf">add</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">)</span>
    <span class="c1">-- add positive numbers</span>
    <span class="c1">-- return 0 if any of the numbers are 0</span>
    <span class="c1">-- error if any of the two numbers are negative</span>
    <span class="kr">if</span> <span class="n">v1</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">v2</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="kr">then</span>
        <span class="nb">error</span><span class="p">(</span><span class="s1">&#39;Can only add positive or null numbers, received &#39;</span><span class="o">..</span><span class="n">v1</span><span class="o">..</span><span class="s1">&#39; and &#39;</span><span class="o">..</span><span class="n">v2</span><span class="p">)</span>
    <span class="kr">end</span>
    <span class="kr">if</span> <span class="n">v1</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">v2</span> <span class="o">==</span> <span class="mi">0</span> <span class="kr">then</span>
        <span class="kr">return</span> <span class="mi">0</span>
    <span class="kr">end</span>
    <span class="kr">return</span> <span class="n">v1</span><span class="o">+</span><span class="n">v2</span>
<span class="kr">end</span>

<span class="kr">function</span> <span class="nf">adder</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="c1">-- return a function that adds v to its argument using add</span>
    <span class="kr">function</span> <span class="nf">closure</span><span class="p">(</span> <span class="n">x</span> <span class="p">)</span> <span class="kr">return</span> <span class="n">x</span><span class="o">+</span><span class="n">v</span> <span class="kr">end</span>
    <span class="kr">return</span> <span class="n">closure</span>
<span class="kr">end</span>

<span class="kr">function</span> <span class="nf">div</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">)</span>
    <span class="c1">-- divide positive numbers</span>
    <span class="c1">-- return 0 if any of the numbers are 0</span>
    <span class="c1">-- error if any of the two numbers are negative</span>
    <span class="kr">if</span> <span class="n">v1</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">v2</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="kr">then</span>
        <span class="nb">error</span><span class="p">(</span><span class="s1">&#39;Can only divide positive or null numbers, received &#39;</span><span class="o">..</span><span class="n">v1</span><span class="o">..</span><span class="s1">&#39; and &#39;</span><span class="o">..</span><span class="n">v2</span><span class="p">)</span>
    <span class="kr">end</span>
    <span class="kr">if</span> <span class="n">v1</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">v2</span> <span class="o">==</span> <span class="mi">0</span> <span class="kr">then</span>
        <span class="kr">return</span> <span class="mi">0</span>
    <span class="kr">end</span>
    <span class="kr">return</span> <span class="n">v1</span><span class="o">/</span><span class="n">v2</span>
<span class="kr">end</span>



<span class="n">TestAdd</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="kr">function</span> <span class="nc">TestAdd</span><span class="p">:</span><span class="nf">testAddPositive</span><span class="p">()</span>
        <span class="n">lu</span><span class="p">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span>
    <span class="kr">end</span>

    <span class="kr">function</span> <span class="nc">TestAdd</span><span class="p">:</span><span class="nf">testAddZero</span><span class="p">()</span>
        <span class="n">lu</span><span class="p">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">lu</span><span class="p">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">add</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">lu</span><span class="p">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">add</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
    <span class="kr">end</span>

    <span class="kr">function</span> <span class="nc">TestAdd</span><span class="p">:</span><span class="nf">testAddError</span><span class="p">()</span>
        <span class="n">lu</span><span class="p">.</span><span class="n">assertErrorMsgContains</span><span class="p">(</span><span class="s1">&#39;Can only add positive or null numbers, received 2 and -3&#39;</span><span class="p">,</span> <span class="n">add</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">)</span>
    <span class="kr">end</span>

    <span class="kr">function</span> <span class="nc">TestAdd</span><span class="p">:</span><span class="nf">testAdder</span><span class="p">()</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">adder</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">lu</span><span class="p">.</span><span class="n">assertIsFunction</span><span class="p">(</span> <span class="n">f</span> <span class="p">)</span>
        <span class="n">lu</span><span class="p">.</span><span class="n">assertEquals</span><span class="p">(</span> <span class="n">f</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="mi">5</span> <span class="p">)</span>
    <span class="kr">end</span>
<span class="c1">-- end of table TestAdd</span>

<span class="n">TestDiv</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="kr">function</span> <span class="nc">TestDiv</span><span class="p">:</span><span class="nf">testDivPositive</span><span class="p">()</span>
        <span class="n">lu</span><span class="p">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">div</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span>
    <span class="kr">end</span>

    <span class="kr">function</span> <span class="nc">TestDiv</span><span class="p">:</span><span class="nf">testDivZero</span><span class="p">()</span>
        <span class="n">lu</span><span class="p">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">div</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">lu</span><span class="p">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">div</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">lu</span><span class="p">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">div</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
    <span class="kr">end</span>

    <span class="kr">function</span> <span class="nc">TestDiv</span><span class="p">:</span><span class="nf">testDivError</span><span class="p">()</span>
        <span class="n">lu</span><span class="p">.</span><span class="n">assertErrorMsgContains</span><span class="p">(</span><span class="s1">&#39;Can only divide positive or null numbers, received 2 and -3&#39;</span><span class="p">,</span> <span class="n">div</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">)</span>
    <span class="kr">end</span>
<span class="c1">-- end of table TestDiv</span>

<span class="cm">--[[</span>
<span class="cm">--</span>
<span class="cm">--      Uncomment this section to see how failures are displayed</span>
<span class="cm">--</span>
<span class="cm">TestWithFailures = {}</span>
<span class="cm">    -- two failing tests</span>

<span class="cm">    function TestWithFailures:testFail1()</span>
<span class="cm">        lu.assertEquals( &quot;toto&quot;, &quot;titi&quot;)</span>
<span class="cm">    end</span>

<span class="cm">    function TestWithFailures:testFail2()</span>
<span class="cm">        local a=1</span>
<span class="cm">        local b=&#39;toto&#39;</span>
<span class="cm">        local c = a + b -- oops, can not add string and numbers</span>
<span class="cm">        return c</span>
<span class="cm">    end</span>
<span class="cm">-- end of table TestWithFailures</span>
<span class="cm">]]</span>


<span class="cm">--[[</span>
<span class="cm">TestLogger = {}</span>
<span class="cm">    function TestLogger:setUp()</span>
<span class="cm">        -- define the fname to use for logging</span>
<span class="cm">        self.fname = &#39;mytmplog.log&#39;</span>
<span class="cm">        -- make sure the file does not already exists</span>
<span class="cm">        os.remove(self.fname)</span>
<span class="cm">    end</span>

<span class="cm">    function TestLogger:testLoggerCreatesFile()</span>
<span class="cm">        initLog(self.fname)</span>
<span class="cm">        log(&#39;toto&#39;)</span>
<span class="cm">        f = io.open(self.fname, &#39;r&#39;)</span>
<span class="cm">        lu.assertNotNil( f )</span>
<span class="cm">        f:close()</span>
<span class="cm">    end</span>

<span class="cm">    function TestLogger:tearDown()</span>
<span class="cm">        self.fname = &#39;mytmplog.log&#39;</span>
<span class="cm">        -- cleanup our log file after all tests</span>
<span class="cm">        os.remove(self.fname)</span>
<span class="cm">    end</span>
<span class="cm">-- end of table TestLogger</span>

<span class="cm">]]</span>

<span class="nb">os.exit</span><span class="p">(</span><span class="n">lu</span><span class="p">.</span><span class="n">LuaUnit</span><span class="p">.</span><span class="n">run</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="section" id="annex-d-bsd-license">
<h3>Annex D: BSD License<a class="headerlink" href="#annex-d-bsd-license" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>This software is distributed under the BSD License.</p>
<p>Copyright (c) 2005-2018, Philippe Fremy &lt;phil at freehackers dot org&gt;</p>
<p>All rights reserved.</p>
<p>Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</p>
<p>Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</p>
<p>THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS “AS IS” AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</p>
</div></blockquote>
</div>
</div>
<div class="section" id="index-and-search-page">
<h2>Index and Search page<a class="headerlink" href="#index-and-search-page" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="genindex.html"><span class="std std-ref">Index</span></a></p></li>
<li><p><a class="reference internal" href="search.html"><span class="std std-ref">Search Page</span></a></p></li>
</ul>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="#">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Welcome to LuaUnit’s documentation!</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#more-details">More details</a><ul>
<li><a class="reference internal" href="#installation">Installation</a><ul>
<li><a class="reference internal" href="#luarocks">LuaRocks</a></li>
<li><a class="reference internal" href="#github">GitHub</a></li>
</ul>
</li>
<li><a class="reference internal" href="#upgrade-note">Upgrade note</a></li>
<li><a class="reference internal" href="#luaunit-development">LuaUnit development</a></li>
<li><a class="reference internal" href="#version-and-changelog">Version and Changelog</a><ul>
<li><a class="reference internal" href="#new-in-version-3-4-02-march-2021">New in version 3.4 - 02 March 2021</a></li>
<li><a class="reference internal" href="#new-in-version-3-3-6-mar-2018">New in version 3.3 - 6. Mar 2018</a></li>
<li><a class="reference internal" href="#new-in-version-3-2-12-jul-2016">New in version 3.2 - 12. Jul 2016</a></li>
<li><a class="reference internal" href="#new-in-version-3-1-10-mar-2015">New in version 3.1 - 10. Mar 2015</a></li>
<li><a class="reference internal" href="#new-in-version-3-0-9-oct-2014">New in version 3.0 - 9. Oct 2014</a></li>
<li><a class="reference internal" href="#new-in-version-1-5-8-nov-2012">New in version 1.5 - 8. Nov 2012</a></li>
<li><a class="reference internal" href="#new-in-version-1-4-26-jul-2012">New in version 1.4 - 26. Jul 2012</a></li>
<li><a class="reference internal" href="#new-in-version-1-3-30-oct-2007">New in version 1.3 - 30. Oct 2007</a></li>
<li><a class="reference internal" href="#version-1-2-13-jun-2005">Version 1.2 - 13. Jun 2005</a></li>
<li><a class="reference internal" href="#version-1-1">Version 1.1</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#getting-started-with-luaunit">Getting started with LuaUnit</a><ul>
<li><a class="reference internal" href="#setting-up-your-test-script">Setting up your test script</a></li>
<li><a class="reference internal" href="#writing-tests">Writing tests</a></li>
<li><a class="reference internal" href="#grouping-tests-setup-teardown-functionality">Grouping tests, setup/teardown functionality</a></li>
<li><a class="reference internal" href="#using-the-command-line">Using the command-line</a></li>
<li><a class="reference internal" href="#conclusion">Conclusion</a></li>
</ul>
</li>
<li><a class="reference internal" href="#reference-documentation">Reference documentation</a><ul>
<li><a class="reference internal" href="#command-line-options">Command-line options</a><ul>
<li><a class="reference internal" href="#output-formats">Output formats</a></li>
<li><a class="reference internal" href="#other-options">Other options</a></li>
<li><a class="reference internal" href="#flexible-test-selection">Flexible test selection</a></li>
</ul>
</li>
<li><a class="reference internal" href="#luaunit-runner-object">LuaUnit runner object</a></li>
<li><a class="reference internal" href="#skipping-and-ending-test">Skipping and ending test</a></li>
<li><a class="reference internal" href="#output-formats-details">Output formats details</a></li>
<li><a class="reference internal" href="#test-collection-and-execution-process">Test collection and execution process</a><ul>
<li><a class="reference internal" href="#test-collection">Test collection</a></li>
<li><a class="reference internal" href="#test-execution">Test execution</a></li>
</ul>
</li>
<li><a class="reference internal" href="#assertions-functions">Assertions functions</a><ul>
<li><a class="reference internal" href="#equality-assertions">Equality assertions</a></li>
<li><a class="reference internal" href="#value-assertions">Value assertions</a></li>
<li><a class="reference internal" href="#string-assertions">String assertions</a></li>
<li><a class="reference internal" href="#error-assertions">Error assertions</a></li>
<li><a class="reference internal" href="#type-assertions">Type assertions</a></li>
<li><a class="reference internal" href="#table-assertions">Table assertions</a></li>
<li><a class="reference internal" href="#scientific-computing-and-luaunit">Scientific computing and LuaUnit</a></li>
<li><a class="reference internal" href="#pretty-printing">Pretty printing</a></li>
</ul>
</li>
<li><a class="reference internal" href="#enabling-global-or-module-level-functions">Enabling global or module-level functions</a></li>
<li><a class="reference internal" href="#variables-controlling-luaunit-behavior">Variables controlling LuaUnit behavior</a><ul>
<li><a class="reference internal" href="#luaunit-order-actual-expected">luaunit.ORDER_ACTUAL_EXPECTED</a></li>
<li><a class="reference internal" href="#luaunit-print-table-ref-in-error-msg">luaunit.PRINT_TABLE_REF_IN_ERROR_MSG</a></li>
<li><a class="reference internal" href="#luaunit-strip-extra-entries-in-stack-trace">luaunit.STRIP_EXTRA_ENTRIES_IN_STACK_TRACE</a></li>
<li><a class="reference internal" href="#luaunit-version">luaunit.VERSION</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#developing-luaunit">Developing LuaUnit</a><ul>
<li><a class="reference internal" href="#development-ecosystem">Development ecosystem</a></li>
<li><a class="reference internal" href="#contributing">Contributing</a><ul>
<li><a class="reference internal" href="#running-unit-tests">Running unit-tests</a></li>
<li><a class="reference internal" href="#running-functional-tests">Running functional tests</a></li>
<li><a class="reference internal" href="#modifying-reference-files-for-functional-tests">Modifying reference files for functional tests</a></li>
<li><a class="reference internal" href="#typical-failures-for-functional-tests">Typical failures for functional tests</a></li>
<li><a class="reference internal" href="#using-doit-py">Using doit.py</a></li>
</ul>
</li>
<li><a class="reference internal" href="#process-of-releasing-a-new-version-of-luaunit">Process of releasing a new version of LuaUnit</a></li>
</ul>
</li>
<li><a class="reference internal" href="#annexes">Annexes</a><ul>
<li><a class="reference internal" href="#annex-a-more-on-table-printing">Annex A: More on table printing</a></li>
<li><a class="reference internal" href="#annex-b-comparing-tables-with-keys-of-type-table">Annex B: Comparing tables with keys of type table</a></li>
<li><a class="reference internal" href="#annex-c-source-code-of-example">Annex C: Source code of example</a></li>
<li><a class="reference internal" href="#annex-d-bsd-license">Annex D: BSD License</a></li>
</ul>
</li>
<li><a class="reference internal" href="#index-and-search-page">Index and Search page</a></li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/index.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="nav-item nav-item-0"><a href="#">LuaUnit 3.3 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Welcome to LuaUnit’s documentation!</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, Philippe Fremy.
      Last updated on Mar 03, 2021.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.4.3.
    </div>
  </body>
</html>